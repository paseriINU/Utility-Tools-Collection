<!DOCTYPE html>
<!--
================================================================================
  PDF ã—ãŠã‚Šæ¤œè¨¼ãƒ„ãƒ¼ãƒ«
================================================================================
  ã“ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€PDFã®ã—ãŠã‚Šï¼ˆãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼‰ã‚’æ¤œè¨¼ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
  å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã›ãšã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æ¨™æº–æ©Ÿèƒ½ã®ã¿ã§å‹•ä½œã—ã¾ã™ã€‚

  ã€HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®åŸºæœ¬æ§‹é€ ã€‘
  1. <!DOCTYPE html> - HTML5ã§ã‚ã‚‹ã“ã¨ã‚’å®£è¨€
  2. <html> - HTMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒˆè¦ç´ 
  3. <head> - ãƒ¡ã‚¿æƒ…å ±ã€ã‚¹ã‚¿ã‚¤ãƒ«ã€ã‚¿ã‚¤ãƒˆãƒ«ãªã©ã‚’è¨˜è¿°
  4. <body> - ãƒšãƒ¼ã‚¸ã®å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¨˜è¿°
================================================================================
-->
<html lang="ja">
<!-- lang="ja" ã¯ã€ã“ã®ãƒšãƒ¼ã‚¸ãŒæ—¥æœ¬èªã§ã‚ã‚‹ã“ã¨ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¼ãˆã¾ã™ -->

<head>
    <!--
    ==========================================================================
      <head>ã‚»ã‚¯ã‚·ãƒ§ãƒ³
      ãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¿æƒ…å ±ï¼ˆè¦‹ãˆãªã„è¨­å®šéƒ¨åˆ†ï¼‰ã‚’å®šç¾©ã—ã¾ã™
    ==========================================================================
    -->

    <!-- æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’UTF-8ã«è¨­å®šï¼ˆæ—¥æœ¬èªã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹ãŸã‚ï¼‰ -->
    <meta charset="UTF-8">

    <!-- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ç”¨ã®è¨­å®šï¼ˆã‚¹ãƒãƒ›ã§ã‚‚è¦‹ã‚„ã™ãã™ã‚‹ï¼‰ -->
    <!-- width=device-width: ç”»é¢å¹…ã«åˆã‚ã›ã‚‹ -->
    <!-- initial-scale=1.0: åˆæœŸã‚ºãƒ¼ãƒ ã‚’100%ã«è¨­å®š -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¿ã‚¤ãƒˆãƒ« -->
    <title>PDF ã—ãŠã‚Šæ¤œè¨¼ãƒ„ãƒ¼ãƒ«</title>

    <!--
    ==========================================================================
      <style>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ - CSSï¼ˆã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆï¼‰
      ãƒšãƒ¼ã‚¸ã®è¦‹ãŸç›®ï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ã‚’å®šç¾©ã—ã¾ã™

      ã€CSSã®åŸºæœ¬æ§‹æ–‡ã€‘
      ã‚»ãƒ¬ã‚¯ã‚¿ {
          ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£: å€¤;
      }

      ä¾‹: body { color: red; }  â†’ bodyã‚¿ã‚°å†…ã®æ–‡å­—ã‚’èµ¤è‰²ã«
    ==========================================================================
    -->
    <style>
        /*
        ----------------------------------------------------------------------
          å…¨ä½“è¨­å®šï¼ˆãƒªã‚»ãƒƒãƒˆãƒ»åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
        ----------------------------------------------------------------------
        */

        /*
         * å…¨ç§°ã‚»ãƒ¬ã‚¯ã‚¿ï¼ˆ*ï¼‰: ã™ã¹ã¦ã®è¦ç´ ã«é©ç”¨
         * box-sizing: border-box ã¯ã€paddingã¨borderã‚’å«ã‚ãŸ
         * ã‚µã‚¤ã‚ºè¨ˆç®—ã‚’ã™ã‚‹ãŸã‚ã®é‡è¦ãªè¨­å®šã§ã™
         */
        * {
            box-sizing: border-box;
        }

        /*
         * bodyã‚¿ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒšãƒ¼ã‚¸å…¨ä½“ã®åŸºæœ¬è¨­å®šï¼‰
         * font-family: ä½¿ç”¨ã™ã‚‹ãƒ•ã‚©ãƒ³ãƒˆï¼ˆå·¦ã‹ã‚‰å„ªå…ˆé †ï¼‰
         * max-width: æœ€å¤§å¹…ã‚’1200pxã«åˆ¶é™ï¼ˆå¤§ç”»é¢ã§ã‚‚èª­ã¿ã‚„ã™ãï¼‰
         * margin: 0 auto ã¯ã€å·¦å³ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’è‡ªå‹•è¨ˆç®—ã—ã¦ä¸­å¤®å¯„ã›
         * padding: å†…å´ã®ä½™ç™½
         * background-color: èƒŒæ™¯è‰²ï¼ˆ#f5f5f5 = è–„ã„ã‚°ãƒ¬ãƒ¼ï¼‰
         */
        body {
            font-family: 'Segoe UI', 'Meiryo', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        /*
        ----------------------------------------------------------------------
          è¦‹å‡ºã—ï¼ˆh1ã‚¿ã‚°ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ«
        ----------------------------------------------------------------------
        */
        h1 {
            color: #333;                          /* æ–‡å­—è‰²ï¼ˆæ¿ƒã„ã‚°ãƒ¬ãƒ¼ï¼‰ */
            border-bottom: 3px solid #4a90d9;     /* ä¸‹ç·šï¼ˆé’è‰²ã€3pxå¤ªã•ï¼‰ */
            padding-bottom: 10px;                 /* ä¸‹ç·šã¨ã®é–“éš” */
        }

        /*
        ----------------------------------------------------------------------
          ã‚³ãƒ³ãƒ†ãƒŠï¼ˆç™½ã„ç®±ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ«
          .container ã¯ã€Œclass="container"ã€ã‚’æŒã¤è¦ç´ ã«é©ç”¨
        ----------------------------------------------------------------------
        */
        .container {
            background: white;                    /* èƒŒæ™¯ã‚’ç™½ã« */
            padding: 20px;                        /* å†…å´ã®ä½™ç™½ */
            border-radius: 8px;                   /* è§’ã‚’ä¸¸ãã™ã‚‹ */
            /* box-shadow: å½±ã‚’ã¤ã‘ã‚‹ï¼ˆæ¨ª, ç¸¦, ã¼ã‹ã—, è‰²ï¼‰ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;                  /* ä¸‹ã®è¦ç´ ã¨ã®é–“éš” */
        }

        /*
        ----------------------------------------------------------------------
          ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹å ´æ‰€ï¼‰
        ----------------------------------------------------------------------
        */
        .drop-zone {
            border: 3px dashed #4a90d9;           /* ç‚¹ç·šã®æ ï¼ˆé’è‰²ï¼‰ */
            border-radius: 8px;                   /* è§’ã‚’ä¸¸ã */
            padding: 40px;                        /* å†…å´ã®ä½™ç™½ï¼ˆå¤§ãã‚ï¼‰ */
            text-align: center;                   /* ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®å¯„ã› */
            cursor: pointer;                      /* ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ‰‹ã®å½¢ã« */
            /* transition: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœï¼ˆ0.3ç§’ã‹ã‘ã¦å¤‰åŒ–ï¼‰ */
            transition: all 0.3s;
            background-color: #f8fafc;            /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯ */
        }

        /*
         * :hover ã¯ã€ãƒã‚¦ã‚¹ã‚’ä¹—ã›ãŸã¨ãã®ã‚¹ã‚¿ã‚¤ãƒ«
         * ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°ã®ã‚»ãƒ¬ã‚¯ã‚¿ã‚’æŒ‡å®šå¯èƒ½
         */
        .drop-zone:hover, .drop-zone.dragover {
            background-color: #e3f2fd;            /* é’ã¿ãŒã‹ã£ãŸèƒŒæ™¯ã«å¤‰åŒ– */
            border-color: #1976d2;                /* æ ç·šã‚’æ¿ƒã„é’ã« */
        }

        /* ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³å†…ã®æ®µè½ */
        .drop-zone p {
            margin: 0;                            /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒ¼ã‚¸ãƒ³ã‚’å‰Šé™¤ */
            font-size: 16px;
            color: #666;                          /* ã‚°ãƒ¬ãƒ¼ã®æ–‡å­—è‰² */
        }

        /* ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³å†…ã®ã‚¢ã‚¤ã‚³ãƒ³ */
        .drop-zone .icon {
            font-size: 48px;                      /* å¤§ããªçµµæ–‡å­—ã‚µã‚¤ã‚º */
            margin-bottom: 10px;
        }

        /*
        ----------------------------------------------------------------------
          ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ï¼ˆéè¡¨ç¤ºï¼‰
          å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã¯ã€ã“ã®inputã‚’JavaScriptã§æ“ä½œã—ã¦è¡Œã„ã¾ã™
        ----------------------------------------------------------------------
        */
        input[type="file"] {
            display: none;                        /* ç”»é¢ã«è¡¨ç¤ºã—ãªã„ */
        }

        /*
        ----------------------------------------------------------------------
          ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢
        ----------------------------------------------------------------------
        */
        .file-info {
            margin-top: 15px;
            padding: 10px;
            background: #e8f5e9;                  /* è–„ã„ç·‘ã®èƒŒæ™¯ï¼ˆæˆåŠŸã‚’ç¤ºã™è‰²ï¼‰ */
            border-radius: 4px;
            display: none;                        /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
        }

        /* .show ã‚¯ãƒ©ã‚¹ãŒè¿½åŠ ã•ã‚ŒãŸã¨ãã«è¡¨ç¤º */
        .file-info.show {
            display: block;                       /* ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ ã¨ã—ã¦è¡¨ç¤º */
        }

        /*
        ----------------------------------------------------------------------
          ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«
        ----------------------------------------------------------------------
        */
        button {
            background-color: #4a90d9;            /* é’ã„èƒŒæ™¯ */
            color: white;                         /* ç™½ã„æ–‡å­— */
            border: none;                         /* æ ç·šãªã— */
            padding: 12px 24px;                   /* å†…å´ã®ä½™ç™½ï¼ˆä¸Šä¸‹12px, å·¦å³24pxï¼‰ */
            font-size: 16px;
            border-radius: 4px;                   /* å°‘ã—è§’ã‚’ä¸¸ã */
            cursor: pointer;                      /* æ‰‹ã®ã‚«ãƒ¼ã‚½ãƒ« */
            margin: 5px;
            transition: background-color 0.3s;    /* è‰²å¤‰åŒ–ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }

        /* ãƒœã‚¿ãƒ³ã«ãƒã‚¦ã‚¹ã‚’ä¹—ã›ãŸã¨ã */
        button:hover {
            background-color: #357abd;            /* å°‘ã—æš—ã„é’ã« */
        }

        /* disabledå±æ€§ãŒã¤ã„ãŸãƒœã‚¿ãƒ³ï¼ˆç„¡åŠ¹åŒ–çŠ¶æ…‹ï¼‰ */
        button:disabled {
            background-color: #ccc;               /* ã‚°ãƒ¬ãƒ¼ã« */
            cursor: not-allowed;                  /* ç¦æ­¢ã‚«ãƒ¼ã‚½ãƒ« */
        }

        /* ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒœã‚¿ãƒ³ï¼ˆã‚°ãƒ¬ãƒ¼ç³»ï¼‰ */
        button.secondary {
            background-color: #6c757d;
        }

        button.secondary:hover {
            background-color: #545b62;
        }

        /* ãƒœã‚¿ãƒ³ã‚’ã¾ã¨ã‚ã‚‹ã‚°ãƒ«ãƒ¼ãƒ— */
        .button-group {
            margin-top: 15px;
        }

        /*
        ----------------------------------------------------------------------
          ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¡¨ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ«
        ----------------------------------------------------------------------
        */
        table {
            width: 100%;                          /* è¦ªè¦ç´ ã®å¹…ã„ã£ã±ã„ã« */
            border-collapse: collapse;            /* ã‚»ãƒ«é–“ã®éš™é–“ã‚’ãªãã™ */
            margin-top: 15px;
            font-size: 14px;
        }

        /* thï¼ˆè¦‹å‡ºã—ã‚»ãƒ«ï¼‰ã¨ tdï¼ˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ï¼‰ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        th, td {
            border: 1px solid #ddd;               /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®æ ç·š */
            padding: 10px 8px;                    /* å†…å´ã®ä½™ç™½ */
            text-align: left;                     /* å·¦å¯„ã› */
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆè¦‹å‡ºã—è¡Œï¼‰ */
        th {
            background-color: #4a90d9;            /* é’ã„èƒŒæ™¯ */
            color: white;                         /* ç™½ã„æ–‡å­— */
            position: sticky;                     /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã‚‚å›ºå®šè¡¨ç¤º */
            top: 0;                               /* ä¸Šç«¯ã«å›ºå®š */
        }

        /*
         * nth-child(even): å¶æ•°ç•ªç›®ã®è¦ç´ ã‚’é¸æŠ
         * ã“ã‚Œã«ã‚ˆã‚Šã€è¡Œã”ã¨ã«äº¤äº’ã«èƒŒæ™¯è‰²ã‚’å¤‰ãˆã‚‹ï¼ˆç¸æ¨¡æ§˜ï¼‰
         */
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* è¡Œã«ãƒã‚¦ã‚¹ã‚’ä¹—ã›ãŸã¨ãã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        tr:hover {
            background-color: #f0f7ff;
        }

        /*
        ----------------------------------------------------------------------
          åˆ¤å®šçµæœã®ã‚»ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
        ----------------------------------------------------------------------
        */
        /* OKåˆ¤å®šï¼ˆç·‘ç³»ï¼‰ */
        .status-ok {
            background-color: #c6efce !important; /* !important ã§ä»–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¸Šæ›¸ã */
            color: #006100;                       /* æ¿ƒã„ç·‘ã®æ–‡å­— */
            font-weight: bold;                    /* å¤ªå­— */
        }

        /* ç¢ºèªè¦åˆ¤å®šï¼ˆé»„è‰²ç³»ï¼‰ */
        .status-warning {
            background-color: #ffeb9c !important;
            color: #9c5700;                       /* èŒ¶è‰²ã£ã½ã„æ–‡å­— */
            font-weight: bold;
        }

        /*
        ----------------------------------------------------------------------
          çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ï¼‰
        ----------------------------------------------------------------------
        */
        .result-container {
            max-height: 600px;                    /* æœ€å¤§é«˜ã•ã‚’åˆ¶é™ */
            overflow-y: auto;                     /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã« */
        }

        /*
        ----------------------------------------------------------------------
          ã‚µãƒãƒªãƒ¼ï¼ˆé›†è¨ˆæƒ…å ±ï¼‰è¡¨ç¤º
        ----------------------------------------------------------------------
        */
        .summary {
            background: #e3f2fd;                  /* è–„ã„é’ã®èƒŒæ™¯ */
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .summary span {
            margin-right: 20px;                   /* é …ç›®é–“ã®ã‚¹ãƒšãƒ¼ã‚¹ */
        }

        /*
        ----------------------------------------------------------------------
          ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        ----------------------------------------------------------------------
        */
        .error {
            background: #ffebee;                  /* è–„ã„èµ¤ã®èƒŒæ™¯ */
            color: #c62828;                       /* èµ¤ã„æ–‡å­— */
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }

        /*
        ----------------------------------------------------------------------
          ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
        ----------------------------------------------------------------------
        */
        .loading {
            text-align: center;
            padding: 20px;
        }

        /*
         * ::after ã¯ç–‘ä¼¼è¦ç´ ï¼ˆè¦ç´ ã®å¾Œã‚ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ï¼‰
         * ã“ã“ã§ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ã‚’ä½œæˆ
         */
        .loading::after {
            content: '';                          /* ç©ºã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #4a90d9;            /* é’ã„å†† */
            border-radius: 50%;                   /* å®Œå…¨ãªå††å½¢ã« */
            border-top-color: transparent;        /* ä¸Šéƒ¨ã‚’é€æ˜ã«ï¼ˆå›è»¢åŠ¹æœã®ãŸã‚ï¼‰ */
            animation: spin 1s linear infinite;   /* spinã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’1ç§’ã§ç„¡é™ãƒ«ãƒ¼ãƒ— */
            margin-left: 10px;
            vertical-align: middle;               /* ç¸¦æ–¹å‘ä¸­å¤®æƒãˆ */
        }

        /*
         * @keyframes: CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®šç¾©
         * ã€Œspinã€ã¨ã„ã†åå‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
         * 0%ã‹ã‚‰100%ã¾ã§360åº¦å›è»¢ã™ã‚‹
         */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /*
        ----------------------------------------------------------------------
          ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ï¼ˆæ±ç”¨çš„ãªã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
        ----------------------------------------------------------------------
        */
        /* è¦ç´ ã‚’éè¡¨ç¤ºã«ã™ã‚‹ */
        .hidden {
            display: none;
        }

        /* éšå±¤ã‚’ç¤ºã™ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼ˆã‚°ãƒ¬ãƒ¼ã®ç©ºç™½ï¼‰ */
        .level-indent {
            color: #999;
        }

        /*
        ----------------------------------------------------------------------
          ãƒ•ãƒƒã‚¿ãƒ¼
        ----------------------------------------------------------------------
        */
        footer {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 30px;
        }
    </style>
</head>

<body>
    <!--
    ==========================================================================
      <body>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ - ãƒšãƒ¼ã‚¸ã®å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„

      ã€HTMLã‚¿ã‚°ã®åŸºæœ¬ã€‘
      <ã‚¿ã‚°å å±æ€§="å€¤">å†…å®¹</ã‚¿ã‚°å>

      ä¾‹: <div class="container">Hello</div>
          â†’ divã‚¿ã‚°ã«containerã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸ã€ä¸­èº«ã¯ã€ŒHelloã€

      ã€ã‚ˆãä½¿ã†ã‚¿ã‚°ã€‘
      <div>  : ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ ï¼ˆç®±ï¼‰ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”¨
      <span> : ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¦ç´ ã€ãƒ†ã‚­ã‚¹ãƒˆã®ä¸€éƒ¨ã‚’è£…é£¾
      <h1>~<h6> : è¦‹å‡ºã—ï¼ˆh1ãŒæœ€ã‚‚å¤§ãã„ï¼‰
      <p>    : æ®µè½
      <button> : ãƒœã‚¿ãƒ³
      <table>, <tr>, <th>, <td> : ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¡¨ï¼‰
    ==========================================================================
    -->

    <!-- ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ« -->
    <h1>PDF ã—ãŠã‚Šæ¤œè¨¼ãƒ„ãƒ¼ãƒ«</h1>

    <!--
    ========================================
      ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³
    ========================================
    -->
    <div class="container">
        <h2>PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</h2>

        <!--
        ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³
        id="dropZone" : JavaScriptã‹ã‚‰ã“ã®è¦ç´ ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ID
        -->
        <div class="drop-zone" id="dropZone">
            <div class="icon">ğŸ“„</div>
            <!--
            <br>ã‚¿ã‚°: æ”¹è¡Œ
            -->
            <p>ã“ã“ã«PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
        </div>

        <!--
        ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ï¼ˆéè¡¨ç¤ºï¼‰
        type="file" : ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠç”¨ã®å…¥åŠ›
        accept=".pdf" : PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿é¸æŠå¯èƒ½
        -->
        <input type="file" id="fileInput" accept=".pdf">

        <!-- é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
        <div class="file-info" id="fileInfo"></div>

        <!--
        ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—
        disabledå±æ€§: ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ããªã„çŠ¶æ…‹ï¼‰
        -->
        <div class="button-group">
            <button id="validateBtn" disabled>ã—ãŠã‚Šæ¤œè¨¼</button>
            <button id="clearBtn" class="secondary" disabled>ã‚¯ãƒªã‚¢</button>
        </div>
    </div>

    <!--
    ========================================
      æ¤œè¨¼çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤ºï¼‰
    ========================================
    -->
    <div class="container hidden" id="resultContainer">
        <h2>æ¤œè¨¼çµæœ</h2>

        <!-- ã‚µãƒãƒªãƒ¼ï¼ˆé›†è¨ˆæƒ…å ±ï¼‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="summary" id="summary"></div>

        <div class="button-group">
            <button id="csvBtn">CSVå‡ºåŠ›</button>
        </div>

        <!--
        ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¡¨ï¼‰
        <table> : ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“
          <thead> : ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†
            <tr> : è¡Œï¼ˆtable rowï¼‰
              <th> : ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ãƒ«ï¼ˆtable headerï¼‰
          <tbody> : ãƒ‡ãƒ¼ã‚¿éƒ¨åˆ†
            <tr> : è¡Œ
              <td> : ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ«ï¼ˆtable dataï¼‰
        -->
        <div class="result-container">
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>ã—ãŠã‚Šå</th>
                        <th>éšå±¤</th>
                        <th>ãƒªãƒ³ã‚¯å…ˆãƒšãƒ¼ã‚¸</th>
                        <th>åˆ¤å®š</th>
                    </tr>
                </thead>
                <!-- tbodyã®ä¸­èº«ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                <tbody id="resultBody"></tbody>
            </table>
        </div>
    </div>

    <!--
    ========================================
      ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤ºï¼‰
    ========================================
    -->
    <div class="container hidden" id="errorContainer">
        <div class="error" id="errorMessage"></div>
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer>
        PDF ã—ãŠã‚Šæ¤œè¨¼ãƒ„ãƒ¼ãƒ« - å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸è¦ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ
    </footer>

    <!--
    ==========================================================================
      <script>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ - JavaScriptï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰

      ã€JavaScriptã®åŸºæœ¬ã€‘
      ãƒ»å¤‰æ•°å®£è¨€: letï¼ˆå¤‰æ›´å¯èƒ½ï¼‰, constï¼ˆå¤‰æ›´ä¸å¯ï¼‰
      ãƒ»é–¢æ•°å®šç¾©: function åå‰() { å‡¦ç† }
      ãƒ»ã‚¢ãƒ­ãƒ¼é–¢æ•°: (å¼•æ•°) => { å‡¦ç† }  â€»çœç•¥å½¢ã®é–¢æ•°è¨˜æ³•
      ãƒ»DOMæ“ä½œ: HTMLè¦ç´ ã‚’JavaScriptã§æ“ä½œã™ã‚‹
      ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œï¼ˆã‚¯ãƒªãƒƒã‚¯ã€ãƒ‰ãƒ©ãƒƒã‚°ãªã©ï¼‰ã‚’æ¤œçŸ¥
    ==========================================================================
    -->
    <script>
        /*
        ======================================================================
          ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
          ãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ã§ä½¿ã†å¤‰æ•°ã‚’å®šç¾©
        ======================================================================
        */

        // let: å¾Œã‹ã‚‰å€¤ã‚’å¤‰æ›´ã§ãã‚‹å¤‰æ•°
        // null: ã€Œä½•ã‚‚ãªã„ã€ã¨ã„ã†æ„å‘³ã®ç‰¹åˆ¥ãªå€¤
        let selectedFile = null;  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸPDFãƒ•ã‚¡ã‚¤ãƒ«
        let bookmarks = [];       // æŠ½å‡ºã—ãŸã—ãŠã‚Šæƒ…å ±ã‚’æ ¼ç´ã™ã‚‹é…åˆ—

        /*
        ======================================================================
          DOMè¦ç´ ã®å–å¾—

          document.getElementById('IDå')
          â†’ HTMLã®ä¸­ã‹ã‚‰ã€æŒ‡å®šã—ãŸIDã‚’æŒã¤è¦ç´ ã‚’å–å¾—ã—ã¾ã™

          const: å¤‰æ›´ä¸å¯ã®å¤‰æ•°ï¼ˆå†ä»£å…¥ç¦æ­¢ï¼‰
          å–å¾—ã—ãŸè¦ç´ è‡ªä½“ã¯å¤‰æ›´ã—ãªã„ã®ã§constã‚’ä½¿ç”¨
        ======================================================================
        */
        const dropZone = document.getElementById('dropZone');         // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³
        const fileInput = document.getElementById('fileInput');       // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›
        const fileInfo = document.getElementById('fileInfo');         // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º
        const validateBtn = document.getElementById('validateBtn');   // æ¤œè¨¼ãƒœã‚¿ãƒ³
        const clearBtn = document.getElementById('clearBtn');         // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³
        const csvBtn = document.getElementById('csvBtn');             // CSVå‡ºåŠ›ãƒœã‚¿ãƒ³
        const resultContainer = document.getElementById('resultContainer');  // çµæœã‚³ãƒ³ãƒ†ãƒŠ
        const resultBody = document.getElementById('resultBody');     // çµæœãƒ†ãƒ¼ãƒ–ãƒ«ã®body
        const summary = document.getElementById('summary');           // ã‚µãƒãƒªãƒ¼
        const errorContainer = document.getElementById('errorContainer');    // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ
        const errorMessage = document.getElementById('errorMessage'); // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

        /*
        ======================================================================
          ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š

          è¦ç´ .addEventListener('ã‚¤ãƒ™ãƒ³ãƒˆå', å®Ÿè¡Œã™ã‚‹é–¢æ•°)
          â†’ æŒ‡å®šã—ãŸã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã¨ãã«ã€é–¢æ•°ã‚’å®Ÿè¡Œã—ã¾ã™

          ã€ä¸»ãªã‚¤ãƒ™ãƒ³ãƒˆã€‘
          'click'     : ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ã
          'change'    : å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ã
          'dragover'  : è¦ç´ ã®ä¸Šã«ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã¨ã
          'dragleave' : ãƒ‰ãƒ©ãƒƒã‚°ãŒè¦ç´ ã‹ã‚‰é›¢ã‚ŒãŸã¨ã
          'drop'      : ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸã¨ã
        ======================================================================
        */

        /*
        ----------------------------------------------------------------------
          ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
          ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰ã€éš ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆç™ºç«ï¼‰ã•ã›ã‚‹
        ----------------------------------------------------------------------
        */
        // () => {} ã¯ã‚¢ãƒ­ãƒ¼é–¢æ•°ï¼ˆç„¡åé–¢æ•°ã®çœç•¥å½¢ï¼‰
        dropZone.addEventListener('click', () => fileInput.click());

        /*
        ----------------------------------------------------------------------
          ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸Šã«ä¹—ã›ã¦ã„ã‚‹ã¨ãï¼‰
        ----------------------------------------------------------------------
        */
        dropZone.addEventListener('dragover', (e) => {
            // e.preventDefault(): ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’ç„¡åŠ¹åŒ–
            // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚’è‡ªåˆ†ã§å‡¦ç†ã™ã‚‹ãŸã‚ã«å¿…è¦
            e.preventDefault();

            // classList.add(): ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            // 'dragover'ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦ã€CSSã§ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´
            dropZone.classList.add('dragover');
        });

        /*
        ----------------------------------------------------------------------
          ãƒ‰ãƒ©ãƒƒã‚°ãƒªãƒ¼ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ‰ãƒ©ãƒƒã‚°ãŒè¦ç´ ã‹ã‚‰é›¢ã‚ŒãŸã¨ãï¼‰
        ----------------------------------------------------------------------
        */
        dropZone.addEventListener('dragleave', () => {
            // classList.remove(): ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            dropZone.classList.remove('dragover');
        });

        /*
        ----------------------------------------------------------------------
          ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸã¨ãï¼‰
        ----------------------------------------------------------------------
        */
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’ç„¡åŠ¹åŒ–
            dropZone.classList.remove('dragover');

            // e.dataTransfer.files: ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§
            const files = e.dataTransfer.files;

            // ãƒ•ã‚¡ã‚¤ãƒ«ãŒ1ã¤ä»¥ä¸Šã‚ã‚Šã€PDFãƒ•ã‚¡ã‚¤ãƒ«ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
            if (files.length > 0 && files[0].type === 'application/pdf') {
                handleFile(files[0]);  // ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†é–¢æ•°ã‚’å‘¼ã³å‡ºã—
            } else {
                showError('PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
            }
        });

        /*
        ----------------------------------------------------------------------
          ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã®changeã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸã¨ãï¼‰
        ----------------------------------------------------------------------
        */
        fileInput.addEventListener('change', (e) => {
            // e.target: ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸè¦ç´ ï¼ˆfileInputè‡ªèº«ï¼‰
            // e.target.files: é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        /*
        ======================================================================
          ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†

          function é–¢æ•°å(å¼•æ•°) { å‡¦ç† }
          â†’ é–¢æ•°ã®å®šç¾©ã€‚å‘¼ã³å‡ºã™ã¾ã§å®Ÿè¡Œã•ã‚Œãªã„
        ======================================================================
        */
        function handleFile(file) {
            // é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
            selectedFile = file;

            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«: ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆ(``)ã§å›²ã‚€
            // ${å¤‰æ•°å} ã§å¤‰æ•°ã®å€¤ã‚’åŸ‹ã‚è¾¼ã‚ã‚‹
            fileInfo.innerHTML = `<strong>é¸æŠãƒ•ã‚¡ã‚¤ãƒ«:</strong> ${file.name} (${formatFileSize(file.size)})`;

            // ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦è¡¨ç¤ºçŠ¶æ…‹ã«
            fileInfo.classList.add('show');

            // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ï¼ˆdisabledå±æ€§ã‚’è§£é™¤ï¼‰
            validateBtn.disabled = false;
            clearBtn.disabled = false;

            // ã‚¨ãƒ©ãƒ¼ã¨çµæœã‚’éè¡¨ç¤ºã«
            hideError();
            resultContainer.classList.add('hidden');
        }

        /*
        ======================================================================
          ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆèª­ã¿ã‚„ã™ã„å½¢å¼ã«å¤‰æ›ï¼‰

          ä¾‹: 1024 â†’ "1.0 KB"
              1048576 â†’ "1.0 MB"
        ======================================================================
        */
        function formatFileSize(bytes) {
            // æ¡ä»¶åˆ†å²: if (æ¡ä»¶) { å‡¦ç† }
            // return: é–¢æ•°ã®çµæœã‚’è¿”ã—ã¦çµ‚äº†
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            // toFixed(1): å°æ•°ç‚¹ä»¥ä¸‹1æ¡ã«ä¸¸ã‚ã‚‹
        }

        /*
        ======================================================================
          æ¤œè¨¼ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ

          async/await: éåŒæœŸå‡¦ç†ã‚’åŒæœŸçš„ã«æ›¸ã‘ã‚‹æ§‹æ–‡
          â†’ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãªã©ã€æ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†ã§ä½¿ç”¨
        ======================================================================
        */
        validateBtn.addEventListener('click', async () => {
            // ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
            if (!selectedFile) return;

            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã€ãƒ†ã‚­ã‚¹ãƒˆã‚’ã€Œè§£æä¸­...ã€ã«
            validateBtn.disabled = true;
            validateBtn.innerHTML = 'è§£æä¸­...';
            hideError();

            // try-catch: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹å‡¦ç†ã‚’å›²ã‚€
            // ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‚‰catchãƒ–ãƒ­ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹
            try {
                // await: å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…æ©Ÿ
                // arrayBuffer(): ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦èª­ã¿è¾¼ã‚€
                const arrayBuffer = await selectedFile.arrayBuffer();

                // PDFè§£æã‚’å®Ÿè¡Œ
                bookmarks = parsePDFBookmarks(arrayBuffer);

                // çµæœã‚’è¡¨ç¤º
                displayResults();
            } catch (error) {
                // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆ
                showError(error.message);
            } finally {
                // finally: æˆåŠŸãƒ»å¤±æ•—ã«é–¢ã‚ã‚‰ãšæœ€å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹
                validateBtn.disabled = false;
                validateBtn.innerHTML = 'ã—ãŠã‚Šæ¤œè¨¼';
            }
        });

        /*
        ======================================================================
          ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        ======================================================================
        */
        clearBtn.addEventListener('click', () => {
            // ã™ã¹ã¦ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            selectedFile = null;
            bookmarks = [];
            fileInput.value = '';  // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
            fileInfo.classList.remove('show');
            validateBtn.disabled = true;
            clearBtn.disabled = true;
            resultContainer.classList.add('hidden');
            hideError();
        });

        /*
        ======================================================================
          CSVå‡ºåŠ›ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ

          CSVãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã‚’ç”Ÿæˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        ======================================================================
        */
        csvBtn.addEventListener('click', () => {
            // ã—ãŠã‚ŠãŒãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
            if (bookmarks.length === 0) return;

            // BOMï¼ˆByte Order Markï¼‰: Excelã§é–‹ã„ãŸã¨ãã«æ–‡å­—åŒ–ã‘ã‚’é˜²ã
            let csv = '\uFEFF';
            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
            csv += 'No,ã—ãŠã‚Šå,éšå±¤,ãƒªãƒ³ã‚¯å…ˆãƒšãƒ¼ã‚¸,åˆ¤å®š\n';

            // forEach: é…åˆ—ã®å„è¦ç´ ã«å¯¾ã—ã¦å‡¦ç†ã‚’å®Ÿè¡Œ
            // bm: å„ã—ãŠã‚Šã€i: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0ã‹ã‚‰å§‹ã¾ã‚‹ç•ªå·ï¼‰
            bookmarks.forEach((bm, i) => {
                // ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆ""ã«å¤‰æ›ï¼‰
                const title = bm.title.replace(/"/g, '""');
                // ä¸‰é …æ¼”ç®—å­: æ¡ä»¶ ? çœŸã®å ´åˆ : å½ã®å ´åˆ
                const status = bm.page ? 'OK' : 'ç¢ºèªè¦';
                // CSVã®1è¡Œã‚’è¿½åŠ 
                csv += `${i + 1},"${title}",${bm.level},${bm.page || ''},${status}\n`;
            });

            // Blob: ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });

            // URL.createObjectURL: Blobã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLã‚’ç”Ÿæˆ
            const url = URL.createObjectURL(blob);

            // ä»®æƒ³çš„ãªãƒªãƒ³ã‚¯è¦ç´ ã‚’ä½œæˆã—ã¦ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œï¼‰
            const a = document.createElement('a');
            a.href = url;
            a.download = `ã—ãŠã‚Šæ¤œè¨¼çµæœ_${formatDate(new Date())}.csv`;
            a.click();

            // ä½¿ç”¨æ¸ˆã¿ã®URLã‚’è§£æ”¾ï¼ˆãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢ï¼‰
            URL.revokeObjectURL(url);
        });

        /*
        ======================================================================
          æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
          Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ "yyyymmdd_hhmm" å½¢å¼ã®æ–‡å­—åˆ—ã«å¤‰æ›
        ======================================================================
        */
        function formatDate(date) {
            const y = date.getFullYear();                           // å¹´ï¼ˆ4æ¡ï¼‰
            const m = String(date.getMonth() + 1).padStart(2, '0'); // æœˆï¼ˆ01-12ï¼‰
            const d = String(date.getDate()).padStart(2, '0');      // æ—¥ï¼ˆ01-31ï¼‰
            const h = String(date.getHours()).padStart(2, '0');     // æ™‚ï¼ˆ00-23ï¼‰
            const min = String(date.getMinutes()).padStart(2, '0'); // åˆ†ï¼ˆ00-59ï¼‰
            // padStart(2, '0'): 2æ¡ã«ãªã‚‹ã‚ˆã†ã«å·¦å´ã‚’'0'ã§åŸ‹ã‚ã‚‹
            return `${y}${m}${d}_${h}${min}`;
        }

        /*
        ======================================================================
          ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºé–¢æ•°
        ======================================================================
        */
        function showError(message) {
            // æ”¹è¡Œã‚’<br>ã«å¤‰æ›ã—ã¦HTMLã¨ã—ã¦è¨­å®šï¼ˆè¤‡æ•°è¡Œã‚¨ãƒ©ãƒ¼å¯¾å¿œï¼‰
            errorMessage.innerHTML = message.replace(/\n/g, '<br>');
            errorContainer.classList.remove('hidden');  // è¡¨ç¤º
            resultContainer.classList.add('hidden');    // çµæœã¯éè¡¨ç¤º
        }

        function hideError() {
            errorContainer.classList.add('hidden');
        }

        /*
        ======================================================================
          çµæœè¡¨ç¤ºé–¢æ•°
          æŠ½å‡ºã—ãŸã—ãŠã‚Šæƒ…å ±ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤º
        ======================================================================
        */
        function displayResults() {
            // ã—ãŠã‚ŠãŒãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
            if (bookmarks.length === 0) {
                showError('ã“ã®PDFã«ã¯ã—ãŠã‚ŠãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }

            // filter: æ¡ä»¶ã«åˆã†è¦ç´ ã ã‘ã‚’æŠ½å‡º
            // b => b.page ã¯ b.page ãŒçœŸï¼ˆå€¤ãŒã‚ã‚‹ï¼‰ãªã‚‰ true
            const okCount = bookmarks.filter(b => b.page).length;
            const warningCount = bookmarks.length - okCount;

            // ã‚µãƒãƒªãƒ¼ã‚’æ›´æ–°ï¼ˆinnerHTML: HTMLæ–‡å­—åˆ—ã‚’è¨­å®šï¼‰
            summary.innerHTML = `
                <span><strong>ç·ã—ãŠã‚Šæ•°:</strong> ${bookmarks.length}</span>
                <span style="color: #006100;"><strong>OK:</strong> ${okCount}</span>
                <span style="color: #9c5700;"><strong>ç¢ºèªè¦:</strong> ${warningCount}</span>
            `;

            // ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸­èº«ã‚’ã‚¯ãƒªã‚¢
            resultBody.innerHTML = '';

            // å„ã—ãŠã‚Šã«å¯¾ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œã‚’ç”Ÿæˆ
            bookmarks.forEach((bm, i) => {
                // æ–°ã—ã„trè¦ç´ ã‚’ä½œæˆ
                const tr = document.createElement('tr');
                const status = bm.page ? 'OK' : 'ç¢ºèªè¦';
                const statusClass = bm.page ? 'status-ok' : 'status-warning';
                // repeat(): æ–‡å­—åˆ—ã‚’æŒ‡å®šå›æ•°ç¹°ã‚Šè¿”ã™ï¼ˆã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆç”¨ï¼‰
                const indent = 'ã€€'.repeat(bm.level - 1);

                // trè¦ç´ ã®ä¸­èº«ï¼ˆã‚»ãƒ«ï¼‰ã‚’HTMLæ–‡å­—åˆ—ã§è¨­å®š
                tr.innerHTML = `
                    <td>${i + 1}</td>
                    <td><span class="level-indent">${indent}</span>${escapeHtml(bm.title)}</td>
                    <td>${bm.level}</td>
                    <td>${bm.page || '-'}</td>
                    <td class="${statusClass}">${status}</td>
                `;

                // ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡Œã‚’è¿½åŠ 
                resultBody.appendChild(tr);
            });

            // çµæœã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
            resultContainer.classList.remove('hidden');
        }

        /*
        ======================================================================
          HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°

          ç‰¹æ®Šæ–‡å­—ï¼ˆ<, >, &ãªã©ï¼‰ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã€
          HTMLã¨ã—ã¦è§£é‡ˆã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ˆXSSå¯¾ç­–ï¼‰
        ======================================================================
        */
        function escapeHtml(text) {
            // divè¦ç´ ã‚’ä¸€æ™‚çš„ã«ä½œæˆ
            const div = document.createElement('div');
            // textContentã«è¨­å®šã™ã‚‹ã¨è‡ªå‹•çš„ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã‚‹
            div.textContent = text;
            // innerHTMLã§å–å¾—ã™ã‚‹ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸæ–‡å­—åˆ—ãŒå¾—ã‚‰ã‚Œã‚‹
            return div.innerHTML;
        }

        /*
        ======================================================================
          PDFè§£æãƒ¡ã‚¤ãƒ³é–¢æ•°

          PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã—ãŠã‚Šæƒ…å ±ã‚’æŠ½å‡º
        ======================================================================
        */
        function parsePDFBookmarks(arrayBuffer) {
            console.log('[parsePDFBookmarks] è§£æé–‹å§‹');

            // Uint8Array: ãƒã‚¤ãƒˆé…åˆ—ï¼ˆ0-255ã®æ•°å€¤ã®é…åˆ—ï¼‰
            const bytes = new Uint8Array(arrayBuffer);
            console.log('[parsePDFBookmarks] PDFã‚µã‚¤ã‚º:', bytes.length, 'bytes');

            // ãƒã‚¤ãƒŠãƒªã‚’Latin-1æ–‡å­—åˆ—ã«å¤‰æ›ï¼ˆPDFå†…éƒ¨ã®æ¤œç´¢ç”¨ï¼‰
            let content = latin1Decode(bytes);

            // PDFãƒ•ã‚¡ã‚¤ãƒ«ã‹ã©ã†ã‹ã‚’ç¢ºèª
            if (!content.startsWith('%PDF-')) {
                throw new Error('æœ‰åŠ¹ãªPDFãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
            }

            // åœ§ç¸®ã•ã‚ŒãŸã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è§£å‡ã—ã¦è¿½åŠ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å–å¾—
            try {
                const decompressedContent = decompressAllStreams(content, bytes);
                if (decompressedContent) {
                    content = content + '\n' + decompressedContent;
                }
            } catch (e) {
                // è§£å‡ã«å¤±æ•—ã—ã¦ã‚‚ç¶šè¡Œï¼ˆéåœ§ç¸®éƒ¨åˆ†ã‹ã‚‰ã—ãŠã‚Šã‚’æ¢ã™ï¼‰
            }

            // ã—ãŠã‚Šï¼ˆOutlinesï¼‰ã®å­˜åœ¨ç¢ºèª
            // Acrobatç”Ÿæˆã®PDFã§ã¯æ§˜ã€…ãªå½¢å¼ã§ã—ãŠã‚ŠãŒæ ¼ç´ã•ã‚Œã‚‹
            const hasOutlines = content.match(/\/Outlines\s+\d+\s+\d+\s+R/) ||
                               content.match(/\/Type\s*\/Outlines/) ||
                               content.match(/\/Title\s*[\(<]/) ||
                               content.match(/\/Names\s*<</) ||
                               content.match(/\/Dests\s+\d+\s+\d+\s+R/) ||
                               content.match(/\/OpenAction/) ||
                               content.match(/\/First\s+\d+\s+\d+\s+R/);

            if (!hasOutlines) {
                throw new Error('ã“ã®PDFã«ã¯ã—ãŠã‚ŠãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
            }

            // ãƒšãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒšãƒ¼ã‚¸ç•ªå·ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ä½œæˆ
            const pageObjects = buildPageMapping(content);

            // ã—ãŠã‚Šæƒ…å ±ã‚’æŠ½å‡º
            console.log('[parsePDFBookmarks] ã—ãŠã‚ŠæŠ½å‡ºé–‹å§‹');
            const bookmarks = extractBookmarks(content, bytes, pageObjects);
            console.log('[parsePDFBookmarks] æŠ½å‡ºå®Œäº†:', bookmarks.length, 'ä»¶');

            if (bookmarks.length === 0) {
                // ã—ãŠã‚Šã®æ§‹é€ ã¯è¦‹ã¤ã‹ã£ãŸãŒæŠ½å‡ºã§ããªã‹ã£ãŸå ´åˆ
                // è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã‚’è©³ç´°ã«èª¬æ˜
                let errorDetails = 'ã—ãŠã‚Šã®æŠ½å‡ºã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\n';
                errorDetails += 'ã€è€ƒãˆã‚‰ã‚Œã‚‹åŸå› ã€‘\n';
                errorDetails += 'ãƒ»PDFãŒæš—å·åŒ–ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·ã•ã‚Œã¦ã„ã‚‹\n';
                errorDetails += 'ãƒ»ã—ãŠã‚ŠãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ å†…ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹\n';
                errorDetails += 'ãƒ»Acrobatå›ºæœ‰ã®å½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã‚‹\n\n';
                errorDetails += 'ã€å¯¾å‡¦æ–¹æ³•ã€‘\n';
                errorDetails += 'ãƒ»Adobe Acrobatã§ã€Œåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã€â†’ã€Œæœ€é©åŒ–ã•ã‚ŒãŸPDFã€ã§å†ä¿å­˜\n';
                errorDetails += 'ãƒ»PDFã®æš—å·åŒ–ã‚’è§£é™¤ã—ã¦ã‹ã‚‰å†åº¦èª­ã¿è¾¼ã¿';
                throw new Error(errorDetails);
            }

            return bookmarks;
        }

        /*
        ======================================================================
          FlateDecodeï¼ˆDeflateåœ§ç¸®ï¼‰ã•ã‚ŒãŸã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã™ã¹ã¦è§£å‡

          PDFã§ã¯å¤šãã®å ´åˆã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ãŒDeflateåœ§ç¸®ã•ã‚Œã¦ã„ã¾ã™ã€‚
          ã“ã®é–¢æ•°ã¯ã™ã¹ã¦ã®åœ§ç¸®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’æ¤œå‡ºã—ã€è§£å‡ã‚’è©¦ã¿ã¾ã™ã€‚
        ======================================================================
        */
        function decompressAllStreams(content, bytes) {
            let decompressedParts = [];

            // æ–¹æ³•1: stream/endstream ã‚’ç›´æ¥æ¤œç´¢ã—ã¦è§£å‡ã‚’è©¦ã¿ã‚‹
            const streamMarkerPattern = /stream\r?\n/g;
            let match;

            while ((match = streamMarkerPattern.exec(content)) !== null) {
                try {
                    const streamStart = match.index + match[0].length;

                    // ã“ã®streamã®å‰ã«ã‚ã‚‹è¾æ›¸ã‚’ç¢ºèªï¼ˆFlateDecodeã‹ã©ã†ã‹ï¼‰
                    const beforeStream = content.substring(Math.max(0, match.index - 500), match.index);

                    // FlateDecodeãƒ•ã‚£ãƒ«ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèªï¼ˆASCIIHexDecodeã¨ã®çµ„ã¿åˆã‚ã›ã‚‚å«ã‚€ï¼‰
                    const hasFlate = beforeStream.match(/\/Filter\s*(?:\/FlateDecode|\[\s*(?:\/[A-Za-z]+Decode\s+)*\/FlateDecode)/);
                    if (!hasFlate) {
                        continue;
                    }

                    // /Length ã‚’å–å¾—ã—ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒ é•·ã‚’ç¢ºå®š
                    const lengthMatch = beforeStream.match(/\/Length\s+(\d+)/);
                    let streamEnd;

                    if (lengthMatch) {
                        const declaredLength = parseInt(lengthMatch[1]);
                        streamEnd = streamStart + declaredLength;
                    } else {
                        // endstream ã‚’æ¢ã—ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®çµ‚ç«¯ã‚’è¦‹ã¤ã‘ã‚‹
                        const endstreamPos = content.indexOf('endstream', streamStart);
                        if (endstreamPos === -1) continue;

                        // ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºï¼ˆæœ«å°¾ã®æ”¹è¡Œã‚’é™¤å»ï¼‰
                        streamEnd = endstreamPos;
                        if (content.charCodeAt(streamEnd - 1) === 10) streamEnd--;
                        if (content.charCodeAt(streamEnd - 1) === 13) streamEnd--;
                    }

                    const streamLength = streamEnd - streamStart;
                    if (streamLength <= 0 || streamLength > 10000000) continue;

                    const streamData = bytes.slice(streamStart, streamEnd);

                    // Deflateè§£å‡ã‚’è¤‡æ•°ã®æ–¹æ³•ã§è©¦è¡Œ
                    let decompressed = null;

                    // è©¦è¡Œ1: æ¨™æº–ã®inflateRaw
                    try {
                        decompressed = inflateRaw(streamData);
                    } catch (e1) {
                        // è©¦è¡Œ2: zlibãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ãªã„
                        try {
                            decompressed = inflateRaw(streamData.slice(0));
                        } catch (e2) {
                            // è©¦è¡Œ3: å…ˆé ­ãƒã‚¤ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—
                            try {
                                if (streamData.length > 2) {
                                    decompressed = inflateRaw(streamData.slice(2));
                                }
                            } catch (e3) {
                                // ã™ã¹ã¦å¤±æ•—
                            }
                        }
                    }

                    if (decompressed && decompressed.length > 0) {
                        const decompressedStr = latin1Decode(decompressed);
                        // ã—ãŠã‚Šé–¢é€£ã®æƒ…å ±ã‚’å«ã‚€å ´åˆã®ã¿è¿½åŠ 
                        if (decompressedStr.includes('/Title') ||
                            decompressedStr.includes('/Outlines') ||
                            decompressedStr.includes('/First') ||
                            decompressedStr.includes('/Last') ||
                            decompressedStr.includes('/Dest') ||
                            decompressedStr.includes('/A ') ||
                            decompressedStr.includes('/Names')) {
                            decompressedParts.push(decompressedStr);
                        }
                    }
                } catch (e) {
                    // è§£å‡ã«å¤±æ•—ã—ãŸå ´åˆã¯ç„¡è¦–ã—ã¦ç¶šè¡Œ
                }
            }

            return decompressedParts.join('\n');
        }

        /*
        ======================================================================
          Deflateè§£å‡ï¼ˆinflateï¼‰ã®ç´”ç²‹JavaScriptå®Ÿè£…

          RFC 1951ã«æº–æ‹ ã—ãŸDeflateè§£å‡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
          å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã›ãšã€ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–æ©Ÿèƒ½ã®ã¿ã§å‹•ä½œ

          ã€Deflateã®ä»•çµ„ã¿ã€‘
          1. ãƒãƒ•ãƒãƒ³ç¬¦å·åŒ–: é »å‡ºæ–‡å­—ã‚’çŸ­ã„ãƒ“ãƒƒãƒˆåˆ—ã§è¡¨ç¾
          2. LZ77åœ§ç¸®: ç¹°ã‚Šè¿”ã—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã€Œè·é›¢ã¨é•·ã•ã€ã§è¡¨ç¾
        ======================================================================
        */

        // ãƒ“ãƒƒãƒˆãƒªãƒ¼ãƒ€ãƒ¼ã‚¯ãƒ©ã‚¹: ãƒã‚¤ãƒˆé…åˆ—ã‹ã‚‰ãƒ“ãƒƒãƒˆå˜ä½ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹
        class BitReader {
            constructor(data) {
                this.data = data;      // å…¥åŠ›ãƒã‚¤ãƒˆé…åˆ—
                this.bytePos = 0;      // ç¾åœ¨ã®ãƒã‚¤ãƒˆä½ç½®
                this.bitPos = 0;       // ç¾åœ¨ã®ãƒ“ãƒƒãƒˆä½ç½®ï¼ˆ0-7ï¼‰
            }

            // æŒ‡å®šãƒ“ãƒƒãƒˆæ•°ã‚’èª­ã¿å–ã‚‹ï¼ˆæœ€ä¸‹ä½ãƒ“ãƒƒãƒˆã‹ã‚‰ï¼‰
            readBits(n) {
                let result = 0;
                let bitsRead = 0;

                while (bitsRead < n) {
                    if (this.bytePos >= this.data.length) {
                        throw new Error('Unexpected end of data');
                    }

                    // ç¾åœ¨ã®ãƒã‚¤ãƒˆã‹ã‚‰èª­ã¿å–ã‚Œã‚‹ãƒ“ãƒƒãƒˆæ•°
                    const bitsAvailable = 8 - this.bitPos;
                    const bitsToRead = Math.min(n - bitsRead, bitsAvailable);

                    // ãƒ“ãƒƒãƒˆã‚’æŠ½å‡º
                    const mask = (1 << bitsToRead) - 1;
                    const bits = (this.data[this.bytePos] >> this.bitPos) & mask;

                    result |= bits << bitsRead;
                    bitsRead += bitsToRead;
                    this.bitPos += bitsToRead;

                    // æ¬¡ã®ãƒã‚¤ãƒˆã¸
                    if (this.bitPos >= 8) {
                        this.bitPos = 0;
                        this.bytePos++;
                    }
                }

                return result;
            }

            // ãƒã‚¤ãƒˆå¢ƒç•Œã¾ã§é€²ã‚ã‚‹
            alignToByte() {
                if (this.bitPos > 0) {
                    this.bitPos = 0;
                    this.bytePos++;
                }
            }
        }

        // ãƒãƒ•ãƒãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ§‹ç¯‰
        function buildHuffmanTable(codeLengths) {
            const maxLen = Math.max(...codeLengths.filter(l => l > 0));
            if (maxLen === 0) return null;

            // å„ã‚³ãƒ¼ãƒ‰é•·ã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const blCount = new Array(maxLen + 1).fill(0);
            for (const len of codeLengths) {
                if (len > 0) blCount[len]++;
            }

            // å„ã‚³ãƒ¼ãƒ‰é•·ã®é–‹å§‹ã‚³ãƒ¼ãƒ‰ã‚’è¨ˆç®—
            const nextCode = new Array(maxLen + 1).fill(0);
            let code = 0;
            for (let bits = 1; bits <= maxLen; bits++) {
                code = (code + blCount[bits - 1]) << 1;
                nextCode[bits] = code;
            }

            // ã‚·ãƒ³ãƒœãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’å‰²ã‚Šå½“ã¦
            const table = {};
            for (let symbol = 0; symbol < codeLengths.length; symbol++) {
                const len = codeLengths[symbol];
                if (len > 0) {
                    const huffCode = nextCode[len]++;
                    // ã‚³ãƒ¼ãƒ‰ã‚’é€†é †ãƒ“ãƒƒãƒˆåˆ—ã«å¤‰æ›ï¼ˆDeflateã¯ãƒ“ãƒƒãƒˆé€†é †ï¼‰
                    let reversed = 0;
                    for (let i = 0; i < len; i++) {
                        reversed = (reversed << 1) | ((huffCode >> i) & 1);
                    }
                    table[`${reversed}_${len}`] = symbol;
                }
            }

            return { table, maxLen };
        }

        // ãƒãƒ•ãƒãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã‚·ãƒ³ãƒœãƒ«ã‚’èª­ã¿å–ã‚‹
        function readHuffmanSymbol(reader, huffTable) {
            let code = 0;
            for (let len = 1; len <= huffTable.maxLen; len++) {
                code = (code << 1) | reader.readBits(1);
                const key = `${code}_${len}`;
                if (key in huffTable.table) {
                    return huffTable.table[key];
                }
            }
            throw new Error('Invalid Huffman code');
        }

        // å›ºå®šãƒãƒ•ãƒãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆDeflateè¦æ ¼ã§å®šç¾©ï¼‰
        function getFixedLitLenTable() {
            const lengths = new Array(288);
            for (let i = 0; i <= 143; i++) lengths[i] = 8;
            for (let i = 144; i <= 255; i++) lengths[i] = 9;
            for (let i = 256; i <= 279; i++) lengths[i] = 7;
            for (let i = 280; i <= 287; i++) lengths[i] = 8;
            return buildHuffmanTable(lengths);
        }

        function getFixedDistTable() {
            const lengths = new Array(32).fill(5);
            return buildHuffmanTable(lengths);
        }

        // Deflateè§£å‡ãƒ¡ã‚¤ãƒ³é–¢æ•°
        function inflateRaw(data) {
            // zlibãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ0x78ã§å§‹ã¾ã‚‹å ´åˆï¼‰
            let startOffset = 0;
            if (data.length >= 2 && data[0] === 0x78) {
                startOffset = 2;  // CMF + FLG ã‚’ã‚¹ã‚­ãƒƒãƒ—
            }

            const reader = new BitReader(data.subarray(startOffset));
            const output = [];

            let finalBlock = false;

            while (!finalBlock) {
                // ãƒ–ãƒ­ãƒƒã‚¯ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’èª­ã¿å–ã‚‹
                finalBlock = reader.readBits(1) === 1;  // BFINAL
                const blockType = reader.readBits(2);    // BTYPE

                if (blockType === 0) {
                    // éåœ§ç¸®ãƒ–ãƒ­ãƒƒã‚¯
                    reader.alignToByte();
                    const len = reader.readBits(8) | (reader.readBits(8) << 8);
                    reader.readBits(16);  // NLENï¼ˆè£œæ•°ï¼‰ã‚’ã‚¹ã‚­ãƒƒãƒ—

                    for (let i = 0; i < len; i++) {
                        output.push(reader.readBits(8));
                    }
                } else if (blockType === 1 || blockType === 2) {
                    // åœ§ç¸®ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå›ºå®šã¾ãŸã¯å‹•çš„ãƒãƒ•ãƒãƒ³ï¼‰
                    let litLenTable, distTable;

                    if (blockType === 1) {
                        // å›ºå®šãƒãƒ•ãƒãƒ³ã‚³ãƒ¼ãƒ‰
                        litLenTable = getFixedLitLenTable();
                        distTable = getFixedDistTable();
                    } else {
                        // å‹•çš„ãƒãƒ•ãƒãƒ³ã‚³ãƒ¼ãƒ‰
                        const tables = readDynamicTables(reader);
                        litLenTable = tables.litLen;
                        distTable = tables.dist;
                    }

                    // ãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è§£å‡
                    while (true) {
                        const symbol = readHuffmanSymbol(reader, litLenTable);

                        if (symbol < 256) {
                            // ãƒªãƒ†ãƒ©ãƒ«ãƒã‚¤ãƒˆ
                            output.push(symbol);
                        } else if (symbol === 256) {
                            // ãƒ–ãƒ­ãƒƒã‚¯çµ‚äº†
                            break;
                        } else {
                            // é•·ã•ãƒ»è·é›¢ãƒšã‚¢ï¼ˆLZ77ï¼‰
                            const length = readLength(reader, symbol);
                            const distSymbol = readHuffmanSymbol(reader, distTable);
                            const distance = readDistance(reader, distSymbol);

                            // éå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼
                            const startPos = output.length - distance;
                            for (let i = 0; i < length; i++) {
                                output.push(output[startPos + i]);
                            }
                        }
                    }
                } else {
                    throw new Error('Invalid block type');
                }
            }

            return new Uint8Array(output);
        }

        // å‹•çš„ãƒãƒ•ãƒãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’èª­ã¿å–ã‚‹
        function readDynamicTables(reader) {
            const hlit = reader.readBits(5) + 257;   // ãƒªãƒ†ãƒ©ãƒ«/é•·ã•ã‚³ãƒ¼ãƒ‰ã®æ•°
            const hdist = reader.readBits(5) + 1;    // è·é›¢ã‚³ãƒ¼ãƒ‰ã®æ•°
            const hclen = reader.readBits(4) + 4;    // ã‚³ãƒ¼ãƒ‰é•·ã‚³ãƒ¼ãƒ‰ã®æ•°

            // ã‚³ãƒ¼ãƒ‰é•·ã‚³ãƒ¼ãƒ‰ã®é †åºï¼ˆDeflateè¦æ ¼ï¼‰
            const codeLenOrder = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];

            // ã‚³ãƒ¼ãƒ‰é•·ã®ã‚³ãƒ¼ãƒ‰é•·ã‚’èª­ã¿å–ã‚‹
            const codeLenLengths = new Array(19).fill(0);
            for (let i = 0; i < hclen; i++) {
                codeLenLengths[codeLenOrder[i]] = reader.readBits(3);
            }

            const codeLenTable = buildHuffmanTable(codeLenLengths);

            // ãƒªãƒ†ãƒ©ãƒ«/é•·ã•ã¨è·é›¢ã®ã‚³ãƒ¼ãƒ‰é•·ã‚’èª­ã¿å–ã‚‹
            const allLengths = [];
            while (allLengths.length < hlit + hdist) {
                const symbol = readHuffmanSymbol(reader, codeLenTable);

                if (symbol < 16) {
                    allLengths.push(symbol);
                } else if (symbol === 16) {
                    // ç›´å‰ã®å€¤ã‚’ç¹°ã‚Šè¿”ã™
                    const repeat = reader.readBits(2) + 3;
                    const lastVal = allLengths[allLengths.length - 1] || 0;
                    for (let i = 0; i < repeat; i++) {
                        allLengths.push(lastVal);
                    }
                } else if (symbol === 17) {
                    // 0ã‚’ç¹°ã‚Šè¿”ã™ï¼ˆ3-10å›ï¼‰
                    const repeat = reader.readBits(3) + 3;
                    for (let i = 0; i < repeat; i++) {
                        allLengths.push(0);
                    }
                } else if (symbol === 18) {
                    // 0ã‚’ç¹°ã‚Šè¿”ã™ï¼ˆ11-138å›ï¼‰
                    const repeat = reader.readBits(7) + 11;
                    for (let i = 0; i < repeat; i++) {
                        allLengths.push(0);
                    }
                }
            }

            return {
                litLen: buildHuffmanTable(allLengths.slice(0, hlit)),
                dist: buildHuffmanTable(allLengths.slice(hlit, hlit + hdist))
            };
        }

        // é•·ã•ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å®Ÿéš›ã®é•·ã•ã‚’å–å¾—
        function readLength(reader, symbol) {
            // RFC 1951 ã®é•·ã•ãƒ†ãƒ¼ãƒ–ãƒ«
            const baseLengths = [3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,
                                 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258];
            const extraBits = [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2,
                               3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0];

            const index = symbol - 257;
            if (index < 0 || index >= baseLengths.length) {
                return 3;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            }

            const base = baseLengths[index];
            const extra = extraBits[index];
            return base + (extra > 0 ? reader.readBits(extra) : 0);
        }

        // è·é›¢ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å®Ÿéš›ã®è·é›¢ã‚’å–å¾—
        function readDistance(reader, symbol) {
            // RFC 1951 ã®è·é›¢ãƒ†ãƒ¼ãƒ–ãƒ«
            const baseDistances = [1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,
                                   257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,
                                   8193, 12289, 16385, 24577];
            const extraBits = [0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6,
                               7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13];

            if (symbol < 0 || symbol >= baseDistances.length) {
                return 1;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            }

            const base = baseDistances[symbol];
            const extra = extraBits[symbol];
            return base + (extra > 0 ? reader.readBits(extra) : 0);
        }

        /*
        ======================================================================
          ToUnicode/CMapè§£æé–¢æ•°

          PDFã®CIDãƒ•ã‚©ãƒ³ãƒˆç”¨ToUnicodeã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è§£æã—ã¦ã€
          CIDï¼ˆã‚°ãƒªãƒ•IDï¼‰â†’Unicodeå¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹
          Adobe Acrobat JavaScriptã§ç”Ÿæˆã•ã‚ŒãŸã—ãŠã‚Šã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã«ä½¿ç”¨
        ======================================================================
        */
        function buildToUnicodeMap(content) {
            const cidToUnicode = {};

            // ToUnicodeã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’æ¤œç´¢
            // /ToUnicode ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ã‚’æ¢ã™
            const toUnicodeRefs = content.match(/\/ToUnicode\s+(\d+)\s+(\d+)\s+R/g);
            if (toUnicodeRefs) {
                console.log('[ToUnicode] å‚ç…§æ¤œå‡º:', toUnicodeRefs.length, 'ä»¶');
            }

            // beginbfchar/endbfchar ãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£æ
            // å½¢å¼: <CID> <Unicode>
            // ä¾‹: <0001> <3042>  â†’ CID 1 = U+3042 (ã‚)
            const bfcharPattern = /beginbfchar\s*([\s\S]*?)\s*endbfchar/gi;
            let bfcharMatch;
            while ((bfcharMatch = bfcharPattern.exec(content)) !== null) {
                const block = bfcharMatch[1];
                // <xxxx> <yyyy> ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡º
                const entries = block.match(/<([0-9A-Fa-f]+)>\s*<([0-9A-Fa-f]+)>/g);
                if (entries) {
                    for (const entry of entries) {
                        const m = entry.match(/<([0-9A-Fa-f]+)>\s*<([0-9A-Fa-f]+)>/);
                        if (m) {
                            const cid = parseInt(m[1], 16);
                            const unicode = parseInt(m[2], 16);
                            cidToUnicode[cid] = String.fromCharCode(unicode);
                        }
                    }
                }
            }

            // beginbfrange/endbfrange ãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£æ
            // å½¢å¼: <CIDé–‹å§‹> <CIDçµ‚äº†> <Unicodeé–‹å§‹>
            // ä¾‹: <0020> <007E> <0020>  â†’ CID 0x20-0x7E = U+0020-U+007E
            const bfrangePattern = /beginbfrange\s*([\s\S]*?)\s*endbfrange/gi;
            let bfrangeMatch;
            while ((bfrangeMatch = bfrangePattern.exec(content)) !== null) {
                const block = bfrangeMatch[1];
                // <xxxx> <yyyy> <zzzz> ã¾ãŸã¯ <xxxx> <yyyy> [<zzzz> <wwww> ...] ãƒ‘ã‚¿ãƒ¼ãƒ³
                const lines = block.split(/[\r\n]+/);
                for (const line of lines) {
                    // é…åˆ—å½¢å¼: <start> <end> [<u1> <u2> ...]
                    const arrayMatch = line.match(/<([0-9A-Fa-f]+)>\s*<([0-9A-Fa-f]+)>\s*\[([\s\S]*)\]/);
                    if (arrayMatch) {
                        const start = parseInt(arrayMatch[1], 16);
                        const end = parseInt(arrayMatch[2], 16);
                        const unicodes = arrayMatch[3].match(/<([0-9A-Fa-f]+)>/g);
                        if (unicodes) {
                            for (let i = 0; i <= end - start && i < unicodes.length; i++) {
                                const uMatch = unicodes[i].match(/<([0-9A-Fa-f]+)>/);
                                if (uMatch) {
                                    cidToUnicode[start + i] = String.fromCharCode(parseInt(uMatch[1], 16));
                                }
                            }
                        }
                    } else {
                        // ç¯„å›²å½¢å¼: <start> <end> <unicode_start>
                        const rangeMatch = line.match(/<([0-9A-Fa-f]+)>\s*<([0-9A-Fa-f]+)>\s*<([0-9A-Fa-f]+)>/);
                        if (rangeMatch) {
                            const start = parseInt(rangeMatch[1], 16);
                            const end = parseInt(rangeMatch[2], 16);
                            const unicodeStart = parseInt(rangeMatch[3], 16);
                            for (let i = 0; i <= end - start; i++) {
                                cidToUnicode[start + i] = String.fromCharCode(unicodeStart + i);
                            }
                        }
                    }
                }
            }

            const mapSize = Object.keys(cidToUnicode).length;
            if (mapSize > 0) {
                console.log('[ToUnicode] CIDâ†’Unicodeå¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹ç¯‰å®Œäº†:', mapSize, 'ã‚¨ãƒ³ãƒˆãƒª');
                // ã‚µãƒ³ãƒ—ãƒ«è¡¨ç¤º
                const sampleCIDs = Object.keys(cidToUnicode).slice(0, 5);
                console.log('[ToUnicode] ã‚µãƒ³ãƒ—ãƒ«:', sampleCIDs.map(cid => {
                    const char = cidToUnicode[cid];
                    return 'CID ' + cid + ' â†’ "' + char + '" (U+' + char.charCodeAt(0).toString(16).toUpperCase().padStart(4, '0') + ')';
                }).join(', '));
            }

            return cidToUnicode;
        }

        // CIDãƒ•ã‚©ãƒ³ãƒˆã®ã‚°ãƒªãƒ•IDã‚’Unicodeã«å¤‰æ›
        function decodeCIDText(bytes, cidToUnicode) {
            if (!cidToUnicode || Object.keys(cidToUnicode).length === 0) {
                return null;
            }

            let result = '';
            let decoded = false;

            // 2ãƒã‚¤ãƒˆãšã¤CIDã¨ã—ã¦è§£é‡ˆ
            for (let i = 0; i + 1 < bytes.length; i += 2) {
                const cid = (bytes[i] << 8) | bytes[i + 1];
                if (cidToUnicode[cid]) {
                    result += cidToUnicode[cid];
                    decoded = true;
                } else if (cid >= 0x20 && cid <= 0x7E) {
                    // ASCIIç¯„å›²ã¯ãã®ã¾ã¾
                    result += String.fromCharCode(cid);
                } else {
                    // æœªçŸ¥ã®CIDã¯â–¡ã§è¡¨ç¤º
                    result += '\uFFFD';
                }
            }

            return decoded ? result : null;
        }

        /*
        ======================================================================
          Latin-1ãƒ‡ã‚³ãƒ¼ãƒ‰é–¢æ•°

          ãƒã‚¤ãƒˆé…åˆ—ã‚’ Latin-1ï¼ˆISO-8859-1ï¼‰æ–‡å­—åˆ—ã«å¤‰æ›
          PDFã®å†…éƒ¨æ§‹é€ ã‚’æ–‡å­—åˆ—ã¨ã—ã¦æ¤œç´¢ã™ã‚‹ãŸã‚ã«ä½¿ç”¨
        ======================================================================
        */
        function latin1Decode(bytes) {
            let result = '';
            // foræ–‡: ç¹°ã‚Šè¿”ã—å‡¦ç†
            for (let i = 0; i < bytes.length; i++) {
                // String.fromCharCode(): æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‹ã‚‰æ–‡å­—ã‚’ç”Ÿæˆ
                result += String.fromCharCode(bytes[i]);
            }
            return result;
        }

        /*
        ======================================================================
          ãƒšãƒ¼ã‚¸ãƒãƒƒãƒ”ãƒ³ã‚°æ§‹ç¯‰é–¢æ•°

          PDFã®ãƒšãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç•ªå·ã¨å®Ÿéš›ã®ãƒšãƒ¼ã‚¸ç•ªå·ã®å¯¾å¿œè¡¨ã‚’ä½œæˆ
        ======================================================================
        */
        function buildPageMapping(content) {
            // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆé€£æƒ³é…åˆ—ï¼‰: ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã‚’æ ¼ç´
            const pageObjects = {};

            // æ­£è¦è¡¨ç¾: /ãƒ‘ã‚¿ãƒ¼ãƒ³/ãƒ•ãƒ©ã‚°
            // g ãƒ•ãƒ©ã‚°: ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼ˆã™ã¹ã¦ã®ãƒãƒƒãƒã‚’æ¤œç´¢ï¼‰
            // [\s\S]*?: ä»»æ„ã®æ–‡å­—ï¼ˆæœ€çŸ­ãƒãƒƒãƒï¼‰
            const pageObjPattern = /(\d+)\s+\d+\s+obj[\s\S]*?\/Type\s*\/Page[^s]/g;

            let match;
            let pageNum = 1;

            // exec(): æ­£è¦è¡¨ç¾ã§ãƒãƒƒãƒã‚’1ã¤ãšã¤å–å¾—ï¼ˆãƒ«ãƒ¼ãƒ—ã§å…¨å–å¾—ï¼‰
            while ((match = pageObjPattern.exec(content)) !== null) {
                const objNum = match[1];  // ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆæ‹¬å¼§å†…ï¼‰ã®å€¤
                pageObjects[objNum] = pageNum;
                pageNum++;
            }

            return pageObjects;
        }

        /*
        ======================================================================
          ã‚¿ã‚¤ãƒˆãƒ«ä½ç½®æ¤œç´¢é–¢æ•°

          PDFå†…ã® /Title (...) ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½ç½®ã‚’æ¤œç´¢
          ãƒã‚¹ãƒˆã—ãŸæ‹¬å¼§ã«ã‚‚å¯¾å¿œ
        ======================================================================
        */
        function findTitlePositions(content) {
            const positions = [];
            const pattern = /\/Title\s*\(/g;
            let match;

            while ((match = pattern.exec(content)) !== null) {
                const start = match.index + match[0].length;
                // ãƒã‚¹ãƒˆã—ãŸæ‹¬å¼§ã‚’è€ƒæ…®ã—ã¦çµ‚ç«¯ã‚’è¦‹ã¤ã‘ã‚‹
                let depth = 1;
                let end = start;
                let escaped = false;

                while (end < content.length && depth > 0) {
                    const char = content[end];
                    if (escaped) {
                        escaped = false;
                    } else if (char === '\\') {
                        escaped = true;
                    } else if (char === '(') {
                        depth++;
                    } else if (char === ')') {
                        depth--;
                    }
                    end++;
                }

                if (depth === 0) {
                    positions.push({ start, end: end - 1 });
                }
            }

            return positions;
        }

        /*
        ======================================================================
          ã‚¿ã‚¤ãƒˆãƒ«ãƒã‚¤ãƒˆæŠ½å‡ºé–¢æ•°

          æŒ‡å®šä½ç½®ã‹ã‚‰ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
        ======================================================================
        */
        function extractTitleBytes(bytes, start, end) {
            if (start < 0 || end > bytes.length || start >= end) {
                return null;
            }
            return bytes.slice(start, end);
        }

        /*
        ======================================================================
          ã‚¿ã‚¤ãƒˆãƒ«ãƒ‡ã‚³ãƒ¼ãƒ‰é–¢æ•°

          ãƒã‚¤ãƒˆé…åˆ—ã‚’é©åˆ‡ãªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ãƒ‡ã‚³ãƒ¼ãƒ‰
          UTF-8ã€Shift_JISã€Latin-1ã‚’è©¦è¡Œ
          ãƒ–ãƒ©ã‚¦ã‚¶ã®çµ„ã¿è¾¼ã¿TextDecoderã‚’ä½¿ç”¨
        ======================================================================
        */
        // decodeTitleå‘¼ã³å‡ºã—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆãƒ‡ãƒãƒƒã‚°å‡ºåŠ›åˆ¶é™ç”¨ï¼‰
        let decodeTitleCallCount = 0;
        const DECODE_TITLE_DEBUG_LIMIT = 3;

        function decodeTitle(titleBytes) {
            if (!titleBytes || titleBytes.length === 0) {
                return '';
            }

            decodeTitleCallCount++;
            const showDebug = decodeTitleCallCount <= DECODE_TITLE_DEBUG_LIMIT;

            // PDFã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«ã¾ãšLatin-1ã§ãƒ‡ã‚³ãƒ¼ãƒ‰
            let rawStr = '';
            for (let i = 0; i < titleBytes.length; i++) {
                rawStr += String.fromCharCode(titleBytes[i]);
            }

            // PDFã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼ˆ8é€²æ•°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ç­‰ï¼‰
            const decodedStr = decodePDFString(rawStr);

            // ãƒ‡ã‚³ãƒ¼ãƒ‰å¾Œã®ãƒã‚¤ãƒˆé…åˆ—ã‚’å–å¾—
            const processedBytes = new Uint8Array(decodedStr.length);
            for (let i = 0; i < decodedStr.length; i++) {
                processedBytes[i] = decodedStr.charCodeAt(i) & 0xFF;
            }

            // å…¨ã¦ASCIIç¯„å›²å†…ãªã‚‰ãã®ã¾ã¾è¿”ã™
            if (/^[\x20-\x7E\t\n\r]+$/.test(decodedStr)) {
                return decodedStr;
            }

            // UTF-16BE BOMãƒã‚§ãƒƒã‚¯ï¼ˆFE FFã§å§‹ã¾ã‚‹ï¼‰
            if (processedBytes.length >= 2 &&
                processedBytes[0] === 0xFE &&
                processedBytes[1] === 0xFF) {
                if (showDebug) console.log('[decodeTitle] UTF-16BE BOMæ¤œå‡º, ãƒã‚¤ãƒˆé•·:', processedBytes.length);
                try {
                    // BOMã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼ˆãƒã‚¤ãƒˆ2ä»¥é™ï¼‰
                    const dataBytes = processedBytes.slice(2);
                    if (dataBytes.length >= 2) {
                        const utf16Str = new TextDecoder('utf-16be').decode(dataBytes);
                        if (showDebug) console.log('[decodeTitle] UTF-16BEãƒ‡ã‚³ãƒ¼ãƒ‰çµæœ:', utf16Str.substring(0, 30));
                        if (utf16Str && utf16Str.trim()) {
                            // NULæ–‡å­—ã‚’é™¤å»ã—ã¦è¿”ã™
                            return utf16Str.replace(/\x00/g, '').trim();
                        }
                    }
                } catch (e) {
                    if (showDebug) console.log('[decodeTitle] UTF-16BEãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•—:', e.message);
                }
            }

            // UTF-16LE BOMãƒã‚§ãƒƒã‚¯ï¼ˆFF FEã§å§‹ã¾ã‚‹ï¼‰- Acrobat JavaScriptç”Ÿæˆã®ã—ãŠã‚Šå¯¾å¿œ
            if (processedBytes.length >= 2 &&
                processedBytes[0] === 0xFF &&
                processedBytes[1] === 0xFE) {
                if (showDebug) console.log('[decodeTitle] UTF-16LE BOMæ¤œå‡º, ãƒã‚¤ãƒˆé•·:', processedBytes.length);
                try {
                    // BOMã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼ˆãƒã‚¤ãƒˆ2ä»¥é™ï¼‰
                    const dataBytes = processedBytes.slice(2);
                    if (dataBytes.length >= 2) {
                        const utf16Str = new TextDecoder('utf-16le').decode(dataBytes);
                        if (showDebug) console.log('[decodeTitle] UTF-16LEãƒ‡ã‚³ãƒ¼ãƒ‰çµæœ:', utf16Str.substring(0, 30));
                        if (utf16Str && utf16Str.trim()) {
                            // NULæ–‡å­—ã‚’é™¤å»ã—ã¦è¿”ã™
                            return utf16Str.replace(/\x00/g, '').trim();
                        }
                    }
                } catch (e) {
                    if (showDebug) console.log('[decodeTitle] UTF-16LEãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•—:', e.message);
                }
            }

            // UTF-8 BOMãƒã‚§ãƒƒã‚¯
            if (processedBytes.length >= 3 &&
                processedBytes[0] === 0xEF &&
                processedBytes[1] === 0xBB &&
                processedBytes[2] === 0xBF) {
                try {
                    const utf8Str = new TextDecoder('utf-8').decode(processedBytes.slice(3));
                    if (utf8Str && utf8Str.trim()) return utf8Str;
                } catch (e) { }
            }

            // UTF-16æ¤œå‡ºï¼ˆBOMãªã—ï¼‰- Acrobat JavaScriptç”Ÿæˆã®ã—ãŠã‚Šå¯¾å¿œ
            // å¶æ•°ãƒã‚¤ãƒˆã®å ´åˆã€UTF-16LE/BEã®ä¸¡æ–¹ã‚’è©¦ã™
            if (processedBytes.length >= 2 && processedBytes.length % 2 === 0) {
                // UTF-16LEã¨UTF-16BEã®ä¸¡æ–¹ã‚’ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
                let leScore = 0;
                let beScore = 0;
                let nullByteCount = 0;  // NULLãƒã‚¤ãƒˆã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
                let totalPairs = processedBytes.length / 2;

                for (let i = 0; i < processedBytes.length; i += 2) {
                    const byte1 = processedBytes[i];
                    const byte2 = processedBytes[i + 1];

                    // NULLãƒã‚¤ãƒˆã‚’ã‚«ã‚¦ãƒ³ãƒˆï¼ˆUTF-16ã®å¼·ã„æŒ‡æ¨™ï¼‰
                    if (byte1 === 0x00) nullByteCount++;
                    if (byte2 === 0x00) nullByteCount++;

                    // UTF-16LE: ä½ãƒã‚¤ãƒˆ + é«˜ãƒã‚¤ãƒˆ
                    const leCharCode = (byte2 << 8) | byte1;
                    // UTF-16BE: é«˜ãƒã‚¤ãƒˆ + ä½ãƒã‚¤ãƒˆ
                    const beCharCode = (byte1 << 8) | byte2;

                    // NULLãƒšã‚¢ã¯ã‚¹ã‚­ãƒƒãƒ—
                    if (leCharCode === 0 && beCharCode === 0) continue;

                    // LEè©•ä¾¡: ASCIIæ–‡å­—ï¼ˆbyte2ãŒ0x00ã€byte1ãŒå°åˆ·å¯èƒ½ï¼‰
                    if (byte2 === 0x00 && ((byte1 >= 0x20 && byte1 <= 0x7E) || byte1 === 0x09 || byte1 === 0x0A || byte1 === 0x0D)) {
                        leScore += 3;
                    }
                    // LEè©•ä¾¡: æ—¥æœ¬èªæ–‡å­—
                    if ((leCharCode >= 0x3040 && leCharCode <= 0x309F) ||  // ã²ã‚‰ãŒãª
                        (leCharCode >= 0x30A0 && leCharCode <= 0x30FF) ||  // ã‚«ã‚¿ã‚«ãƒŠ
                        (leCharCode >= 0x4E00 && leCharCode <= 0x9FFF) ||  // CJKçµ±åˆæ¼¢å­—
                        (leCharCode >= 0x3000 && leCharCode <= 0x303F) ||  // CJKè¨˜å·ãƒ»å¥èª­ç‚¹
                        (leCharCode >= 0xFF00 && leCharCode <= 0xFFEF)) {  // å…¨è§’è‹±æ•°ãƒ»åŠè§’ã‚«ãƒŠ
                        leScore += 5;
                    }

                    // BEè©•ä¾¡: ASCIIæ–‡å­—ï¼ˆbyte1ãŒ0x00ã€byte2ãŒå°åˆ·å¯èƒ½ï¼‰
                    if (byte1 === 0x00 && ((byte2 >= 0x20 && byte2 <= 0x7E) || byte2 === 0x09 || byte2 === 0x0A || byte2 === 0x0D)) {
                        beScore += 3;
                    }
                    // BEè©•ä¾¡: æ—¥æœ¬èªæ–‡å­—
                    if ((beCharCode >= 0x3040 && beCharCode <= 0x309F) ||  // ã²ã‚‰ãŒãª
                        (beCharCode >= 0x30A0 && beCharCode <= 0x30FF) ||  // ã‚«ã‚¿ã‚«ãƒŠ
                        (beCharCode >= 0x4E00 && beCharCode <= 0x9FFF) ||  // CJKçµ±åˆæ¼¢å­—
                        (beCharCode >= 0x3000 && beCharCode <= 0x303F) ||  // CJKè¨˜å·ãƒ»å¥èª­ç‚¹
                        (beCharCode >= 0xFF00 && beCharCode <= 0xFFEF)) {  // å…¨è§’è‹±æ•°ãƒ»åŠè§’ã‚«ãƒŠ
                        beScore += 5;
                    }
                }

                // NULLãƒã‚¤ãƒˆãŒå¤šã„å ´åˆã¯UTF-16ã®å¯èƒ½æ€§ãŒé«˜ã„ï¼ˆASCIIæ–‡å­—ã®UTF-16è¡¨ç¾ï¼‰
                const hasNullBytePattern = nullByteCount >= totalPairs * 0.3;

                // ã‚¹ã‚³ã‚¢ãŒé«˜ã„æ–¹ã®ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã‚’å„ªå…ˆ
                const tryEncodings = leScore >= beScore
                    ? ['utf-16le', 'utf-16be']
                    : ['utf-16be', 'utf-16le'];

                if (showDebug) console.log('[decodeTitle] UTF-16ã‚¹ã‚³ã‚¢ LE:', leScore, 'BE:', beScore, 'NULLãƒã‚¤ãƒˆ:', nullByteCount, '/', totalPairs);

                // ã‚¹ã‚³ã‚¢ãŒã‚ã‚‹ã‹ã€NULLãƒã‚¤ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹å ´åˆã«UTF-16ã‚’è©¦ã™
                if (leScore > 0 || beScore > 0 || hasNullBytePattern) {
                    for (const encoding of tryEncodings) {
                        try {
                            const utf16Str = new TextDecoder(encoding).decode(processedBytes);
                            if (utf16Str && utf16Str.trim()) {
                                // ç½®æ›æ–‡å­—ã¨åˆ¶å¾¡æ–‡å­—ã®ãƒã‚§ãƒƒã‚¯
                                const replacementChars = (utf16Str.match(/\uFFFD/g) || []).length;
                                const controlChars = (utf16Str.match(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g) || []).length;
                                const validChars = utf16Str.length - replacementChars - controlChars;

                                if (showDebug) console.log('[decodeTitle]', encoding, 'çµæœ:', utf16Str.substring(0, 30), 'æœ‰åŠ¹:', validChars, '/', utf16Str.length);

                                // æœ‰åŠ¹ãªæ–‡å­—ãŒåŠåˆ†ä»¥ä¸Šã‚ã‚Œã°æ¡ç”¨
                                if (validChars > utf16Str.length * 0.5 && replacementChars < utf16Str.length * 0.1) {
                                    if (showDebug) console.log('[decodeTitle] æ¡ç”¨:', encoding);
                                    return utf16Str;
                                }
                            }
                        } catch (e) {
                            if (showDebug) console.log('[decodeTitle]', encoding, 'ãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•—:', e.message);
                        }
                    }
                }
            }

            // UTF-8ã¨ã—ã¦è§£é‡ˆã‚’è©¦ã¿ã‚‹
            try {
                const utf8Str = new TextDecoder('utf-8', { fatal: true }).decode(processedBytes);
                // æœ‰åŠ¹ãªUTF-8æ–‡å­—åˆ—ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆåˆ¶å¾¡æ–‡å­—ãŒå¤šã™ããªã„ã‹ï¼‰
                const controlChars = (utf8Str.match(/[\x00-\x1F]/g) || []).length;
                if (controlChars < utf8Str.length * 0.1) {
                    if (showDebug) console.log('[decodeTitle] UTF-8æ¡ç”¨:', utf8Str.substring(0, 30));
                    return utf8Str;
                }
            } catch (e) {
                // UTF-8ãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•—ã¯é »ç¹ã«èµ·ã“ã‚‹ãŸã‚ãƒ­ã‚°çœç•¥
            }

            // Shift_JIS (Windows-31J) ã¨ã—ã¦è§£é‡ˆã‚’è©¦ã¿ã‚‹
            try {
                const shiftJisStr = new TextDecoder('shift_jis', { fatal: false }).decode(processedBytes);
                // ç½®æ›æ–‡å­—ãŒå°‘ãªã‘ã‚Œã°æœ‰åŠ¹ã¨ã¿ãªã™
                const replacementChars = (shiftJisStr.match(/\uFFFD/g) || []).length;
                if (replacementChars < shiftJisStr.length * 0.2) {
                    if (showDebug) console.log('[decodeTitle] Shift_JISæ¡ç”¨:', shiftJisStr.substring(0, 30));
                    return shiftJisStr;
                }
            } catch (e) {
                // Shift_JISãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•—ã¯ãƒ­ã‚°çœç•¥
            }

            // PDFDocEncodingã¨ã—ã¦è§£é‡ˆã‚’è©¦ã¿ã‚‹ï¼ˆ0x80-0x9Fç¯„å›²ã®ç‰¹æ®Šæ–‡å­—å¯¾å¿œï¼‰
            try {
                const pdfDocStr = decodePDFDocEncoding(processedBytes);
                // æœ‰åŠ¹ãªæ–‡å­—åˆ—ã‹ãƒã‚§ãƒƒã‚¯
                if (pdfDocStr && pdfDocStr.trim()) {
                    const controlChars = (pdfDocStr.match(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g) || []).length;
                    if (controlChars < pdfDocStr.length * 0.1) {
                        if (showDebug) console.log('[decodeTitle] PDFDocEncodingæ¡ç”¨:', pdfDocStr.substring(0, 30));
                        return pdfDocStr;
                    }
                }
            } catch (e) {
                // PDFDocEncodingãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•—ã¯ãƒ­ã‚°çœç•¥
            }

            // æœ€çµ‚æ‰‹æ®µ: PDFã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãŸæ–‡å­—åˆ—ã‚’ãã®ã¾ã¾è¿”ã™
            if (showDebug) console.log('[decodeTitle] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆrawãƒ‡ã‚³ãƒ¼ãƒ‰æ–‡å­—åˆ—ï¼‰:', decodedStr.substring(0, 30));
            return decodedStr;
        }

        /*
        ======================================================================
          Shift_JISãƒ‡ã‚³ãƒ¼ãƒ‰é–¢æ•°

          Shift_JISï¼ˆCP932ï¼‰ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒã‚¤ãƒˆé…åˆ—ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰
        ======================================================================
        */
        function decodeShiftJIS(bytes) {
            let result = '';
            let i = 0;

            while (i < bytes.length) {
                const b1 = bytes[i];

                // ASCIIç¯„å›²ï¼ˆ0x00-0x7Fï¼‰
                if (b1 <= 0x7F) {
                    result += String.fromCharCode(b1);
                    i++;
                }
                // åŠè§’ã‚«ãƒŠï¼ˆ0xA1-0xDFï¼‰
                else if (b1 >= 0xA1 && b1 <= 0xDF) {
                    // åŠè§’ã‚«ãƒŠã‚’Unicodeã«å¤‰æ›ï¼ˆ0xFF61 - 0xFF9Fï¼‰
                    result += String.fromCharCode(0xFF61 + (b1 - 0xA1));
                    i++;
                }
                // 2ãƒã‚¤ãƒˆæ–‡å­—ã®ç¬¬1ãƒã‚¤ãƒˆ
                else if ((b1 >= 0x81 && b1 <= 0x9F) || (b1 >= 0xE0 && b1 <= 0xFC)) {
                    if (i + 1 >= bytes.length) {
                        result += '?';
                        i++;
                        continue;
                    }
                    const b2 = bytes[i + 1];

                    // JIS X 0208ã®åŒºç‚¹ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›
                    let ku, ten;
                    if (b1 <= 0x9F) {
                        ku = (b1 - 0x81) * 2 + 1;
                    } else {
                        ku = (b1 - 0xC1) * 2 + 1;
                    }

                    if (b2 <= 0x7E) {
                        ten = b2 - 0x1F;
                    } else if (b2 <= 0x9E) {
                        ten = b2 - 0x20;
                    } else {
                        ku++;
                        ten = b2 - 0x9E;
                    }

                    // åŒºç‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰Unicodeã«å¤‰æ›
                    const unicode = jisToUnicode(ku, ten);
                    if (unicode) {
                        result += String.fromCharCode(unicode);
                    } else {
                        result += '?';
                    }
                    i += 2;
                } else {
                    result += '?';
                    i++;
                }
            }

            return result;
        }

        /*
        ======================================================================
          JIS X 0208 ã‹ã‚‰ Unicode ã¸ã®å¤‰æ›

          ç°¡ç•¥ç‰ˆ: ä¸»è¦ãªæ—¥æœ¬èªæ–‡å­—ã®å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«
        ======================================================================
        */
        function jisToUnicode(ku, ten) {
            // åŸºæœ¬çš„ãªJIS X 0208 â†’ Unicodeå¤‰æ›
            // å®Œå…¨ãªãƒ†ãƒ¼ãƒ–ãƒ«ã¯å¤§ãã™ãã‚‹ãŸã‚ã€ä¸»è¦ãªç¯„å›²ã®ã¿å¯¾å¿œ

            // ã²ã‚‰ãŒãªï¼ˆåŒºç‚¹ã‚³ãƒ¼ãƒ‰ 4åŒºï¼‰
            if (ku === 4 && ten >= 1 && ten <= 83) {
                return 0x3041 + (ten - 1);
            }
            // ã‚«ã‚¿ã‚«ãƒŠï¼ˆåŒºç‚¹ã‚³ãƒ¼ãƒ‰ 5åŒºï¼‰
            if (ku === 5 && ten >= 1 && ten <= 86) {
                return 0x30A1 + (ten - 1);
            }
            // è¨˜å·é¡ï¼ˆ1åŒºï¼‰
            if (ku === 1) {
                const symbols1 = [
                    0x3000, 0x3001, 0x3002, 0xFF0C, 0xFF0E, 0x30FB, 0xFF1A, 0xFF1B,
                    0xFF1F, 0xFF01, 0x309B, 0x309C, 0x00B4, 0xFF40, 0x00A8, 0xFF3E,
                    0xFFE3, 0xFF3F, 0x30FD, 0x30FE, 0x309D, 0x309E, 0x3003, 0x4EDD,
                    0x3005, 0x3006, 0x3007, 0x30FC, 0x2015, 0x2010, 0xFF0F, 0x005C,
                    0x301C, 0x2016, 0xFF5C, 0x2026, 0x2025, 0x2018, 0x2019, 0x201C,
                    0x201D, 0xFF08, 0xFF09, 0x3014, 0x3015, 0xFF3B, 0xFF3D, 0xFF5B,
                    0xFF5D, 0x3008, 0x3009, 0x300A, 0x300B, 0x300C, 0x300D, 0x300E,
                    0x300F, 0x3010, 0x3011, 0xFF0B, 0x2212, 0x00B1, 0x00D7, 0x00F7,
                    0xFF1D, 0x2260, 0xFF1C, 0xFF1E, 0x2266, 0x2267, 0x221E, 0x2234,
                    0x2642, 0x2640, 0x00B0, 0x2032, 0x2033, 0x2103, 0xFFE5, 0xFF04,
                    0xFFE0, 0xFFE1, 0xFF05, 0xFF03, 0xFF06, 0xFF0A, 0xFF20, 0x00A7,
                    0x2606, 0x2605, 0x25CB, 0x25CF, 0x25CE, 0x25C7
                ];
                if (ten >= 1 && ten <= symbols1.length) {
                    return symbols1[ten - 1];
                }
            }
            // æ¼¢å­—ï¼ˆ16åŒºï½84åŒºï¼‰ã¯Unicode CJKçµ±åˆæ¼¢å­—ã«å¯¾å¿œ
            // ç°¡ç•¥åŒ–ã®ãŸã‚ã€ç·šå½¢è¿‘ä¼¼ã§å¤‰æ›ï¼ˆç²¾åº¦ã¯å®Œç’§ã§ã¯ãªã„ï¼‰
            if (ku >= 16 && ku <= 47) {
                // ç¬¬1æ°´æº–æ¼¢å­—
                const offset = (ku - 16) * 94 + (ten - 1);
                return 0x4E00 + offset;
            }
            if (ku >= 48 && ku <= 84) {
                // ç¬¬2æ°´æº–æ¼¢å­—
                const offset = (ku - 48) * 94 + (ten - 1) + 2965;
                return 0x4E00 + offset;
            }

            return null;
        }

        /*
        ======================================================================
          ã—ãŠã‚ŠæŠ½å‡ºé–¢æ•°

          PDFå†…ã®ã—ãŠã‚Šæƒ…å ±ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€ãƒšãƒ¼ã‚¸ç•ªå·ï¼‰ã‚’æŠ½å‡º
        ======================================================================
        */
        function extractBookmarks(content, bytes, pageObjects) {
            console.log('[extractBookmarks] æŠ½å‡ºå‡¦ç†é–‹å§‹');
            const bookmarks = [];
            const originalContentLength = bytes.length;

            // ToUnicode/CMapãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ§‹ç¯‰ï¼ˆCIDãƒ•ã‚©ãƒ³ãƒˆå¯¾å¿œï¼‰
            console.log('[extractBookmarks] ToUnicode/CMapãƒ†ãƒ¼ãƒ–ãƒ«æ§‹ç¯‰é–‹å§‹');
            const cidToUnicode = buildToUnicodeMap(content);

            /*
            --------------------------------------------------------------
              æ–¹æ³•1: æ‹¬å¼§å½¢å¼ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ¤œç´¢ï¼ˆæ—¥æœ¬èªå¯¾å¿œå¼·åŒ–ï¼‰
              /Title (ãƒ†ã‚­ã‚¹ãƒˆ) ã®å½¢å¼
              æ—¥æœ¬èªã¯Shift_JISã€UTF-8ã€ã¾ãŸã¯ãƒã‚¤ãƒŠãƒªã§æ ¼ç´ã•ã‚Œã¦ã„ã‚‹
            --------------------------------------------------------------
            */
            // ãƒã‚¤ãƒŠãƒªã‹ã‚‰ç›´æ¥ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŠ½å‡ºï¼ˆãƒã‚¹ãƒˆã—ãŸæ‹¬å¼§ã«ã‚‚å¯¾å¿œï¼‰
            console.log('[extractBookmarks] æ–¹æ³•1: æ‹¬å¼§å½¢å¼ã‚’æ¤œç´¢');
            const titlePositions = findTitlePositions(content);
            console.log('[extractBookmarks] æ–¹æ³•1: æ¤œå‡ºä½ç½®æ•°:', titlePositions.length);

            for (let posIdx = 0; posIdx < titlePositions.length; posIdx++) {
                const pos = titlePositions[posIdx];
                let title = '';

                console.log('[extractBookmarks] æ–¹æ³•1: å‡¦ç†ä¸­ (' + (posIdx + 1) + '/' + titlePositions.length + ') ä½ç½®:', pos.start, '-', pos.end);

                // å…ƒã®ãƒã‚¤ãƒˆé…åˆ—ã®ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯
                if (pos.start < originalContentLength && pos.end <= originalContentLength) {
                    // å…ƒã®PDFãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æŠ½å‡º
                    const titleBytes = extractTitleBytes(bytes, pos.start, pos.end);
                    if (titleBytes && titleBytes.length > 0) {
                        console.log('[extractBookmarks] æ–¹æ³•1: å…ƒãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æŠ½å‡º, ãƒã‚¤ãƒˆé•·:', titleBytes.length);
                        title = decodeTitle(titleBytes);
                        console.log('[extractBookmarks] æ–¹æ³•1: ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœ:', title ? title.substring(0, 30) : '(ç©º)');
                    }
                } else {
                    // è§£å‡ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰æŠ½å‡ºï¼ˆæ–‡å­—åˆ—ã¨ã—ã¦å‡¦ç†ï¼‰
                    const titleStr = content.substring(pos.start, pos.end);
                    console.log('[extractBookmarks] æ–¹æ³•1: è§£å‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰æŠ½å‡º, æ–‡å­—åˆ—é•·:', titleStr.length);
                    // 8é€²æ•°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ç­‰ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰å¾Œã€ãƒã‚¤ãƒˆé…åˆ—ã¨ã—ã¦å‡¦ç†
                    const decoded = decodePDFString(titleStr);
                    const titleBytes = new Uint8Array(decoded.length);
                    for (let i = 0; i < decoded.length; i++) {
                        titleBytes[i] = decoded.charCodeAt(i) & 0xFF;
                    }
                    title = decodeTitle(titleBytes);
                    console.log('[extractBookmarks] æ–¹æ³•1: ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœ:', title ? title.substring(0, 30) : '(ç©º)');
                }

                if (title && title.trim()) {
                    // é‡è¤‡ãƒã‚§ãƒƒã‚¯
                    if (!bookmarks.some(b => b.title === title.trim())) {
                        bookmarks.push({ title: title.trim(), page: '', level: 1 });
                        console.log('[extractBookmarks] æ–¹æ³•1: ã—ãŠã‚Šè¿½åŠ :', title.trim().substring(0, 30));
                    }
                }
            }

            /*
            --------------------------------------------------------------
              æ–¹æ³•2: 16é€²æ•°å½¢å¼ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ¤œç´¢
              /Title <FEFF0041...> ã¾ãŸã¯ /Title <48656C6C6F> ã®å½¢å¼
              PDFã§ã¯16é€²æ•°æ–‡å­—åˆ—å†…ã«ç©ºç™½ã‚„æ”¹è¡ŒãŒå«ã¾ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹
              Acrobat JavaScriptç”Ÿæˆã®ã—ãŠã‚Šã¯BOMãªã—UTF-16BEã®å ´åˆãŒã‚ã‚‹
            --------------------------------------------------------------
            */
            console.log('[extractBookmarks] æ–¹æ³•2: 16é€²æ•°å½¢å¼ã‚’æ¤œç´¢');
            let match;
            let hexMatchCount = 0;
            let hexDebugSamples = [];  // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚µãƒ³ãƒ—ãƒ«åé›†ï¼ˆæˆåŠŸï¼‰
            let hexFailedSamples = []; // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚µãƒ³ãƒ—ãƒ«åé›†ï¼ˆå¤±æ•—ï¼‰
            // 16é€²æ•°å½¢å¼ã‚’æ¤œç´¢ï¼ˆç©ºç™½ã‚’å«ã‚€å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚æŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
            const hexPattern = /\/Title\s*<([0-9A-Fa-f\s]+)>/gi;
            while ((match = hexPattern.exec(content)) !== null) {
                hexMatchCount++;
                // ç©ºç™½ã‚’é™¤å»ã—ã¦ç´”ç²‹ãª16é€²æ•°æ–‡å­—åˆ—ã‚’å–å¾—
                const hexStr = match[1].replace(/\s+/g, '');
                if (hexStr.length < 2) continue;

                let title = '';

                // UTF-16BE (FEFFã§å§‹ã¾ã‚‹) ã®å ´åˆ
                if (hexStr.toUpperCase().startsWith('FEFF')) {
                    const dataHex = hexStr.substring(4);
                    // 4æ¡ãšã¤å‡¦ç†ï¼ˆUTF-16ã¯2ãƒã‚¤ãƒˆ=4æ¡ã®16é€²æ•°ï¼‰
                    for (let i = 0; i + 4 <= dataHex.length; i += 4) {
                        const charCode = parseInt(dataHex.substring(i, i + 4), 16);
                        if (charCode > 0) title += String.fromCharCode(charCode);
                    }
                }
                // UTF-16LE (FFFEã§å§‹ã¾ã‚‹) ã®å ´åˆ - Acrobat JavaScriptå¯¾å¿œ
                else if (hexStr.toUpperCase().startsWith('FFFE')) {
                    const dataHex = hexStr.substring(4);
                    // 4æ¡ãšã¤å‡¦ç†ï¼ˆUTF-16LEã¯ãƒã‚¤ãƒˆé †ãŒé€†ï¼‰
                    for (let i = 0; i + 4 <= dataHex.length; i += 4) {
                        const low = parseInt(dataHex.substring(i, i + 2), 16);
                        const high = parseInt(dataHex.substring(i + 2, i + 4), 16);
                        const charCode = (high << 8) | low;
                        if (charCode > 0) title += String.fromCharCode(charCode);
                    }
                } else {
                    // BOMãªã—ã®å ´åˆã€UTF-16BE/LEã®ä¸¡æ–¹ã‚’ãƒã‚§ãƒƒã‚¯
                    const titleBytes = new Uint8Array(hexStr.length / 2);
                    for (let i = 0; i + 2 <= hexStr.length; i += 2) {
                        titleBytes[i / 2] = parseInt(hexStr.substring(i, i + 2), 16);
                    }

                    // ãƒ‡ãƒãƒƒã‚°ç”¨: æœ€åˆã®5ä»¶ã ã‘è©³ç´°ãƒ­ã‚°
                    const showDebug = (hexMatchCount <= 5);
                    if (showDebug) {
                        console.log('[æ–¹æ³•2] BOMãªã—å‡¦ç† #' + hexMatchCount + ' hex:', hexStr.substring(0, 40));
                    }

                    // BOMãªã—UTF-16ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆBE/LEä¸¡æ–¹ï¼‰
                    if (hexStr.length % 4 === 0 && hexStr.length >= 4) {
                        let beScore = 0;
                        let leScore = 0;

                        for (let i = 0; i < hexStr.length; i += 4) {
                            const byte1 = parseInt(hexStr.substring(i, i + 2), 16);
                            const byte2 = parseInt(hexStr.substring(i + 2, i + 4), 16);

                            // UTF-16BE: byte1=é«˜ãƒã‚¤ãƒˆ, byte2=ä½ãƒã‚¤ãƒˆ
                            const beCharCode = (byte1 << 8) | byte2;
                            // UTF-16LE: byte1=ä½ãƒã‚¤ãƒˆ, byte2=é«˜ãƒã‚¤ãƒˆ
                            const leCharCode = (byte2 << 8) | byte1;

                            // BEè©•ä¾¡: ASCIIï¼ˆé«˜ãƒã‚¤ãƒˆ=0ã€ä½ãƒã‚¤ãƒˆãŒå°åˆ·å¯èƒ½ASCIIï¼‰
                            if (byte1 === 0 && byte2 >= 0x20 && byte2 <= 0x7E) {
                                beScore += 3;
                            }
                            // BEè©•ä¾¡: æ—¥æœ¬èªï¼ˆã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠã€æ¼¢å­—ã€è¨˜å·ï¼‰
                            if ((beCharCode >= 0x3040 && beCharCode <= 0x309F) ||
                                (beCharCode >= 0x30A0 && beCharCode <= 0x30FF) ||
                                (beCharCode >= 0x4E00 && beCharCode <= 0x9FFF) ||
                                (beCharCode >= 0x3000 && beCharCode <= 0x303F) ||
                                (beCharCode >= 0xFF00 && beCharCode <= 0xFFEF)) {
                                beScore += 5;
                            }

                            // LEè©•ä¾¡: ASCIIï¼ˆé«˜ãƒã‚¤ãƒˆ=0ï¼‰
                            if (byte2 === 0 && byte1 >= 0x20 && byte1 <= 0x7E) {
                                leScore += 3;
                            }
                            // LEè©•ä¾¡: æ—¥æœ¬èª
                            if ((leCharCode >= 0x3040 && leCharCode <= 0x309F) ||
                                (leCharCode >= 0x30A0 && leCharCode <= 0x30FF) ||
                                (leCharCode >= 0x4E00 && leCharCode <= 0x9FFF) ||
                                (leCharCode >= 0x3000 && leCharCode <= 0x303F) ||
                                (leCharCode >= 0xFF00 && leCharCode <= 0xFFEF)) {
                                leScore += 5;
                            }
                        }

                        if (showDebug) {
                            console.log('[æ–¹æ³•2] ã‚¹ã‚³ã‚¢ BE:', beScore, ' LE:', leScore);
                        }

                        // ã‚¹ã‚³ã‚¢ãŒé«˜ã„æ–¹ã®ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã‚’å„ªå…ˆï¼ˆåŒç‚¹ãªã‚‰BEå„ªå…ˆï¼šAdobe JSæ¨™æº–ï¼‰
                        const tryEncodings = beScore >= leScore
                            ? ['utf-16be', 'utf-16le']
                            : ['utf-16le', 'utf-16be'];

                        // UTF-16ã‚’è©¦ã™ï¼ˆã‚¹ã‚³ã‚¢ãŒ0ã§ã‚‚å¶æ•°ãƒã‚¤ãƒˆãªã‚‰è©¦ã™ï¼‰
                        for (const encoding of tryEncodings) {
                            try {
                                const utf16Str = new TextDecoder(encoding).decode(titleBytes);
                                // NULæ–‡å­—ã‚’é™¤å»
                                const cleanStr = utf16Str.replace(/\x00/g, '');
                                // æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯: ç½®æ›æ–‡å­—ã¨åˆ¶å¾¡æ–‡å­—ãŒå°‘ãªã„
                                const replacementCount = (cleanStr.match(/\uFFFD/g) || []).length;
                                const controlChars = (cleanStr.match(/[\x01-\x08\x0B\x0C\x0E-\x1F]/g) || []).length;
                                const validRatio = cleanStr.length > 0 ? (cleanStr.length - replacementCount - controlChars) / cleanStr.length : 0;

                                if (showDebug) {
                                    console.log('[æ–¹æ³•2] ' + encoding + ':', cleanStr.substring(0, 30), 'æœ‰åŠ¹ç‡:', Math.round(validRatio * 100) + '%');
                                }

                                // æœ‰åŠ¹ãªæ–‡å­—ãŒ70%ä»¥ä¸Šã‚ã‚Œã°æ¡ç”¨
                                if (validRatio >= 0.7 && cleanStr.trim()) {
                                    title = cleanStr.trim();
                                    if (showDebug) {
                                        console.log('[æ–¹æ³•2] æ¡ç”¨:', encoding);
                                    }
                                    // ãƒ‡ãƒãƒƒã‚°ã‚µãƒ³ãƒ—ãƒ«åé›†
                                    if (hexDebugSamples.length < 5) {
                                        hexDebugSamples.push({ hex: hexStr.substring(0, 20), enc: encoding, result: title.substring(0, 15) });
                                    }
                                    break;
                                }
                            } catch (e) {
                                // ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
                            }
                        }
                    }

                    // UTF-16ã¨ã—ã¦è§£é‡ˆã§ããªã‹ã£ãŸå ´åˆã¯é€šå¸¸ã®ãƒ‡ã‚³ãƒ¼ãƒ‰
                    if (!title) {
                        title = decodeTitle(titleBytes);
                        if (showDebug) {
                            console.log('[æ–¹æ³•2] decodeTitleçµæœ:', title ? title.substring(0, 30) : '(ç©º)');
                        }
                        if (hexDebugSamples.length < 5 && title) {
                            hexDebugSamples.push({ hex: hexStr.substring(0, 20), enc: 'decodeTitle', result: title.substring(0, 15) });
                        }
                    }

                    // ãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•—ã‚µãƒ³ãƒ—ãƒ«ã‚’åé›†
                    if (!title && hexFailedSamples.length < 3) {
                        hexFailedSamples.push({ hex: hexStr.substring(0, 40), reason: 'UTF-16ã¨decodeTitleã®ä¸¡æ–¹å¤±æ•—' });
                    }
                }

                if (title && title.trim()) {
                    // é‡è¤‡ãƒã‚§ãƒƒã‚¯
                    if (!bookmarks.some(b => b.title === title.trim())) {
                        bookmarks.push({ title: title.trim(), page: '', level: 1 });
                    }
                } else if (hexFailedSamples.length < 3 && hexStr.length > 0) {
                    // ã‚¿ã‚¤ãƒˆãƒ«ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã‚‚ã‚µãƒ³ãƒ—ãƒ«åé›†
                    hexFailedSamples.push({ hex: hexStr.substring(0, 40), reason: 'ã‚¿ã‚¤ãƒˆãƒ«ç©ºã¾ãŸã¯ç„¡åŠ¹' });
                }
            }

            // æ–¹æ³•2ã®ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒªãƒ¼å‡ºåŠ›ï¼ˆå¸¸ã«å‡ºåŠ›ï¼‰
            console.log('[æ–¹æ³•2] === ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒªãƒ¼ ===');
            console.log('[æ–¹æ³•2] hexãƒãƒƒãƒæ•°:', hexMatchCount);
            console.log('[æ–¹æ³•2] æŠ½å‡ºæˆåŠŸ:', bookmarks.length, 'ä»¶');
            console.log('[æ–¹æ³•2] æˆåŠŸã‚µãƒ³ãƒ—ãƒ«æ•°:', hexDebugSamples.length);
            console.log('[æ–¹æ³•2] å¤±æ•—ã‚µãƒ³ãƒ—ãƒ«æ•°:', hexFailedSamples.length);
            if (hexDebugSamples.length > 0) {
                hexDebugSamples.forEach((s, i) => {
                    console.log('  æˆåŠŸ' + (i + 1) + '. hex=' + s.hex + '... enc=' + s.enc + ' â†’ "' + s.result + '..."');
                });
            }
            if (hexFailedSamples.length > 0) {
                hexFailedSamples.forEach((s, i) => {
                    console.log('  å¤±æ•—' + (i + 1) + '. hex=' + s.hex + ' ç†ç”±:' + s.reason);
                });
            }

            /*
            --------------------------------------------------------------
              æ–¹æ³•3: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ - ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ¤œç´¢
              ä¸Šè¨˜ã®æ–¹æ³•ã§è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®æœ€çµ‚æ‰‹æ®µ
            --------------------------------------------------------------
            */
            console.log('[extractBookmarks] æ–¹æ³•3ãƒã‚§ãƒƒã‚¯: ç¾åœ¨ã®bookmarksæ•°:', bookmarks.length);
            if (bookmarks.length === 0) {
                console.log('[extractBookmarks] æ–¹æ³•3: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œç´¢é–‹å§‹');
                // /Title ã«ç¶šãä»»æ„ã®æ–‡å­—åˆ—ã‚’æŠ½å‡ºï¼ˆæ‹¬å¼§ã¾ãŸã¯<>ï¼‰
                const fallbackPattern = /\/Title\s*(?:\(([^)]*)\)|<([^>]+)>)/gi;
                let method3Count = 0;
                let method3Samples = [];
                while ((match = fallbackPattern.exec(content)) !== null) {
                    method3Count++;
                    let title = '';
                    if (match[1] !== undefined) {
                        // æ‹¬å¼§å½¢å¼: 8é€²æ•°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰å¾Œã€ãƒã‚¤ãƒˆé…åˆ—ã¨ã—ã¦å‡¦ç†
                        const rawMatch = match[1];
                        const decoded = decodePDFString(rawMatch);
                        const titleBytes = new Uint8Array(decoded.length);
                        for (let i = 0; i < decoded.length; i++) {
                            titleBytes[i] = decoded.charCodeAt(i) & 0xFF;
                        }

                        title = decodeTitle(titleBytes);

                        // ãƒ‡ãƒãƒƒã‚°: æœ€åˆã®5ä»¶ã®è©³ç´°ã‚’åé›†
                        if (method3Samples.length < 5) {
                            const hexDump = Array.from(titleBytes.slice(0, 20)).map(b => b.toString(16).padStart(2, '0')).join(' ');
                            method3Samples.push({
                                raw: rawMatch.substring(0, 30),
                                hex: hexDump,
                                len: titleBytes.length,
                                decoded: title ? title.substring(0, 30) : '(ç©º)'
                            });
                        }
                    } else if (match[2] !== undefined) {
                        // 16é€²æ•°å½¢å¼
                        const hexStr = match[2].replace(/\s+/g, '');
                        if (hexStr.toUpperCase().startsWith('FEFF')) {
                            // UTF-16BE BOM
                            const dataHex = hexStr.substring(4);
                            for (let i = 0; i + 4 <= dataHex.length; i += 4) {
                                const charCode = parseInt(dataHex.substring(i, i + 4), 16);
                                if (charCode > 0) title += String.fromCharCode(charCode);
                            }
                        } else if (hexStr.toUpperCase().startsWith('FFFE')) {
                            // UTF-16LE BOM - Acrobat JavaScriptå¯¾å¿œ
                            const dataHex = hexStr.substring(4);
                            for (let i = 0; i + 4 <= dataHex.length; i += 4) {
                                const low = parseInt(dataHex.substring(i, i + 2), 16);
                                const high = parseInt(dataHex.substring(i + 2, i + 4), 16);
                                const charCode = (high << 8) | low;
                                if (charCode > 0) title += String.fromCharCode(charCode);
                            }
                        } else if (hexStr.length >= 2) {
                            const bytes = new Uint8Array(hexStr.length / 2);
                            for (let i = 0; i + 2 <= hexStr.length; i += 2) {
                                bytes[i / 2] = parseInt(hexStr.substring(i, i + 2), 16);
                            }
                            title = decodeTitle(bytes);
                        }
                    }
                    if (title && title.trim() && !bookmarks.some(b => b.title === title.trim())) {
                        bookmarks.push({ title: title.trim(), page: '', level: 1 });
                    }
                }

                // æ–¹æ³•3ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒªãƒ¼
                console.log('[æ–¹æ³•3] === ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒªãƒ¼ ===');
                console.log('[æ–¹æ³•3] ãƒãƒƒãƒæ•°:', method3Count);
                console.log('[æ–¹æ³•3] æŠ½å‡ºæˆåŠŸ:', bookmarks.length, 'ä»¶');
                if (method3Samples.length > 0) {
                    console.log('[æ–¹æ³•3] ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆæ‹¬å¼§å½¢å¼ï¼‰:');
                    method3Samples.forEach((s, i) => {
                        console.log('  ' + (i + 1) + '. raw="' + s.raw + '..." len=' + s.len);
                        console.log('     hex: ' + s.hex);
                        console.log('     decoded: "' + s.decoded + '"');
                    });
                }
            }

            /*
            --------------------------------------------------------------
              æ–¹æ³•4: Acrobat JavaScriptç”Ÿæˆã®ã—ãŠã‚Šã‚’æ¤œç´¢
              /S /JavaScript ã‚„ /JS ã‚’å«ã‚€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ã—ãŠã‚Šåã‚’æŠ½å‡º
              Acrobatã¯ã—ãŠã‚Šåã‚’UTF-16BEã§æ ¼ç´ã™ã‚‹ã“ã¨ãŒå¤šã„
            --------------------------------------------------------------
            */
            console.log('[extractBookmarks] æ–¹æ³•4ãƒã‚§ãƒƒã‚¯: ç¾åœ¨ã®bookmarksæ•°:', bookmarks.length);
            if (bookmarks.length === 0) {
                console.log('[extractBookmarks] æ–¹æ³•4: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆèµ°æŸ»é–‹å§‹');
                // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’èµ°æŸ»ã—ã¦ã—ãŠã‚Šé–¢é€£ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ¢ã™
                const objPattern = /(\d+)\s+\d+\s+obj\s*([\s\S]*?)\s*endobj/g;
                let method4Count = 0;
                let method4Samples = [];
                while ((match = objPattern.exec(content)) !== null) {
                    const objContent = match[2];

                    // /Title ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¢ã™
                    const titleMatch = objContent.match(/\/Title\s*(?:\(([^)]*(?:\([^)]*\)[^)]*)*)\)|<([0-9A-Fa-f\s]+)>)/);
                    if (titleMatch) {
                        method4Count++;
                        let title = '';
                        let matchType = '';
                        let rawData = '';
                        let hexDump = '';

                        if (titleMatch[1] !== undefined) {
                            matchType = 'æ‹¬å¼§å½¢å¼';
                            rawData = titleMatch[1].substring(0, 30);
                            // æ‹¬å¼§å½¢å¼: 8é€²æ•°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰
                            const decoded = decodePDFString(titleMatch[1]);
                            // ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœã‚’ãƒã‚¤ãƒˆé…åˆ—ã«å¤‰æ›ã—ã¦decodeTitleå‡¦ç†
                            const titleBytes = new Uint8Array(decoded.length);
                            for (let i = 0; i < decoded.length; i++) {
                                titleBytes[i] = decoded.charCodeAt(i) & 0xFF;
                            }
                            hexDump = Array.from(titleBytes.slice(0, 20)).map(b => b.toString(16).padStart(2, '0')).join(' ');
                            title = decodeTitle(titleBytes);
                        } else if (titleMatch[2] !== undefined) {
                            matchType = '16é€²æ•°å½¢å¼';
                            const hexStr = titleMatch[2].replace(/\s+/g, '');
                            rawData = hexStr.substring(0, 30);
                            hexDump = hexStr.substring(0, 40);
                            if (hexStr.toUpperCase().startsWith('FEFF')) {
                                // UTF-16BE BOM
                                const dataHex = hexStr.substring(4);
                                for (let i = 0; i + 4 <= dataHex.length; i += 4) {
                                    const charCode = parseInt(dataHex.substring(i, i + 4), 16);
                                    if (charCode > 0) title += String.fromCharCode(charCode);
                                }
                            } else if (hexStr.toUpperCase().startsWith('FFFE')) {
                                // UTF-16LE BOM - Acrobat JavaScriptå¯¾å¿œ
                                const dataHex = hexStr.substring(4);
                                for (let i = 0; i + 4 <= dataHex.length; i += 4) {
                                    const low = parseInt(dataHex.substring(i, i + 2), 16);
                                    const high = parseInt(dataHex.substring(i + 2, i + 4), 16);
                                    const charCode = (high << 8) | low;
                                    if (charCode > 0) title += String.fromCharCode(charCode);
                                }
                            } else if (hexStr.length >= 2) {
                                const hexBytes = new Uint8Array(hexStr.length / 2);
                                for (let i = 0; i + 2 <= hexStr.length; i += 2) {
                                    hexBytes[i / 2] = parseInt(hexStr.substring(i, i + 2), 16);
                                }
                                title = decodeTitle(hexBytes);
                            }
                        }

                        // ãƒ‡ãƒãƒƒã‚°ã‚µãƒ³ãƒ—ãƒ«åé›†
                        if (method4Samples.length < 5) {
                            method4Samples.push({
                                type: matchType,
                                raw: rawData,
                                hex: hexDump,
                                decoded: title ? title.substring(0, 30) : '(ç©º)'
                            });
                        }

                        if (title && title.trim() && !bookmarks.some(b => b.title === title.trim())) {
                            bookmarks.push({ title: title.trim(), page: '', level: 1 });
                        }
                    }
                }

                // æ–¹æ³•4ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒªãƒ¼
                console.log('[æ–¹æ³•4] === ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒªãƒ¼ ===');
                console.log('[æ–¹æ³•4] Titleãƒãƒƒãƒæ•°:', method4Count);
                console.log('[æ–¹æ³•4] æŠ½å‡ºæˆåŠŸ:', bookmarks.length, 'ä»¶');
                if (method4Samples.length > 0) {
                    console.log('[æ–¹æ³•4] ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿:');
                    method4Samples.forEach((s, i) => {
                        console.log('  ' + (i + 1) + '. type=' + s.type);
                        console.log('     raw: "' + s.raw + '..."');
                        console.log('     hex: ' + s.hex);
                        console.log('     decoded: "' + s.decoded + '"');
                    });
                }
            }

            /*
            --------------------------------------------------------------
              æ–¹æ³•5: è§£å‡æ¸ˆã¿contentå†…ã®BOMæ¤œç´¢
              è§£å‡å¾Œã®Latin-1æ–‡å­—åˆ—å†…ã§BOMãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢ã—ã€
              å¾Œç¶šã®ãƒã‚¤ãƒˆã‚’Shift_JIS/UTF-8ã¨ã—ã¦è§£é‡ˆ
            --------------------------------------------------------------
            */
            console.log('[extractBookmarks] æ–¹æ³•5ãƒã‚§ãƒƒã‚¯: ç¾åœ¨ã®bookmarksæ•°:', bookmarks.length);
            if (bookmarks.length === 0) {
                console.log('[extractBookmarks] æ–¹æ³•5: è§£å‡æ¸ˆã¿contentå†…BOMæ¤œç´¢é–‹å§‹');

                // ãƒ‡ãƒãƒƒã‚°: ã€Œç¬¬1éƒ¨ å…±é€šã€ã®å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’contentå†…ã§æ¤œç´¢
                // ãƒ‘ã‚¿ãƒ¼ãƒ³1: åŠè§’æ•°å­—(1)ã€åŠè§’ã‚¹ãƒšãƒ¼ã‚¹
                const patterns = [
                    { name: 'åŠè§’1+åŠè§’SP',
                      be: '\u007b\u002c\u0000\u0031\u0090\u00e8\u0000\u0020\u0051\u0071\u0090\u001a',
                      le: '\u002c\u007b\u0031\u0000\u00e8\u0090\u0020\u0000\u0071\u0051\u001a\u0090',
                      utf8: '\u00e7\u00ac\u00ac\u0031\u00e9\u0083\u00a8\u0020\u00e5\u0085\u00b1\u00e9\u0080\u009a' },
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³2: åŠè§’æ•°å­—(1)ã€å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
                    { name: 'åŠè§’1+å…¨è§’SP',
                      be: '\u007b\u002c\u0000\u0031\u0090\u00e8\u0030\u0000\u0051\u0071\u0090\u001a',
                      le: '\u002c\u007b\u0031\u0000\u00e8\u0090\u0000\u0030\u0071\u0051\u001a\u0090',
                      utf8: '\u00e7\u00ac\u00ac\u0031\u00e9\u0083\u00a8\u00e3\u0080\u0080\u00e5\u0085\u00b1\u00e9\u0080\u009a' },
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³3: å…¨è§’æ•°å­—(ï¼‘)ã€åŠè§’ã‚¹ãƒšãƒ¼ã‚¹
                    { name: 'å…¨è§’1+åŠè§’SP',
                      be: '\u007b\u002c\u00ff\u0011\u0090\u00e8\u0000\u0020\u0051\u0071\u0090\u001a',
                      le: '\u002c\u007b\u0011\u00ff\u00e8\u0090\u0020\u0000\u0071\u0051\u001a\u0090',
                      utf8: '\u00e7\u00ac\u00ac\u00ef\u00bc\u0091\u00e9\u0083\u00a8\u0020\u00e5\u0085\u00b1\u00e9\u0080\u009a' },
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³4: å…¨è§’æ•°å­—(ï¼‘)ã€å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
                    { name: 'å…¨è§’1+å…¨è§’SP',
                      be: '\u007b\u002c\u00ff\u0011\u0090\u00e8\u0030\u0000\u0051\u0071\u0090\u001a',
                      le: '\u002c\u007b\u0011\u00ff\u00e8\u0090\u0000\u0030\u0071\u0051\u001a\u0090',
                      utf8: '\u00e7\u00ac\u00ac\u00ef\u00bc\u0091\u00e9\u0083\u00a8\u00e3\u0080\u0080\u00e5\u0085\u00b1\u00e9\u0080\u009a' }
                ];

                console.log('[ãƒ‡ãƒãƒƒã‚°] ã€Œç¬¬1éƒ¨ å…±é€šã€ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œç´¢çµæœ:');
                for (const p of patterns) {
                    const bePos = content.indexOf(p.be);
                    const lePos = content.indexOf(p.le);
                    const utf8Pos = content.indexOf(p.utf8);
                    console.log('  ' + p.name + ':');
                    console.log('    UTF-16BE:', bePos >= 0 ? bePos : 'Ã—');
                    console.log('    UTF-16LE:', lePos >= 0 ? lePos : 'Ã—');
                    console.log('    UTF-8:', utf8Pos >= 0 ? utf8Pos : 'Ã—');
                }

                // Shift_JISãƒ‡ã‚³ãƒ¼ãƒ‰é–¢æ•°ï¼ˆLatin-1æ–‡å­—åˆ—ã‹ã‚‰Shift_JISãƒã‚¤ãƒˆã¨ã—ã¦è§£é‡ˆï¼‰
                function decodeShiftJIS(latin1Str) {
                    try {
                        // Latin-1æ–‡å­—åˆ—ã‚’ãƒã‚¤ãƒˆé…åˆ—ã«å¤‰æ›
                        const byteArray = new Uint8Array(latin1Str.length);
                        for (let j = 0; j < latin1Str.length; j++) {
                            byteArray[j] = latin1Str.charCodeAt(j) & 0xFF;
                        }
                        // Shift_JISã¨ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰
                        return new TextDecoder('shift_jis').decode(byteArray);
                    } catch (e) {
                        return null;
                    }
                }

                // UTF-8ãƒ‡ã‚³ãƒ¼ãƒ‰é–¢æ•°ï¼ˆLatin-1æ–‡å­—åˆ—ã‹ã‚‰UTF-8ãƒã‚¤ãƒˆã¨ã—ã¦è§£é‡ˆï¼‰
                function decodeUTF8FromLatin1(latin1Str) {
                    try {
                        const byteArray = new Uint8Array(latin1Str.length);
                        for (let j = 0; j < latin1Str.length; j++) {
                            byteArray[j] = latin1Str.charCodeAt(j) & 0xFF;
                        }
                        return new TextDecoder('utf-8').decode(byteArray);
                    } catch (e) {
                        return null;
                    }
                }

                // UTF-16ãƒ‡ã‚³ãƒ¼ãƒ‰é–¢æ•°ï¼ˆLatin-1æ–‡å­—åˆ—ã‹ã‚‰UTF-16ãƒã‚¤ãƒˆã¨ã—ã¦è§£é‡ˆï¼‰
                function decodeUTF16FromLatin1(latin1Str, isLE) {
                    try {
                        const byteArray = new Uint8Array(latin1Str.length);
                        for (let j = 0; j < latin1Str.length; j++) {
                            byteArray[j] = latin1Str.charCodeAt(j) & 0xFF;
                        }
                        const encoding = isLE ? 'utf-16le' : 'utf-16be';
                        return new TextDecoder(encoding).decode(byteArray);
                    } catch (e) {
                        return null;
                    }
                }

                // ãƒã‚¤ãƒˆã‚¹ãƒ¯ãƒƒãƒ—ã—ã¦UTF-16ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼ˆBOMã¨é€†ã®ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ï¼‰
                function decodeUTF16Swapped(latin1Str, bomIsLE) {
                    try {
                        const byteArray = new Uint8Array(latin1Str.length);
                        // ãƒã‚¤ãƒˆã‚’2ãƒã‚¤ãƒˆãšã¤ã‚¹ãƒ¯ãƒƒãƒ—
                        for (let j = 0; j < latin1Str.length - 1; j += 2) {
                            byteArray[j] = latin1Str.charCodeAt(j + 1) & 0xFF;
                            byteArray[j + 1] = latin1Str.charCodeAt(j) & 0xFF;
                        }
                        if (latin1Str.length % 2 === 1) {
                            byteArray[latin1Str.length - 1] = latin1Str.charCodeAt(latin1Str.length - 1) & 0xFF;
                        }
                        // BOMãŒLEãªã‚‰ã‚¹ãƒ¯ãƒƒãƒ—å¾Œã¯BEã¨ã—ã¦è§£é‡ˆ
                        const encoding = bomIsLE ? 'utf-16be' : 'utf-16le';
                        return new TextDecoder(encoding).decode(byteArray);
                    } catch (e) {
                        return null;
                    }
                }

                // æ—¥æœ¬èªæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                function hasJapanese(str) {
                    return /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]/.test(str);
                }

                // contentå†…ã§BOMãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆLatin-1æ–‡å­—ã¨ã—ã¦ï¼‰ã‚’æ¤œç´¢
                // UTF-16LE BOM: \xFF\xFE â†’ Latin-1ã§ã¯ Ã¿Ã¾ (charCode 255, 254)
                // UTF-16BE BOM: \xFE\xFF â†’ Latin-1ã§ã¯ Ã¾Ã¿ (charCode 254, 255)
                let method5ContentCount = 0;
                let method5ContentSamples = [];

                for (let i = 0; i < content.length - 4; i++) {
                    const c1 = content.charCodeAt(i);
                    const c2 = content.charCodeAt(i + 1);

                    let bomType = null;
                    if (c1 === 0xFF && c2 === 0xFE) {
                        bomType = 'LE';
                    } else if (c1 === 0xFE && c2 === 0xFF) {
                        bomType = 'BE';
                    }

                    if (bomType) {
                        // BOMå¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºï¼ˆæœ€å¤§200æ–‡å­—ï¼‰
                        let endPos = i + 2;
                        while (endPos < content.length && endPos < i + 200) {
                            const c = content.charCodeAt(endPos);
                            // çµ‚ç«¯æ–‡å­—ã‚’æ¤œå‡º
                            if (c === 0 || c === 0x29 || c === 0x3E || c === 0x3C) break;
                            // æ”¹è¡Œ
                            if (c === 0x0A || c === 0x0D) break;
                            endPos++;
                        }

                        if (endPos > i + 4) {
                            const dataStr = content.substring(i + 2, endPos);
                            method5ContentCount++;

                            // è¤‡æ•°ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è©¦è¡Œï¼ˆæ—¥æœ¬èªæ–‡å­—æ•°ãŒæœ€ã‚‚å¤šã„ã‚‚ã®ã‚’æ¡ç”¨ï¼‰
                            let bestTitle = null;
                            let bestEncoding = '';
                            let bestJPCount = 0;

                            // CIDãƒ‡ã‚³ãƒ¼ãƒ‰ç”¨ã®ãƒã‚¤ãƒˆé…åˆ—ã‚’æº–å‚™
                            const cidBytes = new Uint8Array(dataStr.length);
                            for (let j = 0; j < dataStr.length; j++) {
                                cidBytes[j] = dataStr.charCodeAt(j) & 0xFF;
                            }

                            const candidates = [
                                { fn: () => decodeUTF16FromLatin1(dataStr, bomType === 'LE'), name: 'UTF-16' + bomType },
                                { fn: () => decodeUTF16Swapped(dataStr, bomType === 'LE'), name: 'UTF-16' + (bomType === 'LE' ? 'BE' : 'LE') + '-swap' },
                                { fn: () => decodeCIDText(cidBytes, cidToUnicode), name: 'CID' },
                                { fn: () => decodeShiftJIS(dataStr), name: 'Shift_JIS' },
                                { fn: () => decodeUTF8FromLatin1(dataStr), name: 'UTF-8' }
                            ];

                            for (const cand of candidates) {
                                try {
                                    const decoded = cand.fn();
                                    if (decoded) {
                                        const jpMatches = decoded.match(/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]/g) || [];
                                        if (jpMatches.length > bestJPCount) {
                                            bestJPCount = jpMatches.length;
                                            bestTitle = decoded;
                                            bestEncoding = cand.name;
                                        }
                                    }
                                } catch (e) {}
                            }

                            let title = bestTitle;
                            let encoding = bestEncoding;

                            if (title && title.trim().length >= 2) {
                                // åˆ¶å¾¡æ–‡å­—ãƒã‚§ãƒƒã‚¯
                                const controlChars = (title.match(/[\x00-\x1F]/g) || []).length;
                                if (controlChars < title.length * 0.1) {
                                    if (!bookmarks.some(b => b.title === title.trim())) {
                                        // ãƒ‡ãƒãƒƒã‚°ã‚µãƒ³ãƒ—ãƒ«åé›†
                                        if (method5ContentSamples.length < 5) {
                                            const hexDump = [];
                                            for (let h = 0; h < Math.min(dataStr.length, 20); h++) {
                                                hexDump.push(dataStr.charCodeAt(h).toString(16).padStart(2, '0'));
                                            }
                                            method5ContentSamples.push({
                                                type: encoding + ' (BOM ' + bomType + ')',
                                                hex: hexDump.join(' '),
                                                decoded: title.trim().substring(0, 30),
                                                hasJP: hasJapanese(title)
                                            });
                                        }
                                        bookmarks.push({ title: title.trim(), page: '', level: 1 });
                                    }
                                }
                            }
                        }
                    }
                }

                console.log('[æ–¹æ³•5-content] BOMæ¤œå‡ºæ•°:', method5ContentCount);
                console.log('[æ–¹æ³•5-content] æŠ½å‡ºæˆåŠŸ:', bookmarks.length, 'ä»¶');
                if (method5ContentSamples.length > 0) {
                    console.log('[æ–¹æ³•5-content] ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿:');
                    method5ContentSamples.forEach((s, i) => {
                        console.log('  ' + (i + 1) + '. type=' + s.type + ' hasJP=' + s.hasJP);
                        console.log('     hex: ' + s.hex);
                        console.log('     decoded: "' + s.decoded + '"');
                    });
                }
            }

            /*
            --------------------------------------------------------------
              æ–¹æ³•6: ãƒã‚¤ãƒŠãƒªç›´æ¥æ¤œç´¢ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰
              åœ§ç¸®ã•ã‚Œã¦ã„ãªã„ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç›´æ¥ã—ãŠã‚Šã‚’æ¢ã™
            --------------------------------------------------------------
            */
            console.log('[extractBookmarks] æ–¹æ³•6ãƒã‚§ãƒƒã‚¯: ç¾åœ¨ã®bookmarksæ•°:', bookmarks.length);
            if (bookmarks.length === 0) {
                console.log('[extractBookmarks] æ–¹æ³•6: ãƒã‚¤ãƒŠãƒªç›´æ¥æ¤œç´¢é–‹å§‹');
                // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¨ã‚µãƒ³ãƒ—ãƒ«åé›†
                let method6BECount = 0;
                let method6LECount = 0;
                let method6UTF8Count = 0;
                let method6CIDCount = 0;
                let method6Samples = [];

                // BOMå¾Œã®ãƒã‚¤ãƒˆãŒUTF-8ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°
                function looksLikeUTF8(dataBytes) {
                    // UTF-8ã®ç‰¹å¾´: 0xE0-0xEF (3ãƒã‚¤ãƒˆæ–‡å­—ã®å…ˆé ­), 0x80-0xBF (ç¶™ç¶šãƒã‚¤ãƒˆ)
                    let utf8Score = 0;
                    let utf16Score = 0;
                    for (let j = 0; j < Math.min(dataBytes.length, 20); j++) {
                        const b = dataBytes[j];
                        // UTF-8ã®3ãƒã‚¤ãƒˆæ–‡å­—é–‹å§‹ (æ—¥æœ¬èª)
                        if (b >= 0xE0 && b <= 0xEF) utf8Score += 3;
                        // UTF-8ç¶™ç¶šãƒã‚¤ãƒˆ
                        else if (b >= 0x80 && b <= 0xBF) utf8Score += 1;
                        // UTF-16æ—¥æœ¬èªç¯„å›² (ã²ã‚‰ãŒãª: 30xx, ã‚«ã‚¿ã‚«ãƒŠ: 30xx, æ¼¢å­—: 4Exx-9Fxx)
                        else if (b >= 0x30 && b <= 0x9F) utf16Score += 2;
                        // ASCII
                        else if (b >= 0x20 && b <= 0x7E) { utf8Score += 0.5; utf16Score += 0.5; }
                    }
                    return utf8Score > utf16Score;
                }

                // UTF-8æ–‡å­—åˆ—ã®çµ‚ç«¯ã‚’æ¢ã™é–¢æ•°
                function findUTF8End(data, startPos, maxLen) {
                    let pos = startPos;
                    while (pos < data.length && pos < startPos + maxLen) {
                        const b = data[pos];
                        // NULLçµ‚ç«¯ã¾ãŸã¯åˆ¶å¾¡æ–‡å­—
                        if (b === 0 || (b < 0x20 && b !== 0x09 && b !== 0x0A && b !== 0x0D)) {
                            break;
                        }
                        // é–‰ã˜æ‹¬å¼§ã‚„PDFåŒºåˆ‡ã‚Šæ–‡å­—
                        if (b === 0x29 || b === 0x3E || b === 0x3C) { // ) > <
                            break;
                        }
                        pos++;
                    }
                    return pos;
                }

                // UTF-16BE BOM (FEFF) ã¾ãŸã¯ UTF-16LE BOM (FFFE) ã‚’æ¢ã™
                for (let i = 0; i < bytes.length - 4; i++) {
                    let bomType = null;
                    if (bytes[i] === 0xFE && bytes[i + 1] === 0xFF) {
                        bomType = 'BE';
                    } else if (bytes[i] === 0xFF && bytes[i + 1] === 0xFE) {
                        bomType = 'LE';
                    }

                    if (bomType) {
                        // BOMå¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                        const dataStart = i + 2;
                        const dataBytes = bytes.slice(dataStart, Math.min(dataStart + 30, bytes.length));

                        // UTF-8ã£ã½ã„ã‹ãƒã‚§ãƒƒã‚¯
                        const isUTF8 = looksLikeUTF8(dataBytes);

                        if (isUTF8) {
                            // UTF-8ã¨ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼ˆBOMã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼‰
                            const endPos = findUTF8End(bytes, dataStart, 512);
                            if (endPos > dataStart + 2) {
                                const titleBytes = bytes.slice(dataStart, endPos);
                                method6UTF8Count++;
                                try {
                                    const title = new TextDecoder('utf-8').decode(titleBytes);
                                    if (title && title.trim().length >= 2 && !bookmarks.some(b => b.title === title.trim())) {
                                        const controlChars = (title.match(/[\x00-\x1F]/g) || []).length;
                                        if (controlChars < title.length * 0.1) {
                                            if (method6Samples.length < 5) {
                                                const hexDump = Array.from(bytes.slice(i, Math.min(i + 20, bytes.length))).map(b => b.toString(16).padStart(2, '0')).join(' ');
                                                method6Samples.push({
                                                    type: 'UTF-8 (BOM ' + bomType + ' skipped)',
                                                    hex: hexDump,
                                                    decoded: title.trim().substring(0, 30)
                                                });
                                            }
                                            bookmarks.push({ title: title.trim(), page: '', level: 1 });
                                        }
                                    }
                                } catch (e) {
                                    // ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
                                }
                            }
                        } else {
                            // å¾“æ¥ã®UTF-16ãƒ‡ã‚³ãƒ¼ãƒ‰
                            let endPos = i + 2;
                            if (bomType === 'BE') {
                                method6BECount++;
                                while (endPos < bytes.length - 1 && endPos < i + 512) {
                                    const high = bytes[endPos];
                                    const low = bytes[endPos + 1];
                                    const charCode = (high << 8) | low;
                                    if (charCode === 0 || (high === 0 && low < 0x20 && low !== 0x09 && low !== 0x0A && low !== 0x0D)) {
                                        break;
                                    }
                                    endPos += 2;
                                }
                            } else {
                                method6LECount++;
                                while (endPos < bytes.length - 1 && endPos < i + 512) {
                                    const low = bytes[endPos];
                                    const high = bytes[endPos + 1];
                                    const charCode = (high << 8) | low;
                                    if (charCode === 0 || (high === 0 && low < 0x20 && low !== 0x09 && low !== 0x0A && low !== 0x0D)) {
                                        break;
                                    }
                                    endPos += 2;
                                }
                            }

                            if (endPos > i + 4) {
                                const titleBytes = bytes.slice(i, endPos);
                                const dataBytesForCID = bytes.slice(i + 2, endPos);  // BOMã‚’é™¤ã„ãŸãƒ‡ãƒ¼ã‚¿
                                let title = '';
                                let decodedType = 'UTF-16' + bomType;
                                let hasJapanese = false;

                                // ã¾ãšUTF-16ã‚’è©¦ã™
                                try {
                                    const encoding = bomType === 'BE' ? 'utf-16be' : 'utf-16le';
                                    title = new TextDecoder(encoding).decode(titleBytes);
                                    hasJapanese = /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]/.test(title);
                                } catch (e) {
                                    title = '';
                                }

                                // UTF-16ã§æ—¥æœ¬èªãŒå«ã¾ã‚Œãªã‘ã‚Œã°CIDã‚’è©¦ã™
                                if (title && !hasJapanese && Object.keys(cidToUnicode).length > 0) {
                                    const cidDecoded = decodeCIDText(dataBytesForCID, cidToUnicode);
                                    if (cidDecoded && /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]/.test(cidDecoded)) {
                                        title = cidDecoded;
                                        decodedType = 'CID';
                                        method6CIDCount++;
                                    }
                                }

                                if (title && title.trim().length >= 2 && !bookmarks.some(b => b.title === title.trim())) {
                                    const controlChars = (title.match(/[\x00-\x1F]/g) || []).length;
                                    if (controlChars < title.length * 0.1) {
                                        if (method6Samples.length < 5) {
                                            const hexDump = Array.from(titleBytes.slice(0, 20)).map(b => b.toString(16).padStart(2, '0')).join(' ');
                                            method6Samples.push({
                                                type: decodedType,
                                                hex: hexDump,
                                                decoded: title.trim().substring(0, 30)
                                            });
                                        }
                                        bookmarks.push({ title: title.trim(), page: '', level: 1 });
                                    }
                                }
                            }
                        }
                    }
                }

                // æ–¹æ³•6ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒªãƒ¼
                console.log('[æ–¹æ³•6] === ãƒ‡ãƒãƒƒã‚°ã‚µãƒãƒªãƒ¼ ===');
                console.log('[æ–¹æ³•6] UTF-16BEæ¤œå‡ºæ•°:', method6BECount);
                console.log('[æ–¹æ³•6] UTF-16LEæ¤œå‡ºæ•°:', method6LECount);
                console.log('[æ–¹æ³•6] UTF-8(BOMã‚¹ã‚­ãƒƒãƒ—)æ¤œå‡ºæ•°:', method6UTF8Count);
                console.log('[æ–¹æ³•6] CIDãƒ‡ã‚³ãƒ¼ãƒ‰ä½¿ç”¨æ•°:', method6CIDCount);
                console.log('[æ–¹æ³•6] æŠ½å‡ºæˆåŠŸ:', bookmarks.length, 'ä»¶');
                if (method6Samples.length > 0) {
                    console.log('[æ–¹æ³•6] ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿:');
                    method6Samples.forEach((s, i) => {
                        console.log('  ' + (i + 1) + '. type=' + s.type);
                        console.log('     hex: ' + s.hex);
                        console.log('     decoded: "' + s.decoded + '"');
                    });
                }
            }

            /*
            --------------------------------------------------------------
              ãƒšãƒ¼ã‚¸å‚ç…§ã‚’æ¤œç´¢ã—ã¦ã—ãŠã‚Šã«é–¢é€£ä»˜ã‘
              /Dest [ãƒšãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç•ªå· 0 R ...] ã®å½¢å¼
            --------------------------------------------------------------
            */
            const destPattern = /\/Dest\s*\[\s*(\d+)\s+\d+\s+R/g;
            const destinations = [];
            while ((match = destPattern.exec(content)) !== null) {
                destinations.push(match[1]);
            }

            // ã—ãŠã‚Šã«ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å‰²ã‚Šå½“ã¦
            // Math.min(): å°ã•ã„æ–¹ã®å€¤ã‚’è¿”ã™
            for (let i = 0; i < Math.min(bookmarks.length, destinations.length); i++) {
                const pageRef = destinations[i];
                if (pageObjects[pageRef]) {
                    // ãƒãƒƒãƒ”ãƒ³ã‚°ã«ã‚ã‚Œã°ãƒšãƒ¼ã‚¸ç•ªå·ã‚’è¨­å®š
                    bookmarks[i].page = pageObjects[pageRef];
                } else {
                    // ãªã‘ã‚Œã°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç•ªå·ã‚’ãã®ã¾ã¾ä½¿ç”¨
                    bookmarks[i].page = parseInt(pageRef) || '';
                }
            }

            // éšå±¤æ§‹é€ ã®è§£æã‚’è©¦ã¿ã‚‹
            analyzeHierarchy(content, bookmarks);

            console.log('[extractBookmarks] === æœ€çµ‚çµæœ ===');
            console.log('[extractBookmarks] æŠ½å‡ºä»¶æ•°:', bookmarks.length);
            if (bookmarks.length > 0 && bookmarks.length <= 5) {
                bookmarks.forEach((b, i) => console.log('  ' + (i+1) + '. ' + b.title.substring(0, 40)));
            } else if (bookmarks.length > 5) {
                for (let i = 0; i < 3; i++) {
                    console.log('  ' + (i+1) + '. ' + bookmarks[i].title.substring(0, 40));
                }
                console.log('  ... (ä»– ' + (bookmarks.length - 3) + ' ä»¶)');
            }

            return bookmarks;
        }

        /*
        ======================================================================
          PDFã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹é–¢æ•°

          PDFæ–‡å­—åˆ—å†…ã®ç‰¹æ®Šæ–‡å­—ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰
          ä¾‹: \n â†’ æ”¹è¡Œã€\( â†’ (ã€\123 â†’ 8é€²æ•°ã®æ–‡å­—ã€\xNN â†’ 16é€²æ•°ã®æ–‡å­—
        ======================================================================
        */
        function decodePDFString(str) {
            /*
            PDFã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’æ­£ç¢ºã«ãƒ‡ã‚³ãƒ¼ãƒ‰
            Adobe Acrobat JavaScriptç”Ÿæˆã®ã—ãŠã‚Šå¯¾å¿œ
            - 8é€²æ•°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—: \NNN (000-377)
            - 16é€²æ•°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—: \xNN
            - ç‰¹æ®Šæ–‡å­—: \n, \r, \t, \b, \f, \\, \(, \)
            */

            // ãƒ‡ãƒãƒƒã‚°: å…¥åŠ›æ–‡å­—åˆ—ã®æœ€åˆã®20ãƒã‚¤ãƒˆã‚’16é€²æ•°ã§å‡ºåŠ›
            const debugBytes = [];
            for (let d = 0; d < Math.min(str.length, 20); d++) {
                debugBytes.push(str.charCodeAt(d).toString(16).padStart(2, '0'));
            }
            console.log('[decodePDFString] å…¥åŠ›ãƒã‚¤ãƒˆ(å…ˆé ­20):', debugBytes.join(' '));
            console.log('[decodePDFString] å…¥åŠ›é•·:', str.length);

            let result = '';
            let i = 0;
            let escapeCount = 0;

            while (i < str.length) {
                if (str[i] === '\\' && i + 1 < str.length) {
                    const nextChar = str[i + 1];

                    // 8é€²æ•°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—: \0 - \377
                    if (nextChar >= '0' && nextChar <= '7') {
                        escapeCount++;
                        // æœ€å¤§3æ¡ã®8é€²æ•°ã‚’å–å¾—
                        let octalStr = '';
                        let j = i + 1;
                        while (j < str.length && j < i + 4 && str[j] >= '0' && str[j] <= '7') {
                            octalStr += str[j];
                            j++;
                        }
                        const charCode = parseInt(octalStr, 8);
                        // 8é€²æ•°ã®å€¤ãŒ255ã‚’è¶…ãˆã‚‹å ´åˆã¯åˆ†å‰²å‡¦ç†
                        if (charCode <= 255) {
                            result += String.fromCharCode(charCode);
                            i = j;
                        } else {
                            // 3æ¡ã§255è¶…ãˆã®å ´åˆã€2æ¡ã¨ã—ã¦è§£é‡ˆ
                            console.log('[decodePDFString] 8é€²æ•°255è¶…ãˆ:', octalStr, '-> 2æ¡è§£é‡ˆ:', octalStr.substring(0, 2));
                            const twoDigitOctal = octalStr.substring(0, 2);
                            result += String.fromCharCode(parseInt(twoDigitOctal, 8));
                            i += 3; // \NN ã®åˆ†
                        }
                        continue;
                    }

                    // 16é€²æ•°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—: \xNN
                    if (nextChar === 'x' && i + 3 < str.length) {
                        const hexStr = str.substring(i + 2, i + 4);
                        if (/^[0-9A-Fa-f]{2}$/.test(hexStr)) {
                            result += String.fromCharCode(parseInt(hexStr, 16));
                            i += 4;
                            continue;
                        }
                    }

                    // ç‰¹æ®Šæ–‡å­—ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
                    switch (nextChar) {
                        case 'n': result += '\n'; i += 2; continue;
                        case 'r': result += '\r'; i += 2; continue;
                        case 't': result += '\t'; i += 2; continue;
                        case 'b': result += '\b'; i += 2; continue;
                        case 'f': result += '\f'; i += 2; continue;
                        case '(': result += '('; i += 2; continue;
                        case ')': result += ')'; i += 2; continue;
                        case '\\': result += '\\'; i += 2; continue;
                        case '\r':
                            // è¡Œç¶™ç¶šï¼ˆ\r ã¾ãŸã¯ \r\nï¼‰
                            i += 2;
                            if (i < str.length && str[i] === '\n') i++;
                            continue;
                        case '\n':
                            // è¡Œç¶™ç¶šï¼ˆ\nï¼‰
                            i += 2;
                            continue;
                        default:
                            // ä¸æ˜ãªã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã¯æ–‡å­—ãã®ã‚‚ã®ã¨ã—ã¦æ‰±ã†
                            result += nextChar;
                            i += 2;
                            continue;
                    }
                }

                result += str[i];
                i++;
            }

            // ãƒ‡ãƒãƒƒã‚°: çµæœã‚’å‡ºåŠ›
            const resultBytes = [];
            for (let d = 0; d < Math.min(result.length, 20); d++) {
                resultBytes.push(result.charCodeAt(d).toString(16).padStart(2, '0'));
            }
            console.log('[decodePDFString] å‡ºåŠ›ãƒã‚¤ãƒˆ(å…ˆé ­20):', resultBytes.join(' '));
            console.log('[decodePDFString] å‡ºåŠ›é•·:', result.length, 'ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†æ•°:', escapeCount);

            return result;
        }

        /*
        ======================================================================
          PDFDocEncodingã‚’Unicodeã«å¤‰æ›ã™ã‚‹é–¢æ•°

          PDFDocEncodingã¯0x80-0x9Fç¯„å›²ã§Latin-1ã¨ç•°ãªã‚‹ç‹¬è‡ªãƒãƒƒãƒ”ãƒ³ã‚°ã‚’æŒã¤
          Adobe Acrobatã§ä½œæˆã•ã‚ŒãŸPDFã§ä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹
        ======================================================================
        */
        function decodePDFDocEncoding(bytes) {
            // PDFDocEncodingç‰¹æ®Šæ–‡å­—ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆ0x80-0x9F, 0xADï¼‰
            const pdfDocEncodingMap = {
                0x80: 0x2022, // BULLET
                0x81: 0x2020, // DAGGER
                0x82: 0x2021, // DOUBLE DAGGER
                0x83: 0x2026, // HORIZONTAL ELLIPSIS
                0x84: 0x2014, // EM DASH
                0x85: 0x2013, // EN DASH
                0x86: 0x0192, // LATIN SMALL LETTER F WITH HOOK
                0x87: 0x2044, // FRACTION SLASH
                0x88: 0x2039, // SINGLE LEFT-POINTING ANGLE QUOTATION MARK
                0x89: 0x203A, // SINGLE RIGHT-POINTING ANGLE QUOTATION MARK
                0x8A: 0x2212, // MINUS SIGN
                0x8B: 0x2030, // PER MILLE SIGN
                0x8C: 0x201E, // DOUBLE LOW-9 QUOTATION MARK
                0x8D: 0x201C, // LEFT DOUBLE QUOTATION MARK
                0x8E: 0x201D, // RIGHT DOUBLE QUOTATION MARK
                0x8F: 0x2018, // LEFT SINGLE QUOTATION MARK
                0x90: 0x2019, // RIGHT SINGLE QUOTATION MARK
                0x91: 0x201A, // SINGLE LOW-9 QUOTATION MARK
                0x92: 0x2122, // TRADE MARK SIGN
                0x93: 0xFB01, // LATIN SMALL LIGATURE FI
                0x94: 0xFB02, // LATIN SMALL LIGATURE FL
                0x95: 0x0141, // LATIN CAPITAL LETTER L WITH STROKE
                0x96: 0x0152, // LATIN CAPITAL LIGATURE OE
                0x97: 0x0160, // LATIN CAPITAL LETTER S WITH CARON
                0x98: 0x0178, // LATIN CAPITAL LETTER Y WITH DIAERESIS
                0x99: 0x017D, // LATIN CAPITAL LETTER Z WITH CARON
                0x9A: 0x0131, // LATIN SMALL LETTER DOTLESS I
                0x9B: 0x0142, // LATIN SMALL LETTER L WITH STROKE
                0x9C: 0x0153, // LATIN SMALL LIGATURE OE
                0x9D: 0x0161, // LATIN SMALL LETTER S WITH CARON
                0x9E: 0x017E, // LATIN SMALL LETTER Z WITH CARON
                0x9F: 0xFFFF, // REPLACEMENT CHARACTER (undefined)
                0xA0: 0x20AC, // EURO SIGN
                0xAD: 0x00AD  // SOFT HYPHEN (keep as is)
            };

            let result = '';
            for (let i = 0; i < bytes.length; i++) {
                const b = bytes[i];
                if (pdfDocEncodingMap.hasOwnProperty(b)) {
                    const mapped = pdfDocEncodingMap[b];
                    if (mapped !== 0xFFFF) {
                        result += String.fromCharCode(mapped);
                    }
                } else {
                    result += String.fromCharCode(b);
                }
            }
            return result;
        }

        /*
        ======================================================================
          éšå±¤æ§‹é€ è§£æé–¢æ•°

          ã—ãŠã‚Šã®è¦ªå­é–¢ä¿‚ã‚’è§£æã—ã¦éšå±¤ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š
        ======================================================================
        */
        function analyzeHierarchy(content, bookmarks) {
            // ã—ãŠã‚Šã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŠ½å‡º
            // || []: ãƒãƒƒãƒãŒãªã‘ã‚Œã°ç©ºé…åˆ—ã‚’è¿”ã™
            const outlineItems = content.match(/\d+\s+\d+\s+obj[\s\S]*?\/Title[\s\S]*?endobj/g) || [];

            outlineItems.forEach((item, index) => {
                if (index < bookmarks.length) {
                    // /Parent ã¨ /First ã®å­˜åœ¨ã‚’ãƒã‚§ãƒƒã‚¯
                    const parentMatch = item.match(/\/Parent\s+(\d+)/);
                    const firstMatch = item.match(/\/First\s+(\d+)/);

                    // /Parent ãŒã‚ã‚Š /First ãŒãªã„ â†’ å­è¦ç´ ã®å¯èƒ½æ€§
                    if (parentMatch && !firstMatch) {
                        if (index > 0) {
                            // å‰ã®ã—ãŠã‚Šã‚ˆã‚Š1ãƒ¬ãƒ™ãƒ«æ·±ã
                            // Math.min(): æœ€å¤§5ãƒ¬ãƒ™ãƒ«ã«åˆ¶é™
                            bookmarks[index].level = Math.min(bookmarks[index - 1].level + 1, 5);
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
