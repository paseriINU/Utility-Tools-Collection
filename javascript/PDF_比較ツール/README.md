# PDF 比較ツール

2つのPDFファイルを視覚的に比較するブラウザベースのツールです。

## 特徴

- **追加インストール不要** - HTMLファイルをダブルクリックするだけで起動
- **完全スタンドアローン** - 1つのHTMLファイルで完結（ライブラリ埋め込み済み）
- **IT制限環境対応** - ブラウザがあれば動作、インターネット接続不要
- **並列表示** - 2つのPDFを左右に並べて表示
- **全ページ一覧表示** - 全ページを縦に並べてスクロールで閲覧
- **差分ハイライト** - 違いを色で視覚的に表示（黄=変更、緑=追加、赤=削除）
- **ドラッグ&ドロップ** - パネルに直接PDFをドロップして読み込み
- **同期スクロール** - 左右のPDFが連動してスクロール
- **ズーム機能** - 50%〜200%の範囲で拡大・縮小
- **統計情報** - 変更・追加・削除ブロック数と差分率を表示

## 必要な環境

- モダンブラウザ（Chrome, Firefox, Edge, Safari）
- インターネット接続は**不要**（ライブラリ埋め込み済み）

## 使い方

### 方法1: ドラッグ&ドロップ（推奨）

1. `PDF比較ツール.html` をダブルクリックしてブラウザで開く
2. 左側のパネルに旧PDFをドラッグ&ドロップ
3. 右側のパネルに新PDFをドラッグ&ドロップ
4. 両方のPDFが読み込まれると自動的に比較開始
5. 全ページが縦に並んで表示され、差分が色付きでハイライト表示される

### 方法2: ファイル選択ボタン

1. `PDF比較ツール.html` をダブルクリックしてブラウザで開く
2. ツールバーの「旧PDF」ボタンをクリックしてファイルを選択
3. ツールバーの「新PDF」ボタンをクリックしてファイルを選択
4. 「比較実行」ボタンをクリック

### 操作方法

- **ページ移動**: マウスホイールまたはスクロールバーで全ページを閲覧
- **ズーム**: ツールバーの倍率セレクトで50%〜200%の範囲で拡大・縮小
- **スクロール**: 左右のビューは同期してスクロール（チェックボックスで切替可能）
- **差分確認**: 色付きの領域が差異箇所

## 出力形式

### 画面表示

画面上部に統計情報を表示：
- **変更ブロック数**: 内容が変化した箇所
- **追加ブロック数**: 新ファイルに追加された箇所
- **削除ブロック数**: 旧ファイルから削除された箇所
- **差分率**: 全体に対する差分の割合（%）

### 色の凡例

- **黄色**: 内容の変更
- **緑色**: 新規追加
- **赤色**: 削除

## 技術仕様

### 使用ライブラリ

- **PDF.js** (Mozilla) - PDFをCanvasにレンダリング
  - バージョン: 3.11.174
  - HTMLファイルに埋め込み済み（外部ファイル不要）

### 差分検出アルゴリズム

**ピクセル単位比較 + ノイズ除去**（高精度版）：

1. **Phase 1**: 各ピクセルのグレースケール値を比較し、差分マップを作成
2. **Phase 2**: ノイズ除去フィルター適用（孤立した1ピクセルの差異は無視）
3. **Phase 3**: フィルター後の差分を色分けして描画

差分の分類：
- 両方に内容がある場合 → 変更（黄色）
- 旧PDFのみに内容がある場合 → 削除（赤色）
- 新PDFのみに内容がある場合 → 追加（緑色）

パラメータ：
- グレースケール閾値: 40（アンチエイリアス対策）
- ノイズフィルタサイズ: 周囲2ピクセル以内に2つ以上の差分が必要

## 制限事項

- **大きなPDF** - 高解像度のPDFは処理時間がかかる場合があります
- **メモリ使用量** - 複数ページのPDFを比較する場合、メモリ使用量が増加します
- **ファイルサイズ** - ライブラリ埋め込みのためHTMLファイルは約1.4MB

## フォルダ構成

```
PDF_比較ツール/
├── PDF比較ツール.html  ← スタンドアローン版（ライブラリ埋め込み済み）
└── README.md
```

## トラブルシューティング

### 「PDFが読み込めない」

- PDFファイルが破損していないか確認してください
- 暗号化されたPDFは読み込めない場合があります

### 「比較が遅い」

- ブラウザのメモリが不足している場合は、他のタブを閉じてください
- ズームレベルを下げると処理が軽くなります

## ライセンス

MIT License

## 更新履歴

- **2026-01-14**: PDF.js Workerコードを埋め込み
  - pdf.worker.min.jsをBlob URLとして埋め込み
  - PDF読み込みハング問題を修正
  - ファイルサイズ: 約300KB → 約1.4MB

- **2026-01-12**: 完全オフライン対応
  - CDN読み込みを廃止し、埋め込みライブラリのみに変更
  - 外部ネットワークへの依存を完全に排除

- **2026-01-11**: ピクセル単位比較アルゴリズムに変更（高精度化）
  - 8x8ブロック単位からピクセル単位の比較に変更
  - ノイズ除去フィルター追加（孤立した差異を無視）
  - グレースケール閾値を調整（アンチエイリアス対策）
  - 誤検出を大幅に削減し、精度向上

- **2025-12-18**: ソースコードに初心者向けコメントを追加
  - JavaScript部分に詳細な日本語コメントを追加
  - 各関数の説明、アルゴリズムの解説を追記
  - 変数、イベント処理、Canvas APIなどの初心者向け説明を追加

- **2025-12-17**: スタンドアローン版に変更
  - PDF.jsライブラリをHTMLに埋め込み
  - libフォルダを廃止（1ファイルで完結）
  - ファイル名をPDF比較ツール.htmlに変更

- **2025-12-17**: 全ページスクロール表示に変更
  - 全ページを縦に並べてスクロールで閲覧可能に
  - ページ切り替えボタンを廃止
  - 統計情報を全ページの累積に変更

- **2025-12-17**: ドラッグ&ドロップ機能追加
  - パネルに直接PDFをドロップして読み込み可能
  - 両方のPDFが読み込まれると自動で比較開始

- **2025-12-17**: 視覚比較ツール追加
  - PDFを左右に並べて視覚的に比較
  - ブロック単位の差分検出とカラーハイライト
  - 同期スクロール、ズーム機能
