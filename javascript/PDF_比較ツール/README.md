# PDF 比較ツール（WinMerge方式）

2つのPDFファイルを比較し、差異を一覧表示するブラウザベースのツールです。

## 特徴

- **追加インストール不要** - HTMLファイルをダブルクリックするだけで起動
- **高精度な差分検出** - LCS（最長共通部分列）アルゴリズムを使用
- **WinMerge方式の表示** - 旧/新ファイルの行番号を両方表示
- **IT制限環境対応** - ブラウザがあれば動作
- **オフライン対応** - ローカル優先・CDNフォールバック方式（ライブラリをローカルに配置すれば完全オフラインで動作）

## 必要な環境

- モダンブラウザ（Chrome, Firefox, Edge, Safari）
- インターネット接続（オプション：ローカルにライブラリを配置すれば不要）

## 使い方

### 基本的な使い方

1. `pdf_compare.html` をダブルクリックしてブラウザで開く
2. 「旧ファイル」エリアに比較元のPDFをドラッグ&ドロップ
3. 「新ファイル」エリアに比較先のPDFをドラッグ&ドロップ
4. 「比較を実行」ボタンをクリック
5. 差分が一覧表示される

### 結果のエクスポート

比較完了後、「CSVエクスポート」ボタンをクリックすると、結果をCSVファイルとしてダウンロードできます。

## 出力形式

### 画面表示

| No | 旧行番号 | 新行番号 | 差異タイプ | 旧ファイルのテキスト | 新ファイルのテキスト |
|----|----------|----------|------------|----------------------|----------------------|
| 1 | 5 | - | 削除 | 削除されたテキスト | |
| 2 | - | 6 | 追加 | | 追加されたテキスト |
| 3 | 10 | 11 | 変更 | 古いテキスト | 新しいテキスト |

### 色の凡例

- **黄色**: テキストの変更
- **緑色**: 新規追加
- **赤色**: 削除

## アルゴリズム

### LCS（最長共通部分列）アルゴリズム

Word比較ツールと同じLCSアルゴリズムを使用しています。

**利点：**
- 1行追加/削除があっても、以降の行がすべて差異として検出されない
- 実際に変更された箇所のみを正確に検出
- 行の移動にも対応

**パフォーマンス最適化：**
- 5000行を超える場合は自動的に簡易比較モードに切り替え
- 簡易比較モードでも実用的な精度を維持

## 技術仕様

### 使用ライブラリ

- **PDF.js** (Mozilla) - PDFからテキストを抽出
  - バージョン: 3.11.174
  - ローカルパス: `lib/pdf.min.js` および `lib/pdf.worker.min.js`
  - CDN: `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js`

### ライブラリ読み込み方式

**ローカル優先・CDNフォールバック方式**を採用しています：

1. 最初に `lib/pdf.min.js` からローカル読み込みを試行
2. ローカルファイルがない場合、CDNから自動的に読み込み
3. 画面ヘッダーに読み込み元を表示（緑:ローカル、オレンジ:CDN）

これにより、インターネット環境があればそのまま動作し、オフライン環境ではローカルファイルで動作します。

### 処理フロー

1. PDFファイルをブラウザで読み込み
2. PDF.jsでテキストを抽出（ページごと、行ごと）
3. LCSアルゴリズムで差分を計算
4. 隣接する削除→追加を「変更」にマージ
5. 結果を表形式で表示

## 制限事項

- **テキストベースPDFのみ対応** - スキャンした画像PDFは読み取れません（OCRが必要）
- **レイアウト情報は比較対象外** - テキスト内容のみを比較
- **大きなPDF** - 数千ページのPDFは処理時間がかかる場合があります

## トラブルシューティング

### 「PDFが読み込めない」

- PDFファイルが破損していないか確認してください
- 暗号化されたPDFは読み込めない場合があります

### 「テキストが抽出されない」

- スキャンした画像PDFは対象外です
- 一部のPDFはテキストレイヤーがない場合があります

### 「比較が遅い」

- 5000行を超えるPDFは簡易比較モードに自動切替されます
- ブラウザのメモリが不足している場合は、他のタブを閉じてください

## オフライン使用（IT制限環境対応）

lib/フォルダにライブラリファイルが同梱されているため、オフライン環境でもそのまま動作します。

### フォルダ構成

```
PDF_比較ツール/
├── pdf_compare.html
└── lib/
    ├── pdf.min.js        ← PDF.jsライブラリ
    └── pdf.worker.min.js ← PDF.jsワーカー
```

### 読み込み状態の確認

画面ヘッダーでライブラリの読み込み状態を確認できます：

| 表示 | 色 | 状態 |
|-----|---|-----|
| ライブラリ: ローカル | 緑 | lib/フォルダから読み込み成功 |
| ライブラリ: CDN（オンライン） | オレンジ | インターネットから読み込み |
| ライブラリ: 読み込み失敗 | 赤 | エラー（対処が必要） |

### ライブラリを更新する場合

新しいバージョンのpdf.jsを使用したい場合：

1. 以下からダウンロード：
   - https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js
   - https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js

2. lib/フォルダに配置（既存ファイルを上書き）

## ライセンス

MIT License

## 更新履歴

- **2025-12-16**: ライブラリ同梱版
  - lib/フォルダにpdf.min.js、pdf.worker.min.jsを同梱
  - オフライン環境でそのまま動作可能

- **2025-12-16**: 初版リリース
  - PDF.jsによるテキスト抽出
  - LCSアルゴリズムによる差分検出
  - WinMerge形式の結果表示
  - CSVエクスポート機能
