# JP1 ジョブツール

JP1/AJS3のジョブネット起動とログ取得を行うツールです。

## 概要

以下の処理を連続実行します：

1. **ジョブネット起動** - ajsentryでジョブネットを即時起動
2. **完了待ち** - ajsstatusでジョブ完了を待機
3. **ログ取得** - ajsshowでジョブの標準出力を取得しクリップボードにコピー

## 必要な環境

- Windows Server（JP1/AJS3がインストールされていること）
- JP1/AJS3 コマンドへのアクセス権限
- JP1ユーザー認証情報

## 特徴

| 項目 | 説明 |
|------|------|
| 実行方式 | ローカル実行（JP1サーバ上で直接実行） |
| 管理者権限 | 不要（JP1権限のみ必要） |
| 完了待ち | 対応（ajsstatusでポーリング） |
| ログ取得 | クリップボードに自動コピー |

## 使い方

### 1. 設定を編集

`JP1_ジョブツール.bat` の設定セクションを編集します：

```batch
rem JP1/AJS3コマンドのパス（インストールディレクトリ）
set "JP1_BIN=C:\Program Files\HITACHI\JP1AJS3\bin"

rem スケジューラーサービス名（通常は AJSROOT1）
set "SCHEDULER_SERVICE=AJSROOT1"

rem JP1ユーザー名（空の場合は実行時に入力）
set "JP1_USER=jp1admin"

rem JP1パスワード（空の場合は実行時に入力、セキュリティ上空欄推奨）
set "JP1_PASSWORD="

rem 起動するジョブネットのフルパス
set "JOBNET_PATH=/main_unit/jobgroup1/daily_batch"

rem ログ取得対象のジョブのフルパス（ジョブネット内のジョブを指定）
rem ※ジョブネットではなく、その中の個別ジョブを指定
set "JOB_PATH=/main_unit/jobgroup1/daily_batch/job1"
```

### 2. 実行

JP1/AJS3サーバ上でバッチファイルをダブルクリックして実行します。

### 3. 実行例

```
================================================================
  JP1 ジョブツール
================================================================

設定情報:
  JP1コマンドパス  : C:\Program Files\HITACHI\JP1AJS3\bin
  スケジューラー   : AJSROOT1
  JP1ユーザー      : jp1admin
  ジョブネットパス : /main_unit/jobgroup1/daily_batch
  ジョブパス       : /main_unit/jobgroup1/daily_batch/job1
  タイムアウト     : 3600秒

ジョブネットを起動し、完了後にログを取得しますか？ (y/n)
y

================================================================
ジョブネット起動中...
================================================================

コマンド実行中: ajsentry ...

----------------------------------------------------------------
ajsentry出力:
KAVS1820-I ajsentryコマンドが正常終了しました。
----------------------------------------------------------------

[OK] ジョブネットの起動に成功しました

================================================================
ジョブ完了待機中...
================================================================

  状態: 実行中... (経過時間: 0分10秒)
  状態: 実行中... (経過時間: 0分20秒)

================================================================
[OK] ジョブネットが正常終了しました
================================================================

================================================================
ジョブログを取得中...
================================================================

[情報] 標準出力ファイル: D:\JP1\spool\stdout_12345.txt

================================================================
取得したスプール内容:
================================================================

Processing started at 2025-12-23 10:30:00
Step 1: Data extraction completed
Step 2: Data transformation completed
Processing finished at 2025-12-23 10:35:00

================================================================
[OK] スプール内容をクリップボードにコピーしました
================================================================

================================================================
処理サマリー
================================================================

  ジョブネット : /main_unit/jobgroup1/daily_batch
  ジョブ       : /main_unit/jobgroup1/daily_batch/job1
  起動結果     : 成功
  実行結果     : 正常終了
  ログ取得     : 成功（クリップボードにコピー済み）

処理が完了しました。
```

## 設定項目

| 設定項目 | 説明 | デフォルト値 |
|---------|------|-------------|
| `JP1_BIN` | JP1コマンドのインストールパス | `C:\Program Files\HITACHI\JP1AJS3\bin` |
| `SCHEDULER_SERVICE` | スケジューラーサービス名 | `AJSROOT1` |
| `JP1_USER` | JP1ユーザー名 | `jp1admin` |
| `JP1_PASSWORD` | JP1パスワード（空欄推奨） | 空欄 |
| `JOBNET_PATH` | 起動するジョブネットのパス | `/main_unit/jobgroup1/daily_batch` |
| `JOB_PATH` | ログ取得対象のジョブパス | `/main_unit/jobgroup1/daily_batch/job1` |
| `WAIT_TIMEOUT` | タイムアウト（秒、0:無制限） | `3600` |
| `POLLING_INTERVAL` | 状態確認間隔（秒） | `10` |
| `JP1_HOST` | ホスト名（通常はlocalhost） | `localhost` |

## JOBNET_PATH と JOB_PATH の違い

| 項目 | 説明 | 例 |
|------|------|-----|
| `JOBNET_PATH` | ジョブネット全体のパス（起動対象） | `/main_unit/jobgroup1/daily_batch` |
| `JOB_PATH` | ジョブネット内の個別ジョブのパス（ログ取得対象） | `/main_unit/jobgroup1/daily_batch/job1` |

**注意**: ログ取得はジョブ単位で行われるため、`JOB_PATH`にはジョブネット内の個別ジョブを指定してください。

## 関連ツール

| ツール | 説明 |
|--------|------|
| [JP1 ローカルジョブ起動ツール](../JP1_ローカルジョブ起動ツール/) | ジョブネット起動のみ |
| [JP1 ジョブログ取得ツール](../JP1_ジョブログ取得ツール/) | ログ取得のみ |
| [JP1 リモートジョブ起動ツール](../JP1_リモートジョブ起動ツール/) | クライアントPCからリモート起動 |

## 注意事項

- JP1/AJS3がインストールされているサーバ上で実行してください
- パスワードを設定ファイルに記載する場合はセキュリティにご注意ください
- ジョブネットパス・ジョブパスは `/` から始まるフルパスで指定してください
- ログ取得はジョブが実行済み（スプールが存在する）である必要があります

## トラブルシューティング

### ajsentry.exe / ajsshow.exe が見つかりません

JP1/AJS3のインストールパスを確認してください：
- 標準パス: `C:\Program Files\HITACHI\JP1AJS3\bin`
- 32bit版: `C:\Program Files (x86)\HITACHI\JP1AJS3\bin`
- 旧バージョン: `C:\Program Files\Hitachi\JP1AJS2\bin`

### ログ取得で「選択オプションに合うユニットが存在しません」

- ジョブネットではなく、ジョブネット内の**個別ジョブ**を指定してください
- 例: `/グループ/ジョブネット` ではなく `/グループ/ジョブネット/ジョブ名`

### 認証エラー（KAVS4200-E）

- JP1ユーザー名とパスワードが正しいか確認してください
- JP1/Baseで認証が有効になっているか確認してください

## 使用コマンド

- `ajsentry` - ジョブネット即時実行
- `ajsstatus` - 実行状態取得
- `ajsshow -g 1 -i '%so'` - 標準出力ファイルパス取得

詳細は [JP1_AJS3_COMMANDS.md](../JP1_リモートジョブ起動ツール/JP1_AJS3_COMMANDS.md) を参照してください。

## ライセンス

MIT License
