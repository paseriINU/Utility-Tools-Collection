# JP1 ジョブツール

JP1/AJS3のジョブネット起動とログ取得を行うツールです。

## 概要

以下の処理を連続実行します：

1. **メニュー選択** - 実行するジョブを選択
2. **ジョブネット起動** - ajsentryでジョブネットを即時起動
3. **完了待ち** - ajsstatusでジョブ完了を待機
4. **ログ取得** - 2つのジョブの標準出力を取得しクリップボードにコピー

## 必要な環境

- Windows Server（JP1/AJS3がインストールされていること）
- JP1/AJS3 コマンドへのアクセス権限（パスが通っていること）

## 特徴

| 項目 | 説明 |
|------|------|
| 実行方式 | ローカル実行（JP1サーバ上で直接実行） |
| 管理者権限 | 不要 |
| メニュー選択 | 複数のジョブネットから選択可能 |
| ログ取得 | 2つのジョブログを結合してクリップボードにコピー |

## 使い方

### 1. 設定を編集

`JP1_ジョブツール.bat` の設定セクションを編集します：

```batch
rem スケジューラーサービス名（通常は AJSROOT1）
set "SCHEDULER_SERVICE=AJSROOT1"

rem ----------------------------------------------------------------------------
rem 選択肢1: TEST
rem ----------------------------------------------------------------------------
set "MENU1_NAME=TEST"
set "MENU1_JOBNET=/main_unit/jobgroup1/test_batch"
set "MENU1_JOB1=/main_unit/jobgroup1/test_batch/job1"
set "MENU1_JOB2=/main_unit/jobgroup1/test_batch/job2"

rem ----------------------------------------------------------------------------
rem 選択肢2: TEST2
rem ----------------------------------------------------------------------------
set "MENU2_NAME=TEST2"
set "MENU2_JOBNET=/main_unit/jobgroup2/test2_batch"
set "MENU2_JOB1=/main_unit/jobgroup2/test2_batch/job1"
set "MENU2_JOB2=/main_unit/jobgroup2/test2_batch/job2"
```

### 2. 実行

JP1/AJS3サーバ上でバッチファイルをダブルクリックして実行します。

### 3. 実行例

```
================================================================
  JP1 ジョブツール
================================================================

実行するジョブを選択してください:

  1. TEST
  2. TEST2

  0. キャンセル

選択 (0-2): 1

================================================================
選択: TEST
================================================================

設定情報:
  スケジューラー   : AJSROOT1
  ジョブネットパス : /main_unit/jobgroup1/test_batch
  ジョブパス1      : /main_unit/jobgroup1/test_batch/job1
  ジョブパス2      : /main_unit/jobgroup1/test_batch/job2
  タイムアウト     : 無制限

================================================================
ジョブネット起動中...
================================================================

コマンド実行中: ajsentry -F AJSROOT1 /main_unit/jobgroup1/test_batch

----------------------------------------------------------------
ajsentry出力:
KAVS1820-I ajsentryコマンドが正常終了しました。
----------------------------------------------------------------

[OK] ジョブネットの起動に成功しました

================================================================
ジョブ完了待機中...
================================================================

  状態: 実行中... (経過時間: 0分10秒)
  状態: 実行中... (経過時間: 0分20秒)

================================================================
[OK] ジョブネットが正常終了しました
================================================================

================================================================
ジョブログを取得中...
================================================================

[ジョブ1] /main_unit/jobgroup1/test_batch/job1

  標準出力ファイル: D:\JP1\spool\stdout_12345.txt
[OK] ジョブ1のログを取得しました

[ジョブ2] /main_unit/jobgroup1/test_batch/job2

  標準出力ファイル: D:\JP1\spool\stdout_12346.txt
[OK] ジョブ2のログを取得しました

================================================================
取得したスプール内容（2ジョブ分）:
================================================================

----------------------------------------------------------------
[ジョブ1] /main_unit/jobgroup1/test_batch/job1
----------------------------------------------------------------
Job1 output here...

----------------------------------------------------------------
[ジョブ2] /main_unit/jobgroup1/test_batch/job2
----------------------------------------------------------------
Job2 output here...

================================================================
[OK] スプール内容をクリップボードにコピーしました
================================================================

================================================================
処理サマリー
================================================================

  選択         : TEST
  ジョブネット : /main_unit/jobgroup1/test_batch
  ジョブ1      : /main_unit/jobgroup1/test_batch/job1
  ジョブ2      : /main_unit/jobgroup1/test_batch/job2
  起動結果     : 成功
  実行結果     : 正常終了
  ログ取得     : 成功（クリップボードにコピー済み）

処理が完了しました。
```

## 設定項目

| 設定項目 | 説明 | デフォルト値 |
|---------|------|-------------|
| `SCHEDULER_SERVICE` | スケジューラーサービス名 | `AJSROOT1` |
| `WAIT_TIMEOUT` | タイムアウト（秒、0:無制限） | `0` |
| `POLLING_INTERVAL` | 状態確認間隔（秒） | `10` |

### 選択肢の設定

| 設定項目 | 説明 |
|---------|------|
| `MENU1_NAME` | 選択肢1の表示名 |
| `MENU1_JOBNET` | 選択肢1のジョブネットパス |
| `MENU1_JOB1` | 選択肢1のログ取得対象ジョブ1 |
| `MENU1_JOB2` | 選択肢1のログ取得対象ジョブ2 |
| `MENU2_NAME` | 選択肢2の表示名 |
| `MENU2_JOBNET` | 選択肢2のジョブネットパス |
| `MENU2_JOB1` | 選択肢2のログ取得対象ジョブ1 |
| `MENU2_JOB2` | 選択肢2のログ取得対象ジョブ2 |

## 関連ツール

| ツール | 説明 |
|--------|------|
| [JP1 ローカルジョブ起動ツール](../JP1_ローカルジョブ起動ツール/) | ジョブネット起動のみ |
| [JP1 ジョブログ取得ツール](../JP1_ジョブログ取得ツール/) | ログ取得のみ |
| [JP1 リモートジョブ起動ツール](../JP1_リモートジョブ起動ツール/) | クライアントPCからリモート起動 |

## 注意事項

- JP1/AJS3がインストールされているサーバ上で実行してください
- JP1コマンドにパスが通っている必要があります
- ジョブネットパス・ジョブパスは `/` から始まるフルパスで指定してください
- ログ取得はジョブが実行済み（スプールが存在する）である必要があります

## トラブルシューティング

### ajsentryコマンドが見つかりません

JP1/AJS3コマンドにパスが通っているか確認してください。

### ログ取得で「選択オプションに合うユニットが存在しません」

- ジョブネットではなく、ジョブネット内の**個別ジョブ**を指定してください
- 例: `/グループ/ジョブネット` ではなく `/グループ/ジョブネット/ジョブ名`

## 使用コマンド

- `ajsentry` - ジョブネット即時実行
- `ajsstatus` - 実行状態取得
- `ajsshow -g 1 -i '%so'` - 標準出力ファイルパス取得

詳細は [JP1_AJS3_COMMANDS.md](../JP1_リモートジョブ起動ツール/JP1_AJS3_COMMANDS.md) を参照してください。

## ライセンス

MIT License
