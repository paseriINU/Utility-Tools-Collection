# Git リモートブランチリネームツール

Gitのリモートブランチを対話式でリネーム（名前変更）するツールです。

## 概要

Gitではリモートブランチの名前を直接変更することはできないため、以下の操作を自動化します：

1. ローカルブランチのリネーム（存在する場合）
2. 新しい名前でリモートにプッシュ
3. 旧リモートブランチの削除
4. 追跡ブランチの再設定

## 機能

- **一覧選択式リネーム**: リモートブランチの一覧から番号で選択してリネーム
- **直接入力式リネーム**: ブランチ名を直接入力してリネーム
- **ローカルブランチ同時リネーム**: 対応するローカルブランチも自動でリネーム
- **保護ブランチ機能**: main/master/develop/releaseは誤ってリネームできないよう保護
- **影響警告表示**: 他の開発者への影響と必要な対応を表示
- **確認プロンプト**: リネーム実行前に確認を求める
- **ブランチ名バリデーション**: 不正なブランチ名を検出

## 必要な環境

- Windows 10/11
- PowerShell 5.1以降（Windows標準）
- Git for Windows

## セットアップ

1. `Git_リモートブランチリネームツール.bat` をテキストエディタで開く
2. 以下の設定を環境に合わせて編集：

```powershell
# Gitプロジェクトのパス
$GIT_PROJECT_PATH = "C:\Users\$env:USERNAME\source\Git\project"

# 保護ブランチリスト（リネーム不可）
$ProtectedBranches = @("main", "master", "develop", "release")
```

## 使い方

### 基本的な使い方

1. `Git_リモートブランチリネームツール.bat` をダブルクリック
2. メインメニューから操作を選択：
   - `1`: 一覧からブランチを選択してリネーム
   - `2`: ブランチ名を直接入力してリネーム
   - `3`: 保護ブランチ一覧を表示
   - `0`: 終了

### 一覧から選択してリネーム

```
========================================================================
  リモートブランチリネーム
========================================================================

リモート名: origin
現在のブランチ: main

リネーム可能なブランチ:

 1. feature/old-name
 2. bugfix/issue-123

 0. キャンセル

リネームするブランチ番号を入力 (0-2): 1

新しいブランチ名を入力してください
(空白でキャンセル)

新しいブランチ名: feature/new-name
```

### 影響警告の例

```
========================================================================
  [警告] 他の開発者への影響
========================================================================

このブランチをリネームすると、以下の影響があります:

  1. このブランチを追跡している他の開発者は、
     追跡ブランチの再設定が必要になります。

  2. 他の開発者は以下のコマンドを実行する必要があります:

     git fetch --prune
     git branch -m feature/old-name feature/new-name
     git branch -u origin/feature/new-name feature/new-name

  3. プルリクエストやCI/CDパイプラインでこのブランチを
     参照している場合は、設定の更新が必要です。
```

## 実行される操作

リネーム時に以下の操作が順番に実行されます：

| # | 操作 | 説明 |
|---|------|------|
| 1 | ローカルブランチリネーム | `git branch -m old-name new-name` |
| 2 | リモートへプッシュ | `git push -u origin new-name` |
| 3 | 旧リモートブランチ削除 | `git push origin --delete old-name` |
| 4 | 追跡ブランチ設定 | `git branch -u origin/new-name new-name` |

※ローカルブランチが存在しない場合は、手順1と4はスキップされます。

## 保護ブランチ

以下のブランチはデフォルトで保護されており、リネームできません：

- `main`
- `master`
- `develop`
- `release`

保護ブランチを変更する場合は、スクリプト内の `$ProtectedBranches` 変数を編集してください。

## 注意事項

- **他の開発者への通知**: リネーム後は、チームメンバーに通知してください
- **プルリクエスト**: オープン中のPRがある場合は、先にマージまたはクローズしてください
- **CI/CD**: ブランチ名を参照しているパイプラインの設定更新が必要です
- **ネットワーク接続**: リモート操作のため、ネットワーク接続が必要です

## トラブルシューティング

### リモートへのプッシュに失敗する

```
[NG] リモートへのプッシュに失敗しました
```

**原因と対処**:
- ネットワーク接続を確認
- リモートリポジトリへの書き込み権限を確認
- `git fetch --prune` で最新情報を取得してから再試行

### ブランチが見つからない

```
[エラー] リモートブランチ 'xxx' が見つかりません
```

**原因と対処**:
- ブランチ名のスペルミスを確認
- `git fetch --prune` で最新のリモート情報を取得
- `git branch -r` でリモートブランチ一覧を確認

### 保護ブランチのエラー

```
[エラー] xxx は保護されています。リネームできません。
```

**原因と対処**:
- main/master/develop/release は保護されています
- 保護を解除する場合は、スクリプト内の `$ProtectedBranches` を編集

## 他の開発者向け手順

ブランチがリネームされた場合、他の開発者は以下のコマンドを実行してください：

```bash
# リモート情報を更新（削除されたブランチの参照を削除）
git fetch --prune

# ローカルブランチをリネーム（追跡している場合）
git branch -m 旧ブランチ名 新ブランチ名

# 追跡ブランチを再設定
git branch -u origin/新ブランチ名 新ブランチ名
```

## ライセンス

MIT License
