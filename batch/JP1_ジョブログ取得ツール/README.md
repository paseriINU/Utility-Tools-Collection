# JP1 ジョブログ取得ツール

JP1/AJS3の指定されたジョブの標準出力（スプール）を取得し、テキストファイルに出力するツールです。

## 概要

- JP1/AJS3の`ajsshow`コマンドを使用してジョブのスプールを取得
- 取得したログをテキストファイルに出力
- 標準出力（stdout）、標準エラー出力（stderr）、または両方を取得可能
- ローカルのJP1サーバーで直接実行
- 純粋なバッチファイル（Shift-JIS）で文字コードの問題が少ない

## 必要な環境

- Windows 10/11 または Windows Server 2016以降
- JP1/AJS3がインストールされている環境
- `ajsshow.exe`および`jpqjobget.exe`コマンドへのアクセス権限

## インストール/セットアップ

1. `JP1_ジョブログ取得ツール.bat`をダウンロード
2. バッチファイル内の「設定セクション」を編集

### 設定項目

```batch
rem スケジューラーサービス名（デフォルト: AJSROOT1）
set SCHEDULER_SERVICE=AJSROOT1

rem 取得対象のジョブのフルパス（ジョブネット内のジョブを指定）
rem 例: /main_unit/jobgroup1/daily_batch/job1
set JOB_PATH=/main_unit/jobgroup1/daily_batch/job1

rem ログ出力先フォルダ（バッチファイルと同じ場所に出力する場合は %~dp0 のまま）
set OUTPUT_DIR=%~dp0
```

## 使い方

1. バッチファイル内の設定を編集
   - `JOB_PATH`: 取得したいジョブのフルパスを指定
   - `SPOOL_TYPE`: 取得するログの種類を指定
2. `JP1_ジョブログ取得ツール.bat`をダブルクリックで実行
3. ログが取得され、テキストファイルに出力されます

## 実行例

```
================================================================
  JP1 ジョブログ取得ツール
================================================================

コマンドパス:
  ajsshow  : C:\Program Files\HITACHI\JP1AJS3\bin\ajsshow.exe
  jpqjobget: C:\Program Files\HITACHI\JP1AJS3\bin\jpqjobget.exe

設定内容:
  スケジューラーサービス: AJSROOT1
  ジョブパス            : /main_unit/jobgroup1/daily_batch/job1
  スプール種類          : stdout

========================================
ジョブ情報を取得中...
========================================

実行コマンド: ajsshow -F AJSROOT1 -g 1 -R "/main_unit/jobgroup1/daily_batch/job1"
ajsshow結果:
...

[OK] 実行ID: 12345

========================================
スプールを取得中...
========================================

  取得中: stdout ...
  [OK] stdout を取得しました

========================================
取得したスプール内容:
========================================

Processing started at 2025-12-21 10:30:00
Step 1: Data extraction completed
Step 2: Data transformation completed
Step 3: Data loading completed
Processing finished at 2025-12-21 10:35:00

========================================
[OK] スプール内容をファイルに出力しました
  出力先: C:\path\to\joblog.txt
========================================
```

## 設定オプション

### SPOOL_TYPE（スプール種類）

| 値 | 説明 |
|---|---|
| `stdout` | 標準出力のみ取得（デフォルト） |
| `stderr` | 標準エラー出力のみ取得 |
| `both` | 標準出力と標準エラー出力の両方を取得 |

### コマンドパスの自動検索

以下のパスから自動的にJP1コマンドを検索します：

```
C:\Program Files (x86)\Hitachi\JP1AJS2\bin\
C:\Program Files\Hitachi\JP1AJS2\bin\
C:\Program Files (x86)\HITACHI\JP1AJS3\bin\
C:\Program Files\HITACHI\JP1AJS3\bin\
```

## 注意事項

- ジョブが実行済みでスプールが保存されている必要があります
- スプールの保存期間はJP1/AJS3の設定に依存します
- JP1ユーザーにジョブのスプール参照権限が必要です
- 最新の実行結果のスプールが取得されます
- このファイルはShift-JIS（CP932）で保存されています

## トラブルシューティング

### 「ajsshowコマンドが見つかりません」

- JP1/AJS3がインストールされているか確認してください
- コマンドパスが上記の自動検索パスに含まれているか確認してください

### 「ジョブ情報の取得に失敗しました」

- ジョブパスが正しいか確認してください
- ジョブが実行済みか確認してください（少なくとも1回実行されている必要があります）
- JP1ユーザーの権限を確認してください
- スケジューラサービス名が正しいか確認してください

### 「実行ID（ジョブ番号）を取得できませんでした」

- ジョブが一度も実行されていない可能性があります
- ajsshowの出力形式がサポートされている形式か確認してください

### 「スプールを取得できませんでした」

- ジョブパスが正しいか確認してください
- スプールが保存されているか確認してください
- JP1ユーザーの権限を確認してください

### 「選択オプションに合うユニットが存在しません」

- **ジョブネットではなくジョブを指定しているか確認してください**
  - スプールはジョブ単位で保存されます
  - ジョブネットのパスではなく、ジョブネット内の個別ジョブのフルパスを指定してください
  - 例: `/グループ/ジョブネット/ジョブ名`
- ジョブパスのスペルミスがないか確認してください

### 「認証に失敗しました」

- JP1ユーザー名とパスワードを確認してください
- JP1ユーザーがスプール参照権限を持っているか確認してください

## ファイル構成

```
JP1_ジョブログ取得ツール/
├── JP1_ジョブログ取得ツール.bat  # メインツール
└── README.md                     # このファイル
```

## 関連ツール

- [JP1_リモートジョブ起動ツール](../JP1_リモートジョブ起動ツール/): リモートサーバーでJP1ジョブネットを起動

## 参考資料

- [JP1/AJS3 コマンドリファレンス](../JP1_リモートジョブ起動ツール/JP1_AJS3_COMMANDS.md)

---

**作成日**: 2025-12-21
**更新日**: 2025-12-22
