# JP1 ジョブログ取得ツール

JP1/AJS3の指定されたジョブの標準出力（スプール）を取得し、クリップボードにコピーするツールです。

## 概要

- JP1/AJS3の`ajsshow`および`jpqjobget`コマンドを使用してジョブのスプールを取得
- 取得したログをクリップボードに自動コピー
- 標準出力（stdout）、標準エラー出力（stderr）、または両方を取得可能
- ローカルのJP1サーバーで直接実行

## バージョン

| ファイル名 | 説明 |
|-----------|------|
| `JP1_ジョブログ取得ツール.bat` | PowerShellハイブリッド版（UTF-8対応） |
| `JP1_ジョブログ取得ツール_batch.bat` | 純粋バッチ版（Shift-JIS専用、文字コード問題が少ない） |

**推奨**: 文字コードの問題が発生する場合は`_batch.bat`版をお使いください。

## 必要な環境

- Windows 10/11 または Windows Server 2016以降
- JP1/AJS3がインストールされている環境
- `ajsshow.exe`および`jpqjobget.exe`コマンドへのアクセス権限

### PowerShellハイブリッド版の追加要件
- PowerShell 5.1以降

## インストール/セットアップ

1. `JP1_ジョブログ取得ツール.bat`をダウンロード
2. バッチファイル内の「設定セクション」を編集

### 設定項目

```powershell
$Config = @{
    # スケジューラーサービス名（デフォルト: AJSROOT1）
    SchedulerService = "AJSROOT1"

    # 取得対象のジョブのフルパス
    JobPath = "/main_unit/jobgroup1/daily_batch/job1"

    # JP1ユーザー名（空の場合は現在のログインユーザーで実行）
    JP1User = ""

    # JP1パスワード（空の場合は実行時に入力）
    JP1Password = ""

    # ajsshowコマンドのパス
    AjsshowPath = "C:\Program Files\HITACHI\JP1AJS3\bin\ajsshow.exe"

    # 取得するスプールの種類（stdout/stderr/both）
    SpoolType = "stdout"

    # クリップボードにコピーするか
    CopyToClipboard = $true

    # コンソールにも出力するか
    ShowInConsole = $true
}
```

## 使い方

1. バッチファイル内の設定を編集
   - `JobPath`: 取得したいジョブのフルパスを指定
   - `SpoolType`: 取得するログの種類を指定
2. `JP1_ジョブログ取得ツール.bat`をダブルクリックで実行
3. ログが取得され、クリップボードにコピーされます

## 実行例

```
================================================================
  JP1 ジョブログ取得ツール
================================================================

設定内容:
  スケジューラーサービス: AJSROOT1
  ジョブパス            : /main_unit/jobgroup1/daily_batch/job1
  スプール種類          : stdout

========================================
ジョブのスプールを取得中...
========================================

  取得中: stdout ...
  [OK] stdout を取得しました

========================================
取得したスプール内容:
========================================

Processing started at 2025-12-21 10:30:00
Step 1: Data extraction completed
Step 2: Data transformation completed
Step 3: Data loading completed
Processing finished at 2025-12-21 10:35:00

========================================
[OK] スプール内容をクリップボードにコピーしました
========================================
```

## 設定オプション

### SpoolType（スプール種類）

| 値 | 説明 |
|---|---|
| `stdout` | 標準出力のみ取得（デフォルト） |
| `stderr` | 標準エラー出力のみ取得 |
| `both` | 標準出力と標準エラー出力の両方を取得 |

### ajsshowコマンドのパス

JP1/AJS2・AJS3のバージョンやインストール場所により異なる場合があります：

```
C:\Program Files (x86)\HITACHI\JP1AJS2\bin\ajsshow.exe  ← デフォルト
C:\Program Files\HITACHI\JP1AJS2\bin\ajsshow.exe
C:\Program Files\HITACHI\JP1AJS3\bin\ajsshow.exe
C:\Program Files (x86)\HITACHI\JP1AJS3\bin\ajsshow.exe
```

## 注意事項

- ジョブが実行済みでスプールが保存されている必要があります
- スプールの保存期間はJP1/AJS3の設定に依存します
- JP1ユーザーにジョブのスプール参照権限が必要です
- 最新の実行結果のスプールが取得されます

## トラブルシューティング

### 「ajsshowコマンドが見つかりません」

- `AjsshowPath`の設定を確認してください
- JP1/AJS3がインストールされているか確認してください

### 「スプールを取得できませんでした」

- ジョブパスが正しいか確認してください
- ジョブが実行済みか確認してください
- スプールが保存されているか確認してください
- JP1ユーザーの権限を確認してください

### 「選択オプションに合うユニットが存在しません」

- **ジョブネットではなくジョブを指定しているか確認してください**
  - スプールはジョブ単位で保存されます
  - ジョブネットのパスではなく、ジョブネット内の個別ジョブのフルパスを指定してください
  - 例: `/グループ/ジョブネット/ジョブ名`
- ジョブが一度も実行されていない可能性があります
- ジョブパスのスペルミスがないか確認してください

### 「認証に失敗しました」

- JP1ユーザー名とパスワードを確認してください
- JP1ユーザーがスプール参照権限を持っているか確認してください

## ファイル構成

```
JP1_ジョブログ取得ツール/
├── JP1_ジョブログ取得ツール.bat        # PowerShellハイブリッド版
├── JP1_ジョブログ取得ツール_batch.bat  # 純粋バッチ版（Shift-JIS）
└── README.md                           # このファイル
```

## 関連ツール

- [JP1_リモートジョブ起動ツール](../JP1_リモートジョブ起動ツール/): リモートサーバーでJP1ジョブネットを起動

## 参考資料

- [JP1/AJS3 コマンドリファレンス](../JP1_リモートジョブ起動ツール/JP1_AJS3_COMMANDS.md)

---

**作成日**: 2025-12-21
