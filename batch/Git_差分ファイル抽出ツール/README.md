# Git差分ファイル抽出ツール

## 概要

Gitの2つのブランチ間で差分があるファイルを抽出し、**フォルダ構造を保ったまま**別フォルダにコピーするツールです。
修正前・修正後の両方のファイルを取得でき、WinMergeでの比較機能も搭載しています。

### 特徴

- ✅ **対話式ブランチ選択** - ブランチを番号で選択
- ✅ **修正前・修正後を両方取得** - 比較しやすい構成で出力
- ✅ **フォルダ構造を保持** - 元のディレクトリ構造のまま抽出
- ✅ **WinMerge連携** - 抽出後にWinMergeで比較可能
- ✅ **Windows標準機能のみ** - 追加ツール不要

---

## 必要な環境

- Windows 10 / Windows 11
- Git for Windows がインストールされていること
- WinMerge（オプション：比較機能を使用する場合）

---

## 使い方

### 1. 設定を編集

`Git_差分ファイル抽出ツール.bat` をテキストエディタで開き、設定セクションを編集：

```powershell
#region 設定セクション
# Gitプロジェクトのパス
$GIT_PROJECT_PATH = "C:\Users\$env:USERNAME\source\Git\project"

# 削除されたファイルも含めるか（$true=含める, $false=含めない）
$INCLUDE_DELETED = $false

# WinMergeのパス（空文字列の場合は自動検出）
$WINMERGE_PATH = ""
#endregion
```

### 2. 実行

`Git_差分ファイル抽出ツール.bat` をダブルクリックで実行

### 3. ブランチを選択

対話形式でブランチを選択します：

```
========================================================================
  比較元ブランチ（修正前 / 古いバージョン）を選択してください
========================================================================

 1. main
 2. develop
 3. feature/new-login

 0. キャンセル

番号を選択してください (0-3): 1

========================================================================
  比較先ブランチ（修正後 / 新しいバージョン）を選択してください
========================================================================

 1. main [比較元]
 2. develop
 3. feature/new-login

 0. キャンセル

番号を選択してください (0-3): 2
```

### 4. 完了

デスクトップに以下の構成でフォルダが作成されます：

```
git_diff_20251210_153045/
├── 01_修正前/          ← 比較元ブランチのファイル
│   ├── src/
│   │   └── main.js
│   └── docs/
│       └── README.md
└── 02_修正後/          ← 比較先ブランチのファイル
    ├── src/
    │   └── main.js
    └── docs/
        └── README.md
```

---

## 実行時の出力例

```
========================================================================
  Git 差分ファイル抽出ツール
========================================================================

[注意] ブランチ選択について
  比較元 = 修正前のブランチ（古いバージョン）
  比較先 = 修正後のブランチ（新しいバージョン）

  出力フォルダ：
    01_修正前 = 比較元ブランチのファイル
    02_修正後 = 比較先ブランチのファイル

Gitプロジェクトパス: C:\Users\user\source\Git\project
リポジトリルート: C:\Users\user\source\Git\project

ブランチ一覧を取得中...

========================================================================
  比較元ブランチ（修正前 / 古いバージョン）を選択してください
========================================================================

 1. main
 2. develop

 0. キャンセル

番号を選択してください (0-2): 1

[選択] 比較元ブランチ: main

...

比較元ブランチ  : main
比較先ブランチ  : develop
出力先フォルダ  : C:\Users\user\Desktop\git_diff_20251210_153045
  01_修正前     : 比較元(main)のファイル
  02_修正後     : 比較先(develop)のファイル

差分ファイルを検出中...

検出された差分ファイル数: 5 個

ファイルをコピー中...

[処理] src/main.js
  [01_修正前] コピー完了
  [02_修正後] コピー完了
[処理] docs/README.md
  [01_修正前] コピー完了
  [02_修正後] コピー完了
...

========================================================================
 処理完了
========================================================================

01_修正前 コピー数: 5 個
02_修正後 コピー数: 5 個

出力先: C:\Users\user\Desktop\git_diff_20251210_153045
  01_修正前: 比較元(main)のファイル
  02_修正後: 比較先(develop)のファイル

WinMergeで比較しますか? (y/n)
```

---

## 設定項目

| 設定項目 | 説明 | デフォルト値 |
|----------|------|-------------|
| `$GIT_PROJECT_PATH` | Gitプロジェクトのパス | `C:\Users\$env:USERNAME\source\Git\project` |
| `$INCLUDE_DELETED` | 削除されたファイルも含めるか | `$false` |
| `$WINMERGE_PATH` | WinMergeのパス（空で自動検出） | `""` |

---

## WinMerge連携

WinMergeがインストールされている場合、抽出完了後に「WinMergeで比較しますか?」と確認されます。

`y` を入力すると、`01_修正前` と `02_修正後` フォルダをWinMergeで比較できます。

### WinMergeのインストール先

以下のパスを自動検出します：

- `C:\Program Files\WinMerge\WinMergeU.exe`
- `C:\Program Files (x86)\WinMerge\WinMergeU.exe`
- `%LOCALAPPDATA%\Programs\WinMerge\WinMergeU.exe`

別の場所にインストールしている場合は `$WINMERGE_PATH` に直接指定してください。

---

## トラブルシューティング

### エラー: "Gitがインストールされていません"

**解決方法**:
1. https://git-scm.com/download/win からGit for Windowsをインストール
2. インストール完了後、**新しいコマンドプロンプトを開いて**再実行

### エラー: "このフォルダはGit管理下にありません"

**原因**: `$GIT_PROJECT_PATH` がGitリポジトリではない

**対処法**: `$GIT_PROJECT_PATH` に正しいGitリポジトリのパスを設定

### 差分ファイルが見つからない

**原因**: 2つのブランチが同じ内容

**対処法**:
- ブランチを間違えていないか確認
- `git log --oneline main..develop` で差分コミットを確認

### 日本語ファイル名が文字化けする

**対処法**:
```cmd
git config --global core.quotepath false
```

---

## 注意事項

1. **作業ディレクトリの変更は含まれない** - コミット済みの差分のみを抽出します
2. **バイナリファイルも抽出される** - 画像・PDFなども差分があればコピーされます
3. **出力先フォルダは上書きされる** - 同名フォルダがある場合は確認後に削除されます
4. **新規ファイルの場合** - 比較元に存在しないファイルは `01_修正前` にはコピーされません

---

## ライセンス

このツールはMITライセンスの下で公開されています。
