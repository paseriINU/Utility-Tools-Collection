# Git差分ファイル抽出ツール

## 概要

Gitの差分ファイルを抽出し、**フォルダ構造を保ったまま**別フォルダにコピーするツールです。
修正前・修正後の両方のファイルを取得でき、WinMergeでの比較機能も搭載しています。

### 比較モード

| モード | 説明 | 用途 |
|--------|------|------|
| **ブランチ間比較** | 異なるブランチ同士を比較 | feature → main のマージ前確認など |
| **コミット間比較** | 同ブランチ内の特定コミット間を比較 | ある時点からの変更確認など |

### 特徴

- ✅ **2つの比較モード** - ブランチ間/コミット間を選択可能
- ✅ **対話式選択** - ブランチ・コミットを番号で選択
- ✅ **修正前・修正後を両方取得** - 比較しやすい構成で出力
- ✅ **フォルダ構造を保持** - 元のディレクトリ構造のまま抽出
- ✅ **ネットワークフォルダ出力** - ブランチ名と一致するフォルダに自動出力
- ✅ **WinMerge連携** - 抽出後にWinMergeで比較可能（フォルダ展開表示）
- ✅ **Windows標準機能のみ** - 追加ツール不要

---

## 必要な環境

- Windows 10 / Windows 11
- Git for Windows がインストールされていること
- WinMerge（オプション：比較機能を使用する場合）

---

## 使い方

### 1. 設定を編集

`Git_差分ファイル抽出ツール.bat` をテキストエディタで開き、設定セクションを編集：

```powershell
#region 設定セクション
# Gitプロジェクトのパス
$GIT_PROJECT_PATH = "C:\Users\$env:USERNAME\source\Git\project"

# 削除されたファイルも含めるか（$true=含める, $false=含めない）
$INCLUDE_DELETED = $false

# WinMergeのパス（空文字列の場合は自動検出）
$WINMERGE_PATH = ""

# コミット履歴の表示件数
$COMMIT_HISTORY_COUNT = 20

# ネットワーク出力先のベースパス（空文字列の場合はデスクトップに出力）
# 例: "\\server\share\projects" または "Z:\projects"
$NETWORK_OUTPUT_BASE = ""
#endregion
```

### 2. 実行

`Git_差分ファイル抽出ツール.bat` をダブルクリックで実行

### 3. 比較モードを選択

```
========================================================================
  比較モードを選択してください
========================================================================

 1. ブランチ間の比較（異なるブランチ同士を比較）
 2. コミット間の比較（同ブランチ内の特定コミット間を比較）

 0. 終了

選択 (0-2):
```

---

## ブランチ間比較モード

異なるブランチ同士の差分を抽出します。

### 操作フロー

1. 比較元ブランチ（修正前/古いバージョン）を選択
2. 比較先ブランチ（修正後/新しいバージョン）を選択
3. 差分ファイルが抽出される

### 実行例

```
========================================================================
  ブランチ間比較モード
========================================================================

[注意] ブランチ選択について
  比較元 = 修正前のブランチ（古いバージョン）
  比較先 = 修正後のブランチ（新しいバージョン）

========================================================================
  比較元ブランチ（修正前 / 古いバージョン）を選択してください
========================================================================

 1. main
 2. develop
 3. feature/new-login

 0. キャンセル

番号を選択してください (0-3): 1

[選択] 比較元ブランチ: main

========================================================================
  比較先ブランチ（修正後 / 新しいバージョン）を選択してください
========================================================================

 1. main [比較元]
 2. develop
 3. feature/new-login

 0. キャンセル

番号を選択してください (0-3): 2

[選択] 比較先ブランチ: develop
```

---

## コミット間比較モード

同じブランチ内で、特定のコミット間の差分を抽出します。

### 操作フロー

1. 現在のブランチを確認（必要に応じて切り替え）
2. 比較元コミット（古い時点）を選択
   - コミット履歴から選択
   - **ブランチ分岐点**も選択可能（コミット一覧の下に表示）
3. 比較先コミット（新しい時点/HEAD）を選択
4. 差分ファイルが抽出される

### ブランチ分岐点の検出

分岐点はすべてのローカルブランチから自動検出されます：
- 現在のブランチに最も近い分岐点を持つブランチを特定
- main/master以外からの分岐（feature/A → feature/B など）も検出可能

### 実行例

```
========================================================================
  コミット間比較モード
========================================================================

[注意] コミット選択について
  比較元 = 修正前のコミット（古い時点）
  比較先 = 修正後のコミット（新しい時点）

------------------------------------------------------------------------
 現在のブランチ: develop
------------------------------------------------------------------------

ブランチ操作を選択してください:
 1. このまま続行（develop）
 2. ブランチを切り替える

 0. キャンセル

選択 (0-2): 1

========================================================================
  ブランチ 'develop' のコミット履歴
========================================================================

比較元コミット（修正前 / 古い時点）を選択してください:

 1. [abc1234] 2025-12-16 機能Aを追加
 2. [def5678] 2025-12-15 バグ修正
 3. [ghi9012] 2025-12-14 リファクタリング
 4. [jkl3456] 2025-12-13 初期実装

 5. [xyz7890] 2025-12-10 mainの状態 [mainからの分岐点]

 0. キャンセル

番号を選択してください (0-5): 5

[選択] 比較元: mainからの分岐点 [xyz7890]

========================================================================
  比較先コミット（修正後 / 新しい時点）を選択してください
========================================================================

 ※ HEADを選択すると、現在の最新状態と比較します

 1. HEAD（現在の最新状態）
 2. [abc1234] 2025-12-16 機能Aを追加
 3. [def5678] 2025-12-15 バグ修正
 4. [ghi9012] 2025-12-14 リファクタリング [比較元]
 5. [jkl3456] 2025-12-13 初期実装

 0. キャンセル

番号を選択してください (0-5): 1

[選択] 比較先: HEAD（現在の最新状態）
```

---

## 出力フォルダ構成

### デスクトップ出力（デフォルト）

`$NETWORK_OUTPUT_BASE` が未設定の場合、デスクトップに以下の構成でフォルダが作成されます：

```
git_diff_20251210_153045/
├── 01_修正前/          ← 比較元のファイル
│   ├── src/
│   │   └── main.js
│   └── docs/
│       └── README.md
└── 02_修正後/          ← 比較先のファイル
    ├── src/
    │   └── main.js
    └── docs/
        └── README.md
```

### ネットワークフォルダ出力

`$NETWORK_OUTPUT_BASE` を設定すると、ブランチ名と一致するフォルダの `30_M` 配下に出力されます：

```
\\server\share\projects\           ← $NETWORK_OUTPUT_BASE
├── feature-A/                     ← ブランチ名と一致するフォルダ
│   └── 30_M/
│       ├── 01_修正前/             ← ここに出力
│       └── 02_修正後/
├── feature-B/
│   └── 30_M/
└── develop/
    └── 30_M/
```

**動作フロー**:
1. 比較先ブランチ名（修正後）とネットワークフォルダ配下のフォルダ名を照合
2. **完全一致**するフォルダがある場合 → そのフォルダの `30_M` 配下に自動出力
3. 一致しない場合 → **フォルダ選択ダイアログ**が表示され、手動で選択
4. `30_M` フォルダが存在しない場合は自動作成

---

## 設定項目

| 設定項目 | 説明 | デフォルト値 |
|----------|------|-------------|
| `$GIT_PROJECT_PATH` | Gitプロジェクトのパス | `C:\Users\$env:USERNAME\source\Git\project` |
| `$INCLUDE_DELETED` | 削除されたファイルも含めるか | `$false` |
| `$WINMERGE_PATH` | WinMergeのパス（空で自動検出） | `""` |
| `$COMMIT_HISTORY_COUNT` | コミット履歴の表示件数 | `20` |
| `$NETWORK_OUTPUT_BASE` | ネットワーク出力先のベースパス | `""`（デスクトップに出力） |

---

## WinMerge連携

WinMergeがインストールされている場合、抽出完了後に「WinMergeで比較しますか?」と確認されます。

`y` を入力すると、`01_修正前` と `02_修正後` フォルダをWinMergeで比較できます。

### 特徴

- **フォルダが展開された状態で表示**: すべてのサブフォルダが展開された状態でWinMergeが開きます
- **コンソール自動終了**: WinMerge起動後、コマンドプロンプト画面は自動的に閉じます
- **ESCキーで終了**: WinMergeはESCキーで簡単に閉じることができます

### WinMergeのインストール先

以下のパスを自動検出します：

- `C:\Program Files\WinMerge\WinMergeU.exe`
- `C:\Program Files (x86)\WinMerge\WinMergeU.exe`
- `%LOCALAPPDATA%\Programs\WinMerge\WinMergeU.exe`

別の場所にインストールしている場合は `$WINMERGE_PATH` に直接指定してください。

---

## トラブルシューティング

### エラー: "Gitがインストールされていません"

**解決方法**:
1. https://git-scm.com/download/win からGit for Windowsをインストール
2. インストール完了後、**新しいコマンドプロンプトを開いて**再実行

### エラー: "このフォルダはGit管理下にありません"

**原因**: `$GIT_PROJECT_PATH` がGitリポジトリではない

**対処法**: `$GIT_PROJECT_PATH` に正しいGitリポジトリのパスを設定

### 差分ファイルが見つからない

**原因**: 比較対象が同じ内容

**対処法**:
- ブランチ/コミットを間違えていないか確認
- `git log --oneline` で差分コミットを確認

### 日本語ファイル名が文字化けする

**対処法**:
```cmd
git config --global core.quotepath false
```

---

## 注意事項

1. **作業ディレクトリの変更は含まれない** - コミット済みの差分のみを抽出します
2. **バイナリファイルも抽出される** - 画像・PDFなども差分があればコピーされます
3. **出力先フォルダは上書きされる** - 同名フォルダがある場合は確認後に削除されます
4. **新規ファイルの場合** - 比較元に存在しないファイルは `01_修正前` にはコピーされません

---

## ライセンス

このツールはMITライセンスの下で公開されています。
