# VB.NET ソース改修デプロイツール

改修済みのVB.NETソースをメインフォルダにデプロイし、コンパイル後にDLLを取得するツールです。

## 概要

このツールは以下の処理を自動化します：

1. 改修済みソースフォルダの構成を取得
2. メインフォルダから対象ファイルをバックアップ（`YYYYMMDD_bk`フォルダ）
3. 改修済みファイルをメインフォルダに上書きコピー
4. MSBuildでReleaseビルド
5. 生成されたDLL（ソリューション名と同名）をデスクトップにコピー

## 必要な環境

- Windows 10/11
- PowerShell 5.1以降
- Visual Studio または Build Tools（MSBuild）
  - Visual Studio 2017/2019/2022
  - または Visual Studio Build Tools

## インストール/セットアップ

1. `VBNet_ソース改修デプロイツール.bat` をテキストエディタで開く
2. 設定セクションを環境に合わせて編集：

```powershell
#region 設定セクション
# メインフォルダ（本番ソースのパス）
$MAIN_FOLDER = "C:\Projects\MainSource"

# 改修済みソースフォルダ（メインと同じ構成）
$MODIFIED_FOLDER = "C:\Projects\ModifiedSource"

# バックアップフォルダの保存先（空の場合はメインフォルダの親に作成）
$BACKUP_BASE = ""

# MSBuildのパス（空の場合は自動検出）
$MSBUILD_PATH = ""

# ビルド構成（Release / Debug）
$BUILD_CONFIG = "Release"
#endregion
```

3. バッチファイルをダブルクリックで実行

## 使い方

### 基本的な使い方

1. メインフォルダ（本番ソース）のパスを設定
2. 改修済みソースフォルダのパスを設定
3. バッチファイルをダブルクリック
4. 確認画面で処理内容を確認し、`y`で続行

### フォルダ構成の例

```
C:\Projects\
├── MainSource\              ← メインフォルダ（本番ソース）
│   ├── MyProject.sln
│   ├── MyProject\
│   │   ├── Form1.vb
│   │   ├── Module1.vb
│   │   └── ...
│   └── bin\Release\
│       └── MyProject.dll
│
├── ModifiedSource\          ← 改修済みソースフォルダ
│   ├── MyProject.sln        ← ソリューションファイル必須
│   └── MyProject\
│       ├── Form1.vb         ← 改修したファイル
│       └── NewModule.vb     ← 新規追加ファイル
│
└── 20241229_bk\             ← 自動生成されるバックアップフォルダ
    └── MyProject\
        └── Form1.vb         ← バックアップされたファイル
```

## 実行例

```
========================================================================
  VB.NET ソース改修デプロイツール
========================================================================

[検証] フォルダを確認中...

  メインフォルダ    : C:\Projects\MainSource
  改修済みフォルダ  : C:\Projects\ModifiedSource

[検索] 改修済みフォルダのファイルを取得中...

  検出されたファイル数: 5 個

[検索] ソリューションファイルを検索中...

  検出されたソリューション: MyProject.sln

[検索] MSBuildを検索中...
  MSBuild: C:\Program Files\Microsoft Visual Studio\2022\Professional\MSBuild\Current\Bin\MSBuild.exe

========================================================================
  処理内容の確認
========================================================================

以下の処理を実行します:

  1. メインフォルダから対象ファイルをバックアップ（YYYYMMDD_bk）
  2. 改修済みファイルをメインフォルダに上書きコピー
  3. ソリューションをReleaseビルド
  4. 生成されたDLLをデスクトップにコピー

------------------------------------------------------------------------
  対象ファイル数    : 5 個
  ソリューション    : MyProject.sln
  取得するDLL       : MyProject.dll
------------------------------------------------------------------------

続行しますか? (y/n): y

========================================================================
  Step 1: バックアップ
========================================================================

  バックアップ先: C:\Projects\20241229_bk

  [OK] MyProject\Form1.vb
  [OK] MyProject\Module1.vb
  [新規] MyProject\NewModule.vb

  バックアップ完了: 2 個
  新規ファイル（スキップ）: 1 個

========================================================================
  Step 2: 改修ファイルのコピー
========================================================================

  [OK] MyProject\Form1.vb
  [OK] MyProject\Module1.vb
  [OK] MyProject\NewModule.vb

  コピー完了: 3 個

========================================================================
  Step 3: ソリューションのビルド
========================================================================

  ソリューション: C:\Projects\MainSource\MyProject.sln
  構成: Release

  ビルド中...

  ビルド成功!

========================================================================
  Step 4: DLLの取得
========================================================================

  検出されたDLL: C:\Projects\MainSource\bin\Release\MyProject.dll

  DLLをデスクトップにコピーしました: C:\Users\username\Desktop\MyProject.dll

========================================================================
  処理完了
========================================================================

  [完了] すべての処理が正常に完了しました

------------------------------------------------------------------------
  バックアップ先  : C:\Projects\20241229_bk
  コピー済みファイル: 3 個
  DLL出力先       : C:\Users\username\Desktop\MyProject.dll
------------------------------------------------------------------------
```

## 注意事項

1. **バックアップ**
   - バックアップは`YYYYMMDD_bk`形式のフォルダに保存されます
   - 同日に複数回実行すると、同じバックアップフォルダに上書きされます
   - 新規追加ファイル（メインに存在しないファイル）はバックアップ対象外です

2. **ソリューションファイル**
   - 改修済みソースフォルダ内に`.sln`ファイルが必須です
   - 複数の`.sln`がある場合は選択画面が表示されます
   - 取得するDLLはソリューション名と同名のものです

3. **MSBuild**
   - Visual Studio 2017/2019/2022 が自動検出されます
   - 見つからない場合は`MSBUILD_PATH`を直接指定してください

4. **DLL出力**
   - DLLはデスクトップに保存されます
   - 同名のDLLが存在する場合、上書きまたはタイムスタンプ付きで保存できます

## トラブルシューティング

### MSBuildが見つからない

```
[エラー] MSBuildが見つかりません
```

**対処法:**
1. Visual StudioまたはBuild Toolsをインストール
2. または、設定セクションの`MSBUILD_PATH`を直接指定

```powershell
$MSBUILD_PATH = "C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe"
```

### ビルドエラー

```
[エラー] ビルドに失敗しました
```

**対処法:**
1. Visual Studioでソリューションを開いてビルドし、詳細なエラーを確認
2. 参照エラーや依存関係の問題がないか確認

### DLLが見つからない

```
[エラー] DLLが見つかりません
```

**対処法:**
1. ビルドが本当に成功したか確認
2. `bin\Release`フォルダを手動で確認
3. プロジェクト名とソリューション名が異なる場合は、手動でDLLを取得

## ライセンス

MIT License
