# Git Log 可視化ツール

## 概要

Excelから実行し、Gitリポジトリのコミット履歴を取得して、表形式・ブランチ構造で視覚化するツールです。

git logの出力を見やすく整理し、プロジェクトの開発状況を一目で把握できます。

## 機能

- **メインシート**: 設定入力（リポジトリパス、取得件数）と実行ボタン
- **ダッシュボード**: サマリー情報（コミット数、作者数、変更量）と作者別統計
- **コミット履歴一覧**: 表形式でコミットを時系列に表示
- **ブランチ構造可視化**: 図形を使ってブランチ構造を `git log --graph` 風に表示
- **全ブランチ対応**: すべてのブランチのコミットを取得
- **変更統計**: ファイル変更数・追加/削除行数も表示

## 出力されるシート

### 1. メイン（設定・実行）

リポジトリの設定と実行ボタンを配置したメインシートです。

**設定項目:**
| セル | 項目 | 説明 |
|------|------|------|
| D8 | リポジトリパス | Gitリポジトリのフォルダパス |
| D10 | 取得件数 | 取得するコミット数（最近のN件） |

**実行ボタン:**
- **Git Log 取得**: 設定に基づいてGitログを取得し、シートを作成
- **初期化**: 設定をデフォルト値にリセット

**表示情報:**
- ツールタイトル
- 設定入力欄（直接編集可能）
- 使い方の説明
- 必要な環境

### 2. ダッシュボード（サマリー情報）

プロジェクト全体の統計情報を一目で確認できるダッシュボードです。

**サマリーセクション:**
| 項目 | 内容 |
|------|------|
| 総コミット数 | 取得したコミットの総数 |
| 作者数 | ユニークな作者の人数 |
| 期間 | 最古〜最新コミットの日付範囲 |
| 日数 | 期間の日数 |

**変更量セクション:**
| 項目 | 内容 |
|------|------|
| 変更ファイル数 | 全コミットで変更されたファイル総数 |
| 追加行数 | 追加された行の合計（緑色で表示） |
| 削除行数 | 削除された行の合計（赤色で表示） |
| 純増行数 | 追加行数 - 削除行数 |

**作者別コミット数:**
- コミット数の多い順にランキング表示（最大20人）
- 各作者のコミット数と割合を表示
- 簡易バーグラフで視覚的に比較

### 3. コミット履歴

コミット一覧を表形式で表示します。

| 列 | カラム名 | 内容 |
|----|---------|------|
| A | No | 通し番号 |
| B | ハッシュ | コミットハッシュ（短縮7文字） |
| C | 作者 | コミット作成者 |
| D | 日時 | コミット日時 |
| E | コミットメッセージ | コミットの件名 |
| F | ブランチ/タグ | 該当するブランチ・タグ名 |
| G | 変更ファイル数 | 変更されたファイル数 |
| H | 追加行数 | 追加された行数 |
| I | 削除行数 | 削除された行数 |

**機能:**
- フィルター機能で作者やブランチで絞り込み可能
- ソート機能で日時順に並べ替え可能
- 交互に色分けして見やすく表示

### 4. ブランチグラフ（ブランチ構造）

Excelの図形を使用してブランチ構造を視覚化します（`git log --graph` 風）。

- **コミットノード（円形）**: 各コミットを円で表示
  - **赤色**: 初期コミット（親コミットなし）
  - **緑色**: マージコミット（親コミット2つ以上）
  - **青色**: 通常コミット（親コミット1つ）
- **接続線**: 親コミットへの線を自動描画
- **レーン分離**: ブランチごとに横位置を自動調整（最大10レーン）
- **ツールチップ**: 円にマウスを当てるとコミット情報を表示

> **注意**: コミット数が多い場合、図形描画に時間がかかる場合があります。

## 必要な環境

- **Microsoft Excel**: 2010以降（マクロ有効ブック `.xlsm` 対応）
- **Git**: インストールされており、パスが通っていること
  - コマンドプロンプトで `git --version` が実行できることを確認

## インストール/セットアップ

### 1. 新しいExcelマクロ有効ブックを作成

1. Excelを起動
2. 新しいブックを作成
3. 「名前を付けて保存」から「Excelマクロ有効ブック (*.xlsm)」形式で保存
   - 推奨ファイル名: `GitLogVisualizer.xlsm`

### 2. VBAモジュールをインポート

1. Excel上で `Alt + F11` を押してVBAエディタを開く
2. メニューから「ファイル」→「ファイルのインポート」を選択
3. 以下の2つのモジュールを順番にインポート：
   - `GitLogVisualizer_Setup.bas`（初期化・シートフォーマット用）
   - `GitLogVisualizer.bas`（メイン処理用）
4. 標準モジュール「GitLogVisualizer_Setup」と「GitLogVisualizer」が追加されたことを確認

### 3. 初期化を実行

1. `Alt + F8` を押してマクロ一覧を表示
2. `InitializeGitLogVisualizer` を選択して実行
3. 「メイン」シートが作成され、設定入力欄と実行ボタンが配置されます

## 使い方

### 基本的な実行方法

1. `GitLogVisualizer.xlsm` を開く
2. 「メイン」シートで設定を入力:
   - **D8セル**: リポジトリパスを入力（例: `C:\Users\YourName\MyProject`）
   - **D10セル**: 取得件数を入力（例: `100`）
3. 「Git Log 取得」ボタンをクリック
4. 処理完了まで待機（数秒〜数十秒）
5. 4つのシートが作成されます:
   - **メイン**: 設定・実行
   - **ダッシュボード**: サマリー情報・作者別統計
   - **コミット履歴**: コミット一覧
   - **ブランチグラフ**: ブランチ構造の図形可視化

### コミット履歴シートの活用

コミット履歴シートでは以下のような分析ができます:

1. **フィルター機能**
   - ヘッダー行にフィルターボタンが表示されます
   - 作者でフィルタリング → 特定の人のコミットのみ表示
   - 種別でフィルタリング → マージコミットのみ表示
   - ブランチでフィルタリング → 特定ブランチのコミットのみ表示

2. **ソート機能**
   - 日時でソート → 時系列順に並べ替え
   - 変更量でソート → 大きな変更を特定
   - 追加行数でソート → コードの追加量で並べ替え

3. **コミットメッセージの検索**
   - `Ctrl + F` で検索
   - 特定のキーワードを含むコミットを検索

### ブランチグラフシートの活用

ブランチ構造シートでは視覚的に以下が確認できます:

1. **ブランチの分岐・マージ構造**
   - 各コミットが円で表示され、親コミットへの線で繋がっている
   - 横方向の位置（レーン）でブランチを識別

2. **コミットの種類を色で識別**
   - 赤色: 初期コミット（プロジェクトの始点）
   - 緑色: マージコミット（ブランチの合流点）
   - 青色: 通常コミット

3. **詳細情報の確認**
   - 各円の右側にハッシュとコミットメッセージが表示
   - 円の上にマウスを当てるとツールチップが表示される

## 実行例

### 処理前

「メイン」シートでリポジトリパスと取得件数を設定してボタンをクリックします。

### イミディエイトウィンドウ出力

```
=========================================
Git Log 可視化処理を開始します
リポジトリ: C:\Users\YourName\MyProject
取得件数: 100 件
=========================================
コミット履歴を取得しています...
取得完了: 100 件
シートを準備しています...
ダッシュボードを作成しています...
履歴シートを作成しています...
ブランチグラフを作成しています...
=========================================
処理完了
=========================================
```

### 出力結果

4つのシートが作成され、以下の情報が表示されます:

- **メイン**: 設定入力欄と実行ボタン
- **ダッシュボード**: サマリー情報（コミット数、作者数、変更量）、作者別統計ランキング
- **コミット履歴**: 最近100件のコミット一覧表（詳細情報付き）
- **ブランチグラフ**: ブランチ構造の図形可視化（円と線で表現）

## 注意事項

### 実行時の注意

- **Gitインストール必須**: Gitがインストールされており、コマンドプロンプトで実行可能である必要があります
- **処理時間**: コミット数が多い場合、処理に時間がかかる場合があります（特にブランチグラフの図形描画）
- **既存シート上書き**: 実行するたびにダッシュボード、コミット履歴、ブランチグラフの3シートが再作成されます

### リポジトリパスの指定方法

**メインシートで直接入力**:
- D8セルにリポジトリパスを入力するだけで設定完了
- **環境変数が使用可能**: `%USERNAME%`、`%USERPROFILE%`、`%HOMEDRIVE%` など
- フルパスで指定してください

**正しい例**:
```
C:\Users\%USERNAME%\source\Git\project    ← 環境変数OK
C:\Users\YourName\MyProject               ← フルパスOK
%USERPROFILE%\Documents\MyRepo            ← 環境変数OK
D:\Projects\MyRepo
\\server\share\project
```

**誤った例**:
```
C:\Users\YourName\MyProject\    ← 末尾の \ は不要
C:/Users/YourName/MyProject     ← スラッシュは不可（バックスラッシュを使用）
```

**使用可能な環境変数の例**:
| 環境変数 | 展開例 |
|---------|--------|
| %USERNAME% | YourName |
| %USERPROFILE% | C:\Users\YourName |
| %HOMEDRIVE% | C: |
| %HOMEPATH% | \Users\YourName |
| %APPDATA% | C:\Users\YourName\AppData\Roaming |

### Gitコマンドのパス

通常は `git` で動作しますが、パスが通っていない場合はVBAコード内の `GIT_COMMAND` 定数を編集してください:

```vba
Private Const GIT_COMMAND As String = "C:\Program Files\Git\bin\git.exe"
```

## トラブルシューティング

### 1. 「コミットが取得できませんでした」エラー

**原因**: Gitコマンドが実行できない、またはリポジトリパスが間違っている

**解決方法**:
- コマンドプロンプトで `git --version` が実行できるか確認
- リポジトリパスが正しいか確認
- メインシートのD8セルに正しいパスが入力されているか確認

### 2. 「指定されたパスがGitリポジトリ管理下にありません」エラー

**原因**: 指定したパスがGit管理下にない

**解決方法**:
- パスを確認: 指定したフォルダが存在するか
- コマンドプロンプトで該当フォルダに移動し、`git status` が実行できるか確認
- `.git` フォルダが存在するか確認

### 3. 処理が遅い

**原因**: コミット数が多すぎる

**解決方法**:
- メインシートのD10セルで取得件数を減らす（例: 100 → 50）
- Application.ScreenUpdating = False により画面更新は抑制されていますが、それでも遅い場合は対象を絞る

### 4. 日本語が文字化けする

**原因**: Gitの出力エンコーディングの問題

**解決方法**:
- Gitの設定を確認: `git config --global core.quotepath false`
- Excelのセルの書式を確認

### 5. メインシートが表示されない

**原因**: 初期化マクロが実行されていない

**解決方法**:
- `Alt + F8` でマクロ一覧を開く
- `InitializeGitLogVisualizer` を選択して実行

## カスタマイズ

### デフォルト設定を変更

VBAコード内の定数を編集することで、デフォルト値を変更できます:

```vba
' デフォルトのコミット取得件数
Private Const DEFAULT_COMMIT_COUNT As Long = 100

' デフォルトのリポジトリパス
Private Function GetDefaultRepoPath() As String
    GetDefaultRepoPath = "C:\Users\" & Environ("USERNAME") & "\source\Git\project"
End Function
```

### 特定のブランチのみ取得

VBAコード内の `GetGitLog` 関数の以下の部分を変更:

```vba
' 変更前（全ブランチ）
command = "cmd /c cd /d """ & repoPath & """ && " & _
          GIT_COMMAND & " log --all -n " & maxCount & ...

' 変更後（mainブランチのみ）
command = "cmd /c cd /d """ & repoPath & """ && " & _
          GIT_COMMAND & " log main -n " & maxCount & ...
```

## セキュリティ設定

マクロを実行するには、Excelのセキュリティ設定でマクロを有効化する必要があります。

### マクロを有効化する手順

1. Excelで「ファイル」→「オプション」を選択
2. 「セキュリティセンター」→「セキュリティセンターの設定」をクリック
3. 「マクロの設定」で以下のいずれかを選択：
   - **推奨**: 「警告を表示してすべてのマクロを無効にする」
     - ファイルを開くたびに「コンテンツの有効化」ボタンをクリック
   - **上級者向け**: 「すべてのマクロを有効にする（推奨しません。危険なコードが実行される可能性があります）」

## ライセンス

このツールはMITライセンスの下で公開されています。個人・商用問わず自由に使用・改変できます。

## 更新履歴

- **2025-12-17**: ダッシュボードシート追加
  - サマリー情報（総コミット数、作者数、期間、変更量）を表示
  - 作者別コミット数ランキングを追加（バーグラフ付き）

- **2025-12-17**: 大幅リニューアル
  - シート名を日本語化（メイン、コミット履歴、ブランチグラフ）
  - メインシートに設定入力欄を追加（リポジトリパス、取得件数）
  - **リポジトリパスで環境変数（%USERNAME%等）が使用可能に**
  - Statistics（統計）とCharts（グラフ）シートを廃止

- **2025-12-07**: 初版リリース
  - Git Log 可視化機能を実装
  - 5つのシート（Dashboard、CommitHistory、Statistics、Charts、BranchGraph）を作成
  - 全ブランチ対応
  - 作者別・日別統計機能
  - グラフ可視化機能
  - ブランチ構造の図形可視化機能（git log --graph 風）

## 作者

paseriINU

## サポート

バグ報告や機能要望は、GitHubリポジトリのIssuesでお願いします。

---

**関連ツール**: [Utility-Tools-Collection](../../README.md)
