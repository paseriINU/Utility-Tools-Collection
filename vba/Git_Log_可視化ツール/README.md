# Git Log 可視化ツール

## 概要

Excelから実行し、Gitリポジトリのコミット履歴を取得して、表形式・統計情報・グラフで視覚化するツールです。

git logの出力を見やすく整理し、プロジェクトの開発状況を一目で把握できます。

## 機能

- **コミット履歴一覧**: 表形式でコミットを時系列に表示
- **統計情報**: 作者別・日別のコミット数を集計
- **グラフ可視化**: 棒グラフ・折れ線グラフで傾向を把握
- **ブランチ構造可視化**: 図形を使ってブランチ構造を `git log --graph` 風に表示
- **ダッシュボード**: リポジトリの概要を一覧表示
- **全ブランチ対応**: すべてのブランチのコミットを取得
- **変更統計**: ファイル変更数・追加/削除行数も表示

## 出力されるシート

### 1. Dashboard（ダッシュボード）

リポジトリの概要を表示します。

- リポジトリパス
- 取得コミット数
- 最新/最古のコミット日時
- 作者数
- 総追加/削除行数

### 2. CommitHistory（コミット履歴）

コミット一覧を表形式で表示します。

| カラム名 | 内容 |
|---------|------|
| No | 通し番号 |
| ハッシュ | コミットハッシュ（短縮） |
| 作者 | コミット作成者 |
| 日時 | コミット日時 |
| コミットメッセージ | コミットの件名 |
| ブランチ/タグ | 該当するブランチ・タグ名 |
| 変更ファイル数 | 変更されたファイル数 |
| 追加行数 | 追加された行数 |
| 削除行数 | 削除された行数 |

- フィルター機能で作者やブランチで絞り込み可能
- 交互に色分けして見やすく表示

### 3. Statistics（統計情報）

コミットの統計情報を表示します。

- **作者別コミット数**: 誰が何回コミットしたか
- **日別コミット数**: 日ごとのコミット数推移

### 4. Charts（グラフ）

統計情報をグラフで視覚化します。

- **作者別コミット数（棒グラフ）**: 各作者のコミット貢献度
- **日別コミット数（折れ線グラフ）**: 時系列でのコミット傾向

### 5. BranchGraph（ブランチ構造）

Excelの図形を使用してブランチ構造を視覚化します（`git log --graph` 風）。

- **コミットノード（円形）**: 各コミットを円で表示
  - **赤色**: 初期コミット（親コミットなし）
  - **緑色**: マージコミット（親コミット2つ以上）
  - **青色**: 通常コミット（親コミット1つ）
- **接続線**: 親コミットへの線を自動描画
- **レーン分離**: ブランチごとに横位置を自動調整（最大10レーン）
- **ツールチップ**: 円にマウスを当てるとコミット情報を表示

> **注意**: コミット数が多い場合、図形描画に時間がかかる場合があります。

## 必要な環境

- **Microsoft Excel**: 2010以降（マクロ有効ブック `.xlsm` 対応）
- **Git**: インストールされており、パスが通っていること
  - コマンドプロンプトで `git --version` が実行できることを確認

## インストール/セットアップ

### 1. 新しいExcelマクロ有効ブックを作成

1. Excelを起動
2. 新しいブックを作成
3. 「名前を付けて保存」から「Excelマクロ有効ブック (*.xlsm)」形式で保存
   - 推奨ファイル名: `GitLogVisualizer.xlsm`

### 2. VBAモジュールをインポート

1. Excel上で `Alt + F11` を押してVBAエディタを開く
2. メニューから「ファイル」→「ファイルのインポート」を選択
3. `GitLogVisualizer.bas` を選択してインポート
4. 標準モジュール「GitLogVisualizer」が追加されたことを確認

### 3. リポジトリパス設定（オプション）

**デフォルト設定**:

- **デフォルトパス**: `C:\Users\%USERNAME%\source\Git\project`
- 環境変数 `%USERNAME%` が自動的に展開されます

**別のリポジトリを使用する場合**は、VBAコードを編集してください:

1. VBAエディタで「GitLogVisualizer」モジュールをダブルクリック
2. `GetDefaultRepoPath()` 関数を編集:

```vba
'==============================================================================
' デフォルトのGitリポジトリパスを取得
'==============================================================================
Private Function GetDefaultRepoPath() As String
    ' C:\Users\%USERNAME%\source\Git\project
    GetDefaultRepoPath = "C:\Users\" & Environ("USERNAME") & "\source\Git\project"
End Function
```

**変更例**:

```vba
' 例: 別のリポジトリを使用する場合
Private Function GetDefaultRepoPath() As String
    GetDefaultRepoPath = "C:\MyProjects\AnotherRepo"
End Function
```

**その他の設定項目**:

- **COMMIT_COUNT**: 取得するコミット数（最近のN件）
  - デフォルト: `100`
  - 例: `500` → 最近の500件を取得
- **GIT_COMMAND**: Gitコマンドのパス
  - デフォルト: `"git"`
  - パスが通っていない場合は `"C:\Program Files\Git\bin\git.exe"` のようにフルパスを指定

編集後は `Ctrl + S` で保存してください。

### 4. 実行ボタンを追加（オプション）

Excelシート上にボタンを配置すると、マクロの実行が簡単になります。

1. Excelシートに戻る
2. 「開発」タブ→「挿入」→「ボタン（フォームコントロール）」を選択
3. シート上でドラッグしてボタンを配置
4. 「マクロの登録」ダイアログで `VisualizeGitLog` を選択
5. ボタンのテキストを「Git Log 可視化」などに変更

> **開発タブが表示されていない場合**:
> - 「ファイル」→「オプション」→「リボンのユーザー設定」
> - 右側の一覧で「開発」にチェックを入れる

## 使い方

### 基本的な実行方法

#### 方法1: ボタンから実行（推奨）

1. `GitLogVisualizer.xlsm` を開く
2. シート上の「Git Log 可視化」ボタンをクリック
3. 処理完了まで待機（数秒〜数十秒）
4. 5つのシートが作成されます:
   - **Dashboard**: 概要
   - **CommitHistory**: コミット一覧
   - **Statistics**: 統計情報
   - **Charts**: グラフ
   - **BranchGraph**: ブランチ構造の図形可視化

#### 方法2: VBAエディタから実行（デバッグ時）

1. `Alt + F11` でVBAエディタを開く
2. `Ctrl + G` でイミディエイトウィンドウを表示
3. メニューから「実行」→「Sub/ユーザーフォームの実行」
4. `VisualizeGitLog` を選択して実行

### CommitHistory シートの活用

コミット履歴シートでは以下のような分析ができます:

1. **フィルター機能**
   - ヘッダー行にフィルターボタンが表示されます
   - 作者でフィルタリング → 特定の人のコミットのみ表示
   - ブランチでフィルタリング → 特定ブランチのコミットのみ表示

2. **ソート機能**
   - 日時でソート → 時系列順に並べ替え
   - 追加行数でソート → 大きな変更を特定

3. **コミットメッセージの検索**
   - `Ctrl + F` で検索
   - 特定のキーワードを含むコミットを検索

### Statistics シートの活用

統計シートでは以下の情報が確認できます:

1. **作者別コミット数**
   - 誰が最も活発にコミットしているか
   - チームメンバーの貢献度

2. **日別コミット数**
   - いつ活発に開発されているか
   - 開発のペース配分

### Charts シートの活用

グラフシートでは視覚的に以下が確認できます:

1. **作者別棒グラフ**
   - 各メンバーの貢献度を比較
   - チーム構成の把握

2. **日別折れ線グラフ**
   - 開発の波を確認
   - リリース前のラストスパートなどを可視化

### BranchGraph シートの活用

ブランチ構造シートでは視覚的に以下が確認できます:

1. **ブランチの分岐・マージ構造**
   - 各コミットが円で表示され、親コミットへの線で繋がっている
   - 横方向の位置（レーン）でブランチを識別

2. **コミットの種類を色で識別**
   - 赤色: 初期コミット（プロジェクトの始点）
   - 緑色: マージコミット（ブランチの合流点）
   - 青色: 通常コミット

3. **詳細情報の確認**
   - 各円の右側にハッシュとコミットメッセージが表示
   - 円の上にマウスを当てるとツールチップが表示される

## 実行例

### 処理前

リポジトリパスを設定してマクロを実行します。

### イミディエイトウィンドウ出力

```
=========================================
Git Log 可視化処理を開始します
リポジトリ: C:\Users\YourName\MyProject
取得件数: 100 件
=========================================
コミット履歴を取得しています...
取得完了: 100 件
シートを準備しています...
ダッシュボードを作成しています...
コミット履歴シートを作成しています...
統計シートを作成しています...
グラフシートを作成しています...
ブランチグラフシートを作成しています...
=========================================
処理完了
=========================================
```

### 出力結果

5つのシートが作成され、以下の情報が表示されます:

- **Dashboard**: リポジトリ情報と統計サマリー
- **CommitHistory**: 最近100件のコミット一覧表
- **Statistics**: 作者別・日別の集計表
- **Charts**: 2つのグラフ（棒グラフ・折れ線グラフ）
- **BranchGraph**: ブランチ構造の図形可視化（円と線で表現）

## 注意事項

### 実行時の注意

- **Gitインストール必須**: Gitがインストールされており、コマンドプロンプトで実行可能である必要があります
- **処理時間**: コミット数が多い場合、処理に時間がかかる場合があります（特にBranchGraphの図形描画）
- **既存シート上書き**: 実行するたびに5つのシート（Dashboard、CommitHistory、Statistics、Charts、BranchGraph）が上書きされます

### リポジトリパスの指定方法

**デフォルトの動作**:
- デフォルトパス: `C:\Users\%USERNAME%\source\Git\project`
- 環境変数が自動的に展開されます

**パスを変更する場合は `GetDefaultRepoPath()` 関数を編集**:

**正しい例**:
```vba
Private Function GetDefaultRepoPath() As String
    GetDefaultRepoPath = "C:\Users\YourName\MyProject"
End Function

' または環境変数を使用
Private Function GetDefaultRepoPath() As String
    GetDefaultRepoPath = "C:\Users\" & Environ("USERNAME") & "\Documents\MyProject"
End Function

' UNCパスも使用可能
Private Function GetDefaultRepoPath() As String
    GetDefaultRepoPath = "\\server\share\project"
End Function
```

**誤った例**:
```vba
' 末尾の \ は不要
GetDefaultRepoPath = "C:\Users\YourName\MyProject\"

' スラッシュは不可（バックスラッシュを使用）
GetDefaultRepoPath = "C:/Users/YourName/MyProject"
```

### Gitコマンドのパス

通常は `"git"` で動作しますが、以下の場合はフルパスを指定してください:

- **Gitのパスが通っていない場合**
- **複数のGitがインストールされている場合**

**フルパス指定の例**:
```vba
Private Const GIT_COMMAND As String = "C:\Program Files\Git\bin\git.exe"
```

## トラブルシューティング

### 1. 「コミットが取得できませんでした」エラー

**原因**: Gitコマンドが実行できない、またはリポジトリパスが間違っている

**解決方法**:
- コマンドプロンプトで `git --version` が実行できるか確認
- リポジトリパスが正しいか確認
- GIT_COMMAND にフルパスを指定してみる

### 2. 「指定されたパスがGitリポジトリ管理下にありません」エラー

**原因**: リポジトリパス `C:\Users\%USERNAME%\source\Git\project` がGit管理下にない

**解決方法**:
- パスを確認: `C:\Users\[あなたのユーザー名]\source\Git\project` が存在するか
- コマンドプロンプトで該当フォルダに移動し、`git status` が実行できるか確認
- 別のリポジトリを使用する場合は `GetDefaultRepoPath()` 関数を編集して正しいパスを指定

### 3. グラフが表示されない

**原因**: コミット数が少ない、またはデータが取得できていない

**解決方法**:
- CommitHistory シートにデータが存在するか確認
- COMMIT_COUNT を増やしてみる
- Statistics シートに統計データがあるか確認

### 4. 処理が遅い

**原因**: コミット数が多すぎる

**解決方法**:
- COMMIT_COUNT を減らす（例: 100 → 50）
- Application.ScreenUpdating = False により画面更新は抑制されていますが、それでも遅い場合は対象を絞る

### 5. 日本語が文字化けする

**原因**: Gitの出力エンコーディングの問題

**解決方法**:
- Gitの設定を確認: `git config --global core.quotepath false`
- Excelのセルの書式を確認

## カスタマイズ

### 取得するコミット数を変更

```vba
' 最近の500件を取得する場合
Private Const COMMIT_COUNT As Long = 500
```

### 特定のブランチのみ取得

VBAコード内の `GetGitLog` 関数の以下の部分を変更:

```vba
' 変更前（全ブランチ）
command = "cmd /c cd /d """ & repoPath & """ && " & _
          GIT_COMMAND & " log --all -n " & maxCount & ...

' 変更後（mainブランチのみ）
command = "cmd /c cd /d """ & repoPath & """ && " & _
          GIT_COMMAND & " log main -n " & maxCount & ...
```

### グラフの種類を変更

VBAコード内の `CreateChartsSheet` 関数を編集:

```vba
' 例: 棒グラフを円グラフに変更
.ChartType = xlPie  ' xlColumnClustered から xlPie に変更
```

## セキュリティ設定

マクロを実行するには、Excelのセキュリティ設定でマクロを有効化する必要があります。

### マクロを有効化する手順

1. Excelで「ファイル」→「オプション」を選択
2. 「セキュリティセンター」→「セキュリティセンターの設定」をクリック
3. 「マクロの設定」で以下のいずれかを選択：
   - **推奨**: 「警告を表示してすべてのマクロを無効にする」
     - ファイルを開くたびに「コンテンツの有効化」ボタンをクリック
   - **上級者向け**: 「すべてのマクロを有効にする（推奨しません。危険なコードが実行される可能性があります）」

## ライセンス

このツールはMITライセンスの下で公開されています。個人・商用問わず自由に使用・改変できます。

## 更新履歴

- **2025-12-07**: 初版リリース
  - Git Log 可視化機能を実装
  - 5つのシート（Dashboard、CommitHistory、Statistics、Charts、BranchGraph）を作成
  - 全ブランチ対応
  - 作者別・日別統計機能
  - グラフ可視化機能
  - ブランチ構造の図形可視化機能（git log --graph 風）

## 作者

paseriINU

## サポート

バグ報告や機能要望は、GitHubリポジトリのIssuesでお願いします。

---

**関連ツール**: [Utility-Tools-Collection](../../README.md)
