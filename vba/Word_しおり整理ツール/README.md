# Word文書しおり整理ツール

## 概要

Excelから実行し、Word文書のスタイル「表題1」「表題2」「表題3」に基づいてアウトラインレベルを自動設定し、PDFエクスポート時に正しいしおり（ブックマーク）を生成するツールです。

編集によってWord文書のしおりが崩れた場合でも、このツールを実行することで機械的に修正できます。

## 機能

- **自動しおり整理**: Word文書内のスタイル「表題1」「表題2」「表題3」を検出し、アウトラインレベルを自動設定
- **Input/Output方式**: Excelマクロと同じフォルダの `Input` フォルダから処理対象を選択し、`Output` フォルダに結果を保存
- **複数ファイル対応**: Inputフォルダに複数のWord文書がある場合は、番号選択で処理対象を指定可能
- **PDF出力**: しおり付きPDFをOutputフォルダに自動保存
- **処理結果表示**: 処理した見出しの件数と出力先を表示

## しおりの対応関係

| Wordスタイル名 | PDFしおりレベル |
|--------------|----------------|
| 表題1        | レベル1        |
| 表題2        | レベル2        |
| 表題3        | レベル3        |

> **注意**: スタイル名「表題1」「表題2」「表題3」は例です。実際の環境で使用しているスタイル名に合わせて、VBAコード内の `Select Case` 部分を編集してください。

## 必要な環境

- **Microsoft Excel**: 2010以降（マクロ有効ブック `.xlsm` 対応）
- **Microsoft Word**: 2010以降（PDF出力機能が必要）
- **VBA参照設定**: Microsoft Word XX.X Object Library

## インストール/セットアップ

### 1. 新しいExcelマクロ有効ブックを作成

1. Excelを起動
2. 新しいブックを作成
3. 「名前を付けて保存」から「Excelマクロ有効ブック (*.xlsm)」形式で保存
   - 推奨ファイル名: `WordBookmarkOrganizer.xlsm`

### 2. VBAモジュールをインポート

1. Excel上で `Alt + F11` を押してVBAエディタを開く
2. メニューから「ファイル」→「ファイルのインポート」を選択
3. `WordBookmarkOrganizer.bas` を選択してインポート
4. 標準モジュール「WordBookmarkOrganizer」が追加されたことを確認

### 3. Word参照設定を追加

1. VBAエディタのメニューから「ツール」→「参照設定」を選択
2. 「Microsoft Word XX.X Object Library」にチェックを入れる
   - XX.X はインストールされているWordのバージョン（例: 16.0, 15.0）
3. 「OK」をクリック

### 4. 実行ボタンを追加（オプション）

Excelシート上にボタンを配置すると、マクロの実行が簡単になります。

1. Excelシートに戻る
2. 「開発」タブ→「挿入」→「ボタン（フォームコントロール）」を選択
3. シート上でドラッグしてボタンを配置
4. 「マクロの登録」ダイアログで `OrganizeWordBookmarks` を選択
5. ボタンのテキストを「Word しおり整理 & PDF出力」などに変更

> **開発タブが表示されていない場合**:
> - 「ファイル」→「オプション」→「リボンのユーザー設定」
> - 右側の一覧で「開発」にチェックを入れる

### 5. フォルダ構成

マクロファイルと同じフォルダに以下の構成を作成します（自動作成されます）：

```
作業フォルダ/
├─ WordBookmarkOrganizer.xlsm  # このExcelマクロファイル
├─ Input/                       # 処理対象のWord文書を配置
│  ├─ sample1.docx
│  └─ sample2.docx
└─ Output/                      # 処理結果が出力される
   ├─ sample1.docx              # しおり設定済みWord文書
   └─ sample1.pdf               # しおり付きPDF
```

> **注意**: `Input` フォルダと `Output` フォルダは、初回実行時に自動的に作成されます。手動で作成する必要はありません。

## 使い方

### 基本的な実行方法

#### 方法1: ボタンから実行（推奨）

1. `WordBookmarkOrganizer.xlsm` を開く
2. 処理したいWord文書を `Input` フォルダに配置
   - 複数のファイルがある場合は、実行時に選択できます
3. シート上の「Word しおり整理 & PDF出力」ボタンをクリック
4. Inputフォルダに複数のファイルがある場合は、番号を入力して選択
5. 処理完了まで待機（進捗はイミディエイトウィンドウで確認可能）
6. 完了メッセージが表示されたら、`Output` フォルダで結果を確認
   - しおり設定済みWord文書（.docx）
   - しおり付きPDF（.pdf）

#### 方法2: VBAエディタから実行（デバッグ時）

1. `Alt + F11` でVBAエディタを開く
2. `Ctrl + G` でイミディエイトウィンドウを表示
3. メニューから「実行」→「Sub/ユーザーフォームの実行」
4. `OrganizeWordBookmarks` を選択して実行

### ファイル選択の動作

- **Inputフォルダにファイルが1つだけの場合**: 自動的にそのファイルを処理
- **Inputフォルダに複数のファイルがある場合**: 番号を入力して選択
  ```
  処理するWord文書を選択してください:

  1. sample1.docx
  2. sample2.docx
  3. report.doc

  番号を入力してください (1-3):
  ```
- **Inputフォルダが空の場合**: エラーメッセージを表示して終了

### スタイル名のカスタマイズ

実際の環境で使用しているスタイル名が「表題1」「表題2」「表題3」と異なる場合は、VBAコードを編集してください。

**編集箇所**: `WordBookmarkOrganizer.bas` の約80行目

```vba
' スタイル名に応じてアウトラインレベルを設定
Select Case styleName
    Case "表題1"        ' ← 実際のスタイル名に変更
        outlineLevel = 1
    Case "表題2"        ' ← 実際のスタイル名に変更
        outlineLevel = 2
    Case "表題3"        ' ← 実際のスタイル名に変更
        outlineLevel = 3
End Select
```

**例**: 「見出し1」「見出し2」「見出し3」を使用している場合

```vba
Select Case styleName
    Case "見出し1"
        outlineLevel = 1
    Case "見出し2"
        outlineLevel = 2
    Case "見出し3"
        outlineLevel = 3
End Select
```

**例**: レベル4以降も追加したい場合

```vba
Select Case styleName
    Case "表題1"
        outlineLevel = 1
    Case "表題2"
        outlineLevel = 2
    Case "表題3"
        outlineLevel = 3
    Case "表題4"
        outlineLevel = 4
    Case "表題5"
        outlineLevel = 5
End Select
```

## 実行例

### 処理前のWord文書

```
表題1: はじめに
表題2: 背景
表題2: 目的
表題1: システム概要
表題2: アーキテクチャ
表題3: フロントエンド
表題3: バックエンド
表題1: まとめ
```

### 実行後のイミディエイトウィンドウ出力

```
=========================================
Word文書のしおり整理を開始します
対象ファイル: C:\Work\Input\sample.docx
=========================================
[1] はじめに
[2] 背景
[2] 目的
[1] システム概要
[2] アーキテクチャ
[3] フロントエンド
[3] バックエンド
[1] まとめ
=========================================
PDFをエクスポートしています...
Word文書を出力しました: C:\Work\Output\sample.docx
PDFを出力しました: C:\Work\Output\sample.pdf
=========================================
処理完了: 8 個の見出しを処理しました
=========================================
```

### 出力されたファイル

- **Word文書**: `Output\sample.docx`（しおり設定済み）
- **PDF**: `Output\sample.pdf`（しおり付き）
- **しおり構造**:
  ```
  ├─ はじめに
  │  ├─ 背景
  │  └─ 目的
  ├─ システム概要
  │  └─ アーキテクチャ
  │     ├─ フロントエンド
  │     └─ バックエンド
  └─ まとめ
  ```

## 注意事項

### 実行時の注意

- **Wordアプリケーションの自動起動**: このツールはバックグラウンドでWordを起動します。実行中は他のWord文書を開かないでください。
- **元のファイルは保持**: Inputフォルダ内のWord文書は変更されません。処理結果はOutputフォルダに保存されます。
- **ファイル上書き**: Outputフォルダに同名のファイルが既に存在する場合、警告なく上書きされます。
- **フォルダ構成**: マクロファイル（.xlsm）と同じ場所にInput/Outputフォルダが作成されます。別の場所に配置したい場合はVBAコードの修正が必要です。

### スタイル名の確認方法

Word文書で実際に使用されているスタイル名を確認する手順：

1. Word文書を開く
2. 見出し部分にカーソルを置く
3. 「ホーム」タブの「スタイル」グループを確認
4. 現在適用されているスタイル名が表示される

または：

1. 「ホーム」タブ→「スタイル」の右下矢印をクリック
2. 「スタイル」ウィンドウが開く
3. 見出しに適用されているスタイルを確認

### トラブルシューティング

#### 1. 「実行時エラー '429': ActiveXコンポーネントはオブジェクトを作成できません」

**原因**: Word参照設定が不足しているか、Wordがインストールされていない

**解決方法**:
- VBAエディタで「ツール」→「参照設定」を開く
- 「Microsoft Word XX.X Object Library」にチェックが入っているか確認
- チェックが入っていない場合は追加する

#### 2. しおりが正しく設定されない

**原因**: スタイル名がVBAコード内の設定と一致していない

**解決方法**:
- Word文書で実際のスタイル名を確認
- VBAコード内の `Select Case` 部分を実際のスタイル名に修正

#### 3. PDFが出力されない

**原因**: Wordのバージョンが古い、または権限の問題

**解決方法**:
- Word 2010以降がインストールされているか確認
- 出力先フォルダに書き込み権限があるか確認
- 別のフォルダを指定してテスト

#### 4. 「参照が無効です」エラー

**原因**: 異なるバージョンのOfficeで作成されたファイルを開いた

**解決方法**:
- VBAエディタで「ツール」→「参照設定」を開く
- 「参照不可」と表示されている項目のチェックを外す
- 現在の環境の「Microsoft Word XX.X Object Library」にチェックを入れる

## セキュリティ設定

マクロを実行するには、Excelのセキュリティ設定でマクロを有効化する必要があります。

### マクロを有効化する手順

1. Excelで「ファイル」→「オプション」を選択
2. 「セキュリティセンター」→「セキュリティセンターの設定」をクリック
3. 「マクロの設定」で以下のいずれかを選択：
   - **推奨**: 「警告を表示してすべてのマクロを無効にする」
     - ファイルを開くたびに「コンテンツの有効化」ボタンをクリック
   - **上級者向け**: 「すべてのマクロを有効にする（推奨しません。危険なコードが実行される可能性があります）」

## ライセンス

このツールはMITライセンスの下で公開されています。個人・商用問わず自由に使用・改変できます。

## 更新履歴

- **2025-12-07**: Input/Output方式に変更
  - ファイルダイアログを廃止し、Input/Outputフォルダ方式に変更
  - 複数ファイル対応（番号選択機能）を追加
  - フォルダ自動作成機能を追加
  - 元のファイルを保持し、結果をOutputフォルダに保存する仕様に変更
- **2025-12-06**: 初版リリース
  - Excel VBAからWord文書のしおり整理機能を実装
  - ファイル選択ダイアログ対応
  - PDF自動出力機能を追加

## 作者

paseriINU

## サポート

バグ報告や機能要望は、GitHubリポジトリのIssuesでお願いします。

---

**関連ツール**: [Utility-Tools-Collection](../../README.md)
