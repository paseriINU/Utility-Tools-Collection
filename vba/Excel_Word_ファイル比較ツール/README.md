# Excel/Word ファイル比較ツール（統合版）

2つのExcelファイルまたはWordファイルを比較し、差異を一覧表示するVBAマクロです。

1つ目のファイル選択で自動的にファイルタイプを判定し、2つ目は同じタイプのファイルのみ選択可能です。

## 機能

### 統合比較機能 (`FileComparator.bas`)

- **CompareFiles**: ExcelまたはWordファイルを比較
  - 1つ目のファイル選択でExcel/Wordを自動判定
  - 2つ目は同じタイプのファイルのみ選択可能
  - Excel: シート単位・セル単位での差異検出
  - Word: 段落単位での差異検出
  - 差異の種類を識別（値変更、追加、削除、シート追加/削除）
  - 結果を「CompareResult」シートに出力
  - 差異セルのハイライト表示（黄色:変更、緑:追加、赤:削除）

- **ClearHighlight**: ハイライトとコメントをクリア

## 必要な環境

- Microsoft Excel 2010以降
- Microsoft Word 2010以降（Word比較を使用する場合）
- マクロを有効にする必要があります

## インストール方法

### 方法1: .basファイルをインポート

1. Excelを開き、`Alt + F11` でVBAエディタを開く
2. 「ファイル」→「ファイルのインポート」を選択
3. `FileComparator.bas` をインポート
4. `Ctrl + S` で保存（.xlsm形式で保存）

### 方法2: コードをコピー

1. Excelを開き、`Alt + F11` でVBAエディタを開く
2. 「挿入」→「標準モジュール」を選択
3. .basファイルの内容をコピー&ペースト
4. `Ctrl + S` で保存（.xlsm形式で保存）

## 使い方

### ファイルの比較

1. マクロを含むExcelファイルを開く
2. `Alt + F8` でマクロダイアログを開く
3. 「CompareFiles」を選択して実行
4. 1つ目のファイル（旧ファイル）を選択
   - ExcelまたはWordファイルを選択可能
   - ファイルタイプが自動判定される
5. 2つ目のファイル（新ファイル）を選択
   - 1つ目と同じタイプのファイルのみ選択可能
6. 比較結果が「CompareResult」シートに出力される

## 出力形式

### Excel比較結果シート（CompareResult）

| No | シート名 | セル | 差異タイプ | 旧ファイルの値 | 新ファイルの値 |
|----|----------|------|------------|----------------|----------------|
| 1 | Sheet1 | A1 | 変更 | 古い値 | 新しい値 |
| 2 | Sheet1 | B2 | 追加 | (空) | 追加された値 |
| 3 | Sheet2 | C3 | 削除 | 削除された値 | (空) |

### Word比較結果シート（CompareResult）

| No | 段落番号 | 差異タイプ | 旧ファイルのテキスト | 新ファイルのテキスト |
|----|----------|------------|----------------------|----------------------|
| 1 | 5 | 変更 | 古いテキスト | 新しいテキスト |
| 2 | 10 | 追加 | (空) | 追加されたテキスト |
| 3 | 15 | 削除 | 削除されたテキスト | (空) |

## 色の凡例

- **黄色**: 値の変更
- **緑色**: 新規追加
- **赤色**: 削除

## 設定のカスタマイズ

VBAコード内の以下の定数を編集することで動作を変更できます：

```vba
' Excel比較: 最大行数（パフォーマンス対策）
Private Const MAX_ROWS As Long = 10000

' Excel比較: 最大列数
Private Const MAX_COLS As Long = 256

' Word比較: 最大段落数（パフォーマンス対策）
Private Const MAX_PARAGRAPHS As Long = 5000
```

## 対応ファイル形式

### Excel
- `.xlsx` - Excel ブック
- `.xlsm` - Excel マクロ有効ブック
- `.xls` - Excel 97-2003 ブック
- `.xlsb` - Excel バイナリ ブック

### Word
- `.docx` - Word 文書
- `.docm` - Word マクロ有効文書
- `.doc` - Word 97-2003 文書

## 注意事項

- 大きなファイルの比較には時間がかかる場合があります
- セルの数式は評価後の値で比較されます
- 書式（色、フォントなど）の違いは検出されません
- Word比較の段落単位比較は、段落の順序変更に弱い場合があります
- 比較中は画面更新が停止しますが、処理完了まで待ってください

## トラブルシューティング

### 「マクロが無効です」と表示される

- Excel/Wordのセキュリティ設定でマクロを有効にしてください
- 「ファイル」→「オプション」→「セキュリティセンター」→「マクロの設定」

### 「Word.Application の作成に失敗しました」

- Microsoft Wordがインストールされていることを確認してください
- Wordが正常に起動できるか確認してください

### 比較に時間がかかる

- `MAX_ROWS`、`MAX_COLS`、`MAX_PARAGRAPHS` の値を小さくしてください

## ライセンス

MIT License
