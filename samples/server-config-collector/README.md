# サーバ構成情報収集ツール

Windowsサーバのネットワーク・セキュリティ設定を収集してExcelファイルに出力するツールです。
WinRM実行前の事前調査に最適です。

## 収集項目

| シート名 | 内容 |
|----------|------|
| **OS情報** | OS名、バージョン、ドメイン参加状況など |
| **ネットワーク設定** | IP、サブネット、ゲートウェイ、DNS、DHCP |
| **ネットワークプロファイル** | パブリック/プライベート/ドメイン |
| **WinRM設定** | サービス状態、TrustedHosts、認証設定、リスナー |
| **ファイアウォール** | プロファイル状態、WinRM関連ルール |
| **開いているポート** | LISTENING状態のTCPポート一覧 |
| **レジストリ設定** | UAC、リモートUAC、WinRM関連設定 |
| **関連サービス** | WinRM、リモートレジストリ、RDPなど |
| **ユーザー_グループ** | ローカルユーザー、Administrators、Remote Desktop Users |

## 使い方

1. `collect-server-config.bat` をダブルクリック
2. 収集完了後、Excelファイルがデスクトップに出力される
3. 「出力ファイルを開きますか？」で `y` を入力するとExcelが開く

## 出力例

```
========================================================================
 収集完了
========================================================================

収集日時: 2025-12-10 15:30:45
コンピュータ: SERVER01

  OS情報 : 13 件
  ネットワーク設定 : 2 件
  ネットワークプロファイル : 2 件
  WinRM設定 : 18 件
  ファイアウォール : 8 件
  開いているポート : 25 件
  レジストリ設定 : 11 件
  関連サービス : 12 件
  ユーザー_グループ : 8 件
```

## WinRM関連の確認ポイント

### サービス状態
- WinRMサービスが「Running」であること
- スタートアップ種別が「Automatic」であること

### ファイアウォール
- WinRM関連ルールが有効であること
- ポート5985（HTTP）または5986（HTTPS）が開いていること

### 認証設定
- TrustedHostsに接続元が含まれていること（ワークグループ環境）
- 必要な認証方式が有効であること

### レジストリ
- `LocalAccountTokenFilterPolicy` = 1（リモートUAC無効化、ワークグループ環境で必要）

## 動作環境

- Windows Server 2012 R2以降 / Windows 10以降
- PowerShell 5.1以降
- Excel（インストールされていない場合はCSV出力）

## 注意事項

- 管理者権限は不要ですが、一部の情報取得に制限がある場合があります
- Excelがインストールされていない環境ではCSV形式で出力されます
